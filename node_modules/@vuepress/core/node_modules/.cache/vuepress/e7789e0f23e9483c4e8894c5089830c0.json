{"remainingRequest":"F:\\fortivex\\vuepress-tutorial\\docs\\node_modules\\babel-loader\\lib\\index.js??ref--3-1!F:\\fortivex\\vuepress-tutorial\\docs\\node_modules\\vue-router\\dist\\vue-router.esm.js","dependencies":[{"path":"F:\\fortivex\\vuepress-tutorial\\docs\\node_modules\\vue-router\\dist\\vue-router.esm.js","mtime":1765807960220},{"path":"F:\\fortivex\\vuepress-tutorial\\docs\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1765807958813},{"path":"F:\\fortivex\\vuepress-tutorial\\docs\\node_modules\\babel-loader\\lib\\index.js","mtime":1765807958345}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZXJyb3IuY2F1c2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IuY29uc3RydWN0b3IuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5pdGVyYXRvci5ldmVyeS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLml0ZXJhdG9yLmZpbHRlci5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLml0ZXJhdG9yLmZvci1lYWNoLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3IubWFwLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuaXRlcmF0b3Iuc29tZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmpzb24uc3RyaW5naWZ5LmpzIjsKLyohCiAgKiB2dWUtcm91dGVyIHYzLjYuNQogICogKGMpIDIwMjIgRXZhbiBZb3UKICAqIEBsaWNlbnNlIE1JVAogICovCi8qICAqLwoKZnVuY3Rpb24gYXNzZXJ0KGNvbmRpdGlvbiwgbWVzc2FnZSkgewogIGlmICghY29uZGl0aW9uKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIlt2dWUtcm91dGVyXSAiICsgbWVzc2FnZSk7CiAgfQp9CmZ1bmN0aW9uIHdhcm4oY29uZGl0aW9uLCBtZXNzYWdlKSB7CiAgaWYgKCFjb25kaXRpb24pIHsKICAgIHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJyAmJiBjb25zb2xlLndhcm4oIlt2dWUtcm91dGVyXSAiICsgbWVzc2FnZSk7CiAgfQp9CmZ1bmN0aW9uIGV4dGVuZChhLCBiKSB7CiAgZm9yICh2YXIga2V5IGluIGIpIHsKICAgIGFba2V5XSA9IGJba2V5XTsKICB9CiAgcmV0dXJuIGE7Cn0KCi8qICAqLwoKdmFyIGVuY29kZVJlc2VydmVSRSA9IC9bIScoKSpdL2c7CnZhciBlbmNvZGVSZXNlcnZlUmVwbGFjZXIgPSBmdW5jdGlvbiAoYykgewogIHJldHVybiAnJScgKyBjLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpOwp9Owp2YXIgY29tbWFSRSA9IC8lMkMvZzsKCi8vIGZpeGVkIGVuY29kZVVSSUNvbXBvbmVudCB3aGljaCBpcyBtb3JlIGNvbmZvcm1hbnQgdG8gUkZDMzk4NjoKLy8gLSBlc2NhcGVzIFshJygpKl0KLy8gLSBwcmVzZXJ2ZSBjb21tYXMKdmFyIGVuY29kZSA9IGZ1bmN0aW9uIChzdHIpIHsKICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KHN0cikucmVwbGFjZShlbmNvZGVSZXNlcnZlUkUsIGVuY29kZVJlc2VydmVSZXBsYWNlcikucmVwbGFjZShjb21tYVJFLCAnLCcpOwp9OwpmdW5jdGlvbiBkZWNvZGUoc3RyKSB7CiAgdHJ5IHsKICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQoc3RyKTsKICB9IGNhdGNoIChlcnIpIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgIHdhcm4oZmFsc2UsICJFcnJvciBkZWNvZGluZyBcIiIgKyBzdHIgKyAiXCIuIExlYXZpbmcgaXQgaW50YWN0LiIpOwogICAgfQogIH0KICByZXR1cm4gc3RyOwp9CmZ1bmN0aW9uIHJlc29sdmVRdWVyeShxdWVyeSwgZXh0cmFRdWVyeSwgX3BhcnNlUXVlcnkpIHsKICBpZiAoZXh0cmFRdWVyeSA9PT0gdm9pZCAwKSBleHRyYVF1ZXJ5ID0ge307CiAgdmFyIHBhcnNlID0gX3BhcnNlUXVlcnkgfHwgcGFyc2VRdWVyeTsKICB2YXIgcGFyc2VkUXVlcnk7CiAgdHJ5IHsKICAgIHBhcnNlZFF1ZXJ5ID0gcGFyc2UocXVlcnkgfHwgJycpOwogIH0gY2F0Y2ggKGUpIHsKICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgd2FybihmYWxzZSwgZS5tZXNzYWdlKTsKICAgIHBhcnNlZFF1ZXJ5ID0ge307CiAgfQogIGZvciAodmFyIGtleSBpbiBleHRyYVF1ZXJ5KSB7CiAgICB2YXIgdmFsdWUgPSBleHRyYVF1ZXJ5W2tleV07CiAgICBwYXJzZWRRdWVyeVtrZXldID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZS5tYXAoY2FzdFF1ZXJ5UGFyYW1WYWx1ZSkgOiBjYXN0UXVlcnlQYXJhbVZhbHVlKHZhbHVlKTsKICB9CiAgcmV0dXJuIHBhcnNlZFF1ZXJ5Owp9CnZhciBjYXN0UXVlcnlQYXJhbVZhbHVlID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgcmV0dXJuIHZhbHVlID09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyA/IHZhbHVlIDogU3RyaW5nKHZhbHVlKTsKfTsKZnVuY3Rpb24gcGFyc2VRdWVyeShxdWVyeSkgewogIHZhciByZXMgPSB7fTsKICBxdWVyeSA9IHF1ZXJ5LnRyaW0oKS5yZXBsYWNlKC9eKFw/fCN8JikvLCAnJyk7CiAgaWYgKCFxdWVyeSkgewogICAgcmV0dXJuIHJlczsKICB9CiAgcXVlcnkuc3BsaXQoJyYnKS5mb3JFYWNoKGZ1bmN0aW9uIChwYXJhbSkgewogICAgdmFyIHBhcnRzID0gcGFyYW0ucmVwbGFjZSgvXCsvZywgJyAnKS5zcGxpdCgnPScpOwogICAgdmFyIGtleSA9IGRlY29kZShwYXJ0cy5zaGlmdCgpKTsKICAgIHZhciB2YWwgPSBwYXJ0cy5sZW5ndGggPiAwID8gZGVjb2RlKHBhcnRzLmpvaW4oJz0nKSkgOiBudWxsOwogICAgaWYgKHJlc1trZXldID09PSB1bmRlZmluZWQpIHsKICAgICAgcmVzW2tleV0gPSB2YWw7CiAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkocmVzW2tleV0pKSB7CiAgICAgIHJlc1trZXldLnB1c2godmFsKTsKICAgIH0gZWxzZSB7CiAgICAgIHJlc1trZXldID0gW3Jlc1trZXldLCB2YWxdOwogICAgfQogIH0pOwogIHJldHVybiByZXM7Cn0KZnVuY3Rpb24gc3RyaW5naWZ5UXVlcnkob2JqKSB7CiAgdmFyIHJlcyA9IG9iaiA/IE9iamVjdC5rZXlzKG9iaikubWFwKGZ1bmN0aW9uIChrZXkpIHsKICAgIHZhciB2YWwgPSBvYmpba2V5XTsKICAgIGlmICh2YWwgPT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gJyc7CiAgICB9CiAgICBpZiAodmFsID09PSBudWxsKSB7CiAgICAgIHJldHVybiBlbmNvZGUoa2V5KTsKICAgIH0KICAgIGlmIChBcnJheS5pc0FycmF5KHZhbCkpIHsKICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICB2YWwuZm9yRWFjaChmdW5jdGlvbiAodmFsMikgewogICAgICAgIGlmICh2YWwyID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbDIgPT09IG51bGwpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKGVuY29kZShrZXkpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzdWx0LnB1c2goZW5jb2RlKGtleSkgKyAnPScgKyBlbmNvZGUodmFsMikpOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHJldHVybiByZXN1bHQuam9pbignJicpOwogICAgfQogICAgcmV0dXJuIGVuY29kZShrZXkpICsgJz0nICsgZW5jb2RlKHZhbCk7CiAgfSkuZmlsdGVyKGZ1bmN0aW9uICh4KSB7CiAgICByZXR1cm4geC5sZW5ndGggPiAwOwogIH0pLmpvaW4oJyYnKSA6IG51bGw7CiAgcmV0dXJuIHJlcyA/ICI/IiArIHJlcyA6ICcnOwp9CgovKiAgKi8KCnZhciB0cmFpbGluZ1NsYXNoUkUgPSAvXC8/JC87CmZ1bmN0aW9uIGNyZWF0ZVJvdXRlKHJlY29yZCwgbG9jYXRpb24sIHJlZGlyZWN0ZWRGcm9tLCByb3V0ZXIpIHsKICB2YXIgc3RyaW5naWZ5UXVlcnkgPSByb3V0ZXIgJiYgcm91dGVyLm9wdGlvbnMuc3RyaW5naWZ5UXVlcnk7CiAgdmFyIHF1ZXJ5ID0gbG9jYXRpb24ucXVlcnkgfHwge307CiAgdHJ5IHsKICAgIHF1ZXJ5ID0gY2xvbmUocXVlcnkpOwogIH0gY2F0Y2ggKGUpIHt9CiAgdmFyIHJvdXRlID0gewogICAgbmFtZTogbG9jYXRpb24ubmFtZSB8fCByZWNvcmQgJiYgcmVjb3JkLm5hbWUsCiAgICBtZXRhOiByZWNvcmQgJiYgcmVjb3JkLm1ldGEgfHwge30sCiAgICBwYXRoOiBsb2NhdGlvbi5wYXRoIHx8ICcvJywKICAgIGhhc2g6IGxvY2F0aW9uLmhhc2ggfHwgJycsCiAgICBxdWVyeTogcXVlcnksCiAgICBwYXJhbXM6IGxvY2F0aW9uLnBhcmFtcyB8fCB7fSwKICAgIGZ1bGxQYXRoOiBnZXRGdWxsUGF0aChsb2NhdGlvbiwgc3RyaW5naWZ5UXVlcnkpLAogICAgbWF0Y2hlZDogcmVjb3JkID8gZm9ybWF0TWF0Y2gocmVjb3JkKSA6IFtdCiAgfTsKICBpZiAocmVkaXJlY3RlZEZyb20pIHsKICAgIHJvdXRlLnJlZGlyZWN0ZWRGcm9tID0gZ2V0RnVsbFBhdGgocmVkaXJlY3RlZEZyb20sIHN0cmluZ2lmeVF1ZXJ5KTsKICB9CiAgcmV0dXJuIE9iamVjdC5mcmVlemUocm91dGUpOwp9CmZ1bmN0aW9uIGNsb25lKHZhbHVlKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICByZXR1cm4gdmFsdWUubWFwKGNsb25lKTsKICB9IGVsc2UgaWYgKHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHsKICAgIHZhciByZXMgPSB7fTsKICAgIGZvciAodmFyIGtleSBpbiB2YWx1ZSkgewogICAgICByZXNba2V5XSA9IGNsb25lKHZhbHVlW2tleV0pOwogICAgfQogICAgcmV0dXJuIHJlczsKICB9IGVsc2UgewogICAgcmV0dXJuIHZhbHVlOwogIH0KfQoKLy8gdGhlIHN0YXJ0aW5nIHJvdXRlIHRoYXQgcmVwcmVzZW50cyB0aGUgaW5pdGlhbCBzdGF0ZQp2YXIgU1RBUlQgPSBjcmVhdGVSb3V0ZShudWxsLCB7CiAgcGF0aDogJy8nCn0pOwpmdW5jdGlvbiBmb3JtYXRNYXRjaChyZWNvcmQpIHsKICB2YXIgcmVzID0gW107CiAgd2hpbGUgKHJlY29yZCkgewogICAgcmVzLnVuc2hpZnQocmVjb3JkKTsKICAgIHJlY29yZCA9IHJlY29yZC5wYXJlbnQ7CiAgfQogIHJldHVybiByZXM7Cn0KZnVuY3Rpb24gZ2V0RnVsbFBhdGgocmVmLCBfc3RyaW5naWZ5UXVlcnkpIHsKICB2YXIgcGF0aCA9IHJlZi5wYXRoOwogIHZhciBxdWVyeSA9IHJlZi5xdWVyeTsKICBpZiAocXVlcnkgPT09IHZvaWQgMCkgcXVlcnkgPSB7fTsKICB2YXIgaGFzaCA9IHJlZi5oYXNoOwogIGlmIChoYXNoID09PSB2b2lkIDApIGhhc2ggPSAnJzsKICB2YXIgc3RyaW5naWZ5ID0gX3N0cmluZ2lmeVF1ZXJ5IHx8IHN0cmluZ2lmeVF1ZXJ5OwogIHJldHVybiAocGF0aCB8fCAnLycpICsgc3RyaW5naWZ5KHF1ZXJ5KSArIGhhc2g7Cn0KZnVuY3Rpb24gaXNTYW1lUm91dGUoYSwgYiwgb25seVBhdGgpIHsKICBpZiAoYiA9PT0gU1RBUlQpIHsKICAgIHJldHVybiBhID09PSBiOwogIH0gZWxzZSBpZiAoIWIpIHsKICAgIHJldHVybiBmYWxzZTsKICB9IGVsc2UgaWYgKGEucGF0aCAmJiBiLnBhdGgpIHsKICAgIHJldHVybiBhLnBhdGgucmVwbGFjZSh0cmFpbGluZ1NsYXNoUkUsICcnKSA9PT0gYi5wYXRoLnJlcGxhY2UodHJhaWxpbmdTbGFzaFJFLCAnJykgJiYgKG9ubHlQYXRoIHx8IGEuaGFzaCA9PT0gYi5oYXNoICYmIGlzT2JqZWN0RXF1YWwoYS5xdWVyeSwgYi5xdWVyeSkpOwogIH0gZWxzZSBpZiAoYS5uYW1lICYmIGIubmFtZSkgewogICAgcmV0dXJuIGEubmFtZSA9PT0gYi5uYW1lICYmIChvbmx5UGF0aCB8fCBhLmhhc2ggPT09IGIuaGFzaCAmJiBpc09iamVjdEVxdWFsKGEucXVlcnksIGIucXVlcnkpICYmIGlzT2JqZWN0RXF1YWwoYS5wYXJhbXMsIGIucGFyYW1zKSk7CiAgfSBlbHNlIHsKICAgIHJldHVybiBmYWxzZTsKICB9Cn0KZnVuY3Rpb24gaXNPYmplY3RFcXVhbChhLCBiKSB7CiAgaWYgKGEgPT09IHZvaWQgMCkgYSA9IHt9OwogIGlmIChiID09PSB2b2lkIDApIGIgPSB7fTsKCiAgLy8gaGFuZGxlIG51bGwgdmFsdWUgIzE1NjYKICBpZiAoIWEgfHwgIWIpIHsKICAgIHJldHVybiBhID09PSBiOwogIH0KICB2YXIgYUtleXMgPSBPYmplY3Qua2V5cyhhKS5zb3J0KCk7CiAgdmFyIGJLZXlzID0gT2JqZWN0LmtleXMoYikuc29ydCgpOwogIGlmIChhS2V5cy5sZW5ndGggIT09IGJLZXlzLmxlbmd0aCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICByZXR1cm4gYUtleXMuZXZlcnkoZnVuY3Rpb24gKGtleSwgaSkgewogICAgdmFyIGFWYWwgPSBhW2tleV07CiAgICB2YXIgYktleSA9IGJLZXlzW2ldOwogICAgaWYgKGJLZXkgIT09IGtleSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB2YXIgYlZhbCA9IGJba2V5XTsKICAgIC8vIHF1ZXJ5IHZhbHVlcyBjYW4gYmUgbnVsbCBhbmQgdW5kZWZpbmVkCiAgICBpZiAoYVZhbCA9PSBudWxsIHx8IGJWYWwgPT0gbnVsbCkgewogICAgICByZXR1cm4gYVZhbCA9PT0gYlZhbDsKICAgIH0KICAgIC8vIGNoZWNrIG5lc3RlZCBlcXVhbGl0eQogICAgaWYgKHR5cGVvZiBhVmFsID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgYlZhbCA9PT0gJ29iamVjdCcpIHsKICAgICAgcmV0dXJuIGlzT2JqZWN0RXF1YWwoYVZhbCwgYlZhbCk7CiAgICB9CiAgICByZXR1cm4gU3RyaW5nKGFWYWwpID09PSBTdHJpbmcoYlZhbCk7CiAgfSk7Cn0KZnVuY3Rpb24gaXNJbmNsdWRlZFJvdXRlKGN1cnJlbnQsIHRhcmdldCkgewogIHJldHVybiBjdXJyZW50LnBhdGgucmVwbGFjZSh0cmFpbGluZ1NsYXNoUkUsICcvJykuaW5kZXhPZih0YXJnZXQucGF0aC5yZXBsYWNlKHRyYWlsaW5nU2xhc2hSRSwgJy8nKSkgPT09IDAgJiYgKCF0YXJnZXQuaGFzaCB8fCBjdXJyZW50Lmhhc2ggPT09IHRhcmdldC5oYXNoKSAmJiBxdWVyeUluY2x1ZGVzKGN1cnJlbnQucXVlcnksIHRhcmdldC5xdWVyeSk7Cn0KZnVuY3Rpb24gcXVlcnlJbmNsdWRlcyhjdXJyZW50LCB0YXJnZXQpIHsKICBmb3IgKHZhciBrZXkgaW4gdGFyZ2V0KSB7CiAgICBpZiAoIShrZXkgaW4gY3VycmVudCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KICByZXR1cm4gdHJ1ZTsKfQpmdW5jdGlvbiBoYW5kbGVSb3V0ZUVudGVyZWQocm91dGUpIHsKICBmb3IgKHZhciBpID0gMDsgaSA8IHJvdXRlLm1hdGNoZWQubGVuZ3RoOyBpKyspIHsKICAgIHZhciByZWNvcmQgPSByb3V0ZS5tYXRjaGVkW2ldOwogICAgZm9yICh2YXIgbmFtZSBpbiByZWNvcmQuaW5zdGFuY2VzKSB7CiAgICAgIHZhciBpbnN0YW5jZSA9IHJlY29yZC5pbnN0YW5jZXNbbmFtZV07CiAgICAgIHZhciBjYnMgPSByZWNvcmQuZW50ZXJlZENic1tuYW1lXTsKICAgICAgaWYgKCFpbnN0YW5jZSB8fCAhY2JzKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZGVsZXRlIHJlY29yZC5lbnRlcmVkQ2JzW25hbWVdOwogICAgICBmb3IgKHZhciBpJDEgPSAwOyBpJDEgPCBjYnMubGVuZ3RoOyBpJDErKykgewogICAgICAgIGlmICghaW5zdGFuY2UuX2lzQmVpbmdEZXN0cm95ZWQpIHsKICAgICAgICAgIGNic1tpJDFdKGluc3RhbmNlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9Cn0KdmFyIFZpZXcgPSB7CiAgbmFtZTogJ1JvdXRlclZpZXcnLAogIGZ1bmN0aW9uYWw6IHRydWUsCiAgcHJvcHM6IHsKICAgIG5hbWU6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAnZGVmYXVsdCcKICAgIH0KICB9LAogIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKF8sIHJlZikgewogICAgdmFyIHByb3BzID0gcmVmLnByb3BzOwogICAgdmFyIGNoaWxkcmVuID0gcmVmLmNoaWxkcmVuOwogICAgdmFyIHBhcmVudCA9IHJlZi5wYXJlbnQ7CiAgICB2YXIgZGF0YSA9IHJlZi5kYXRhOwoKICAgIC8vIHVzZWQgYnkgZGV2dG9vbHMgdG8gZGlzcGxheSBhIHJvdXRlci12aWV3IGJhZGdlCiAgICBkYXRhLnJvdXRlclZpZXcgPSB0cnVlOwoKICAgIC8vIGRpcmVjdGx5IHVzZSBwYXJlbnQgY29udGV4dCdzIGNyZWF0ZUVsZW1lbnQoKSBmdW5jdGlvbgogICAgLy8gc28gdGhhdCBjb21wb25lbnRzIHJlbmRlcmVkIGJ5IHJvdXRlci12aWV3IGNhbiByZXNvbHZlIG5hbWVkIHNsb3RzCiAgICB2YXIgaCA9IHBhcmVudC4kY3JlYXRlRWxlbWVudDsKICAgIHZhciBuYW1lID0gcHJvcHMubmFtZTsKICAgIHZhciByb3V0ZSA9IHBhcmVudC4kcm91dGU7CiAgICB2YXIgY2FjaGUgPSBwYXJlbnQuX3JvdXRlclZpZXdDYWNoZSB8fCAocGFyZW50Ll9yb3V0ZXJWaWV3Q2FjaGUgPSB7fSk7CgogICAgLy8gZGV0ZXJtaW5lIGN1cnJlbnQgdmlldyBkZXB0aCwgYWxzbyBjaGVjayB0byBzZWUgaWYgdGhlIHRyZWUKICAgIC8vIGhhcyBiZWVuIHRvZ2dsZWQgaW5hY3RpdmUgYnV0IGtlcHQtYWxpdmUuCiAgICB2YXIgZGVwdGggPSAwOwogICAgdmFyIGluYWN0aXZlID0gZmFsc2U7CiAgICB3aGlsZSAocGFyZW50ICYmIHBhcmVudC5fcm91dGVyUm9vdCAhPT0gcGFyZW50KSB7CiAgICAgIHZhciB2bm9kZURhdGEgPSBwYXJlbnQuJHZub2RlID8gcGFyZW50LiR2bm9kZS5kYXRhIDoge307CiAgICAgIGlmICh2bm9kZURhdGEucm91dGVyVmlldykgewogICAgICAgIGRlcHRoKys7CiAgICAgIH0KICAgICAgaWYgKHZub2RlRGF0YS5rZWVwQWxpdmUgJiYgcGFyZW50Ll9kaXJlY3RJbmFjdGl2ZSAmJiBwYXJlbnQuX2luYWN0aXZlKSB7CiAgICAgICAgaW5hY3RpdmUgPSB0cnVlOwogICAgICB9CiAgICAgIHBhcmVudCA9IHBhcmVudC4kcGFyZW50OwogICAgfQogICAgZGF0YS5yb3V0ZXJWaWV3RGVwdGggPSBkZXB0aDsKCiAgICAvLyByZW5kZXIgcHJldmlvdXMgdmlldyBpZiB0aGUgdHJlZSBpcyBpbmFjdGl2ZSBhbmQga2VwdC1hbGl2ZQogICAgaWYgKGluYWN0aXZlKSB7CiAgICAgIHZhciBjYWNoZWREYXRhID0gY2FjaGVbbmFtZV07CiAgICAgIHZhciBjYWNoZWRDb21wb25lbnQgPSBjYWNoZWREYXRhICYmIGNhY2hlZERhdGEuY29tcG9uZW50OwogICAgICBpZiAoY2FjaGVkQ29tcG9uZW50KSB7CiAgICAgICAgLy8gIzIzMDEKICAgICAgICAvLyBwYXNzIHByb3BzCiAgICAgICAgaWYgKGNhY2hlZERhdGEuY29uZmlnUHJvcHMpIHsKICAgICAgICAgIGZpbGxQcm9wc2luRGF0YShjYWNoZWRDb21wb25lbnQsIGRhdGEsIGNhY2hlZERhdGEucm91dGUsIGNhY2hlZERhdGEuY29uZmlnUHJvcHMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaChjYWNoZWRDb21wb25lbnQsIGRhdGEsIGNoaWxkcmVuKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyByZW5kZXIgcHJldmlvdXMgZW1wdHkgdmlldwogICAgICAgIHJldHVybiBoKCk7CiAgICAgIH0KICAgIH0KICAgIHZhciBtYXRjaGVkID0gcm91dGUubWF0Y2hlZFtkZXB0aF07CiAgICB2YXIgY29tcG9uZW50ID0gbWF0Y2hlZCAmJiBtYXRjaGVkLmNvbXBvbmVudHNbbmFtZV07CgogICAgLy8gcmVuZGVyIGVtcHR5IG5vZGUgaWYgbm8gbWF0Y2hlZCByb3V0ZSBvciBubyBjb25maWcgY29tcG9uZW50CiAgICBpZiAoIW1hdGNoZWQgfHwgIWNvbXBvbmVudCkgewogICAgICBjYWNoZVtuYW1lXSA9IG51bGw7CiAgICAgIHJldHVybiBoKCk7CiAgICB9CgogICAgLy8gY2FjaGUgY29tcG9uZW50CiAgICBjYWNoZVtuYW1lXSA9IHsKICAgICAgY29tcG9uZW50OiBjb21wb25lbnQKICAgIH07CgogICAgLy8gYXR0YWNoIGluc3RhbmNlIHJlZ2lzdHJhdGlvbiBob29rCiAgICAvLyB0aGlzIHdpbGwgYmUgY2FsbGVkIGluIHRoZSBpbnN0YW5jZSdzIGluamVjdGVkIGxpZmVjeWNsZSBob29rcwogICAgZGF0YS5yZWdpc3RlclJvdXRlSW5zdGFuY2UgPSBmdW5jdGlvbiAodm0sIHZhbCkgewogICAgICAvLyB2YWwgY291bGQgYmUgdW5kZWZpbmVkIGZvciB1bnJlZ2lzdHJhdGlvbgogICAgICB2YXIgY3VycmVudCA9IG1hdGNoZWQuaW5zdGFuY2VzW25hbWVdOwogICAgICBpZiAodmFsICYmIGN1cnJlbnQgIT09IHZtIHx8ICF2YWwgJiYgY3VycmVudCA9PT0gdm0pIHsKICAgICAgICBtYXRjaGVkLmluc3RhbmNlc1tuYW1lXSA9IHZhbDsKICAgICAgfQogICAgfQoKICAgIC8vIGFsc28gcmVnaXN0ZXIgaW5zdGFuY2UgaW4gcHJlcGF0Y2ggaG9vawogICAgLy8gaW4gY2FzZSB0aGUgc2FtZSBjb21wb25lbnQgaW5zdGFuY2UgaXMgcmV1c2VkIGFjcm9zcyBkaWZmZXJlbnQgcm91dGVzCiAgICA7CiAgICAoZGF0YS5ob29rIHx8IChkYXRhLmhvb2sgPSB7fSkpLnByZXBhdGNoID0gZnVuY3Rpb24gKF8sIHZub2RlKSB7CiAgICAgIG1hdGNoZWQuaW5zdGFuY2VzW25hbWVdID0gdm5vZGUuY29tcG9uZW50SW5zdGFuY2U7CiAgICB9OwoKICAgIC8vIHJlZ2lzdGVyIGluc3RhbmNlIGluIGluaXQgaG9vawogICAgLy8gaW4gY2FzZSBrZXB0LWFsaXZlIGNvbXBvbmVudCBiZSBhY3RpdmVkIHdoZW4gcm91dGVzIGNoYW5nZWQKICAgIGRhdGEuaG9vay5pbml0ID0gZnVuY3Rpb24gKHZub2RlKSB7CiAgICAgIGlmICh2bm9kZS5kYXRhLmtlZXBBbGl2ZSAmJiB2bm9kZS5jb21wb25lbnRJbnN0YW5jZSAmJiB2bm9kZS5jb21wb25lbnRJbnN0YW5jZSAhPT0gbWF0Y2hlZC5pbnN0YW5jZXNbbmFtZV0pIHsKICAgICAgICBtYXRjaGVkLmluc3RhbmNlc1tuYW1lXSA9IHZub2RlLmNvbXBvbmVudEluc3RhbmNlOwogICAgICB9CgogICAgICAvLyBpZiB0aGUgcm91dGUgdHJhbnNpdGlvbiBoYXMgYWxyZWFkeSBiZWVuIGNvbmZpcm1lZCB0aGVuIHdlIHdlcmVuJ3QKICAgICAgLy8gYWJsZSB0byBjYWxsIHRoZSBjYnMgZHVyaW5nIGNvbmZpcm1hdGlvbiBhcyB0aGUgY29tcG9uZW50IHdhcyBub3QKICAgICAgLy8gcmVnaXN0ZXJlZCB5ZXQsIHNvIHdlIGNhbGwgaXQgaGVyZS4KICAgICAgaGFuZGxlUm91dGVFbnRlcmVkKHJvdXRlKTsKICAgIH07CiAgICB2YXIgY29uZmlnUHJvcHMgPSBtYXRjaGVkLnByb3BzICYmIG1hdGNoZWQucHJvcHNbbmFtZV07CiAgICAvLyBzYXZlIHJvdXRlIGFuZCBjb25maWdQcm9wcyBpbiBjYWNoZQogICAgaWYgKGNvbmZpZ1Byb3BzKSB7CiAgICAgIGV4dGVuZChjYWNoZVtuYW1lXSwgewogICAgICAgIHJvdXRlOiByb3V0ZSwKICAgICAgICBjb25maWdQcm9wczogY29uZmlnUHJvcHMKICAgICAgfSk7CiAgICAgIGZpbGxQcm9wc2luRGF0YShjb21wb25lbnQsIGRhdGEsIHJvdXRlLCBjb25maWdQcm9wcyk7CiAgICB9CiAgICByZXR1cm4gaChjb21wb25lbnQsIGRhdGEsIGNoaWxkcmVuKTsKICB9Cn07CmZ1bmN0aW9uIGZpbGxQcm9wc2luRGF0YShjb21wb25lbnQsIGRhdGEsIHJvdXRlLCBjb25maWdQcm9wcykgewogIC8vIHJlc29sdmUgcHJvcHMKICB2YXIgcHJvcHNUb1Bhc3MgPSBkYXRhLnByb3BzID0gcmVzb2x2ZVByb3BzKHJvdXRlLCBjb25maWdQcm9wcyk7CiAgaWYgKHByb3BzVG9QYXNzKSB7CiAgICAvLyBjbG9uZSB0byBwcmV2ZW50IG11dGF0aW9uCiAgICBwcm9wc1RvUGFzcyA9IGRhdGEucHJvcHMgPSBleHRlbmQoe30sIHByb3BzVG9QYXNzKTsKICAgIC8vIHBhc3Mgbm9uLWRlY2xhcmVkIHByb3BzIGFzIGF0dHJzCiAgICB2YXIgYXR0cnMgPSBkYXRhLmF0dHJzID0gZGF0YS5hdHRycyB8fCB7fTsKICAgIGZvciAodmFyIGtleSBpbiBwcm9wc1RvUGFzcykgewogICAgICBpZiAoIWNvbXBvbmVudC5wcm9wcyB8fCAhKGtleSBpbiBjb21wb25lbnQucHJvcHMpKSB7CiAgICAgICAgYXR0cnNba2V5XSA9IHByb3BzVG9QYXNzW2tleV07CiAgICAgICAgZGVsZXRlIHByb3BzVG9QYXNzW2tleV07CiAgICAgIH0KICAgIH0KICB9Cn0KZnVuY3Rpb24gcmVzb2x2ZVByb3BzKHJvdXRlLCBjb25maWcpIHsKICBzd2l0Y2ggKHR5cGVvZiBjb25maWcpIHsKICAgIGNhc2UgJ3VuZGVmaW5lZCc6CiAgICAgIHJldHVybjsKICAgIGNhc2UgJ29iamVjdCc6CiAgICAgIHJldHVybiBjb25maWc7CiAgICBjYXNlICdmdW5jdGlvbic6CiAgICAgIHJldHVybiBjb25maWcocm91dGUpOwogICAgY2FzZSAnYm9vbGVhbic6CiAgICAgIHJldHVybiBjb25maWcgPyByb3V0ZS5wYXJhbXMgOiB1bmRlZmluZWQ7CiAgICBkZWZhdWx0OgogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgIHdhcm4oZmFsc2UsICJwcm9wcyBpbiBcIiIgKyByb3V0ZS5wYXRoICsgIlwiIGlzIGEgIiArIHR5cGVvZiBjb25maWcgKyAiLCAiICsgImV4cGVjdGluZyBhbiBvYmplY3QsIGZ1bmN0aW9uIG9yIGJvb2xlYW4uIik7CiAgICAgIH0KICB9Cn0KCi8qICAqLwoKZnVuY3Rpb24gcmVzb2x2ZVBhdGgocmVsYXRpdmUsIGJhc2UsIGFwcGVuZCkgewogIHZhciBmaXJzdENoYXIgPSByZWxhdGl2ZS5jaGFyQXQoMCk7CiAgaWYgKGZpcnN0Q2hhciA9PT0gJy8nKSB7CiAgICByZXR1cm4gcmVsYXRpdmU7CiAgfQogIGlmIChmaXJzdENoYXIgPT09ICc/JyB8fCBmaXJzdENoYXIgPT09ICcjJykgewogICAgcmV0dXJuIGJhc2UgKyByZWxhdGl2ZTsKICB9CiAgdmFyIHN0YWNrID0gYmFzZS5zcGxpdCgnLycpOwoKICAvLyByZW1vdmUgdHJhaWxpbmcgc2VnbWVudCBpZjoKICAvLyAtIG5vdCBhcHBlbmRpbmcKICAvLyAtIGFwcGVuZGluZyB0byB0cmFpbGluZyBzbGFzaCAobGFzdCBzZWdtZW50IGlzIGVtcHR5KQogIGlmICghYXBwZW5kIHx8ICFzdGFja1tzdGFjay5sZW5ndGggLSAxXSkgewogICAgc3RhY2sucG9wKCk7CiAgfQoKICAvLyByZXNvbHZlIHJlbGF0aXZlIHBhdGgKICB2YXIgc2VnbWVudHMgPSByZWxhdGl2ZS5yZXBsYWNlKC9eXC8vLCAnJykuc3BsaXQoJy8nKTsKICBmb3IgKHZhciBpID0gMDsgaSA8IHNlZ21lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc2VnbWVudCA9IHNlZ21lbnRzW2ldOwogICAgaWYgKHNlZ21lbnQgPT09ICcuLicpIHsKICAgICAgc3RhY2sucG9wKCk7CiAgICB9IGVsc2UgaWYgKHNlZ21lbnQgIT09ICcuJykgewogICAgICBzdGFjay5wdXNoKHNlZ21lbnQpOwogICAgfQogIH0KCiAgLy8gZW5zdXJlIGxlYWRpbmcgc2xhc2gKICBpZiAoc3RhY2tbMF0gIT09ICcnKSB7CiAgICBzdGFjay51bnNoaWZ0KCcnKTsKICB9CiAgcmV0dXJuIHN0YWNrLmpvaW4oJy8nKTsKfQpmdW5jdGlvbiBwYXJzZVBhdGgocGF0aCkgewogIHZhciBoYXNoID0gJyc7CiAgdmFyIHF1ZXJ5ID0gJyc7CiAgdmFyIGhhc2hJbmRleCA9IHBhdGguaW5kZXhPZignIycpOwogIGlmIChoYXNoSW5kZXggPj0gMCkgewogICAgaGFzaCA9IHBhdGguc2xpY2UoaGFzaEluZGV4KTsKICAgIHBhdGggPSBwYXRoLnNsaWNlKDAsIGhhc2hJbmRleCk7CiAgfQogIHZhciBxdWVyeUluZGV4ID0gcGF0aC5pbmRleE9mKCc/Jyk7CiAgaWYgKHF1ZXJ5SW5kZXggPj0gMCkgewogICAgcXVlcnkgPSBwYXRoLnNsaWNlKHF1ZXJ5SW5kZXggKyAxKTsKICAgIHBhdGggPSBwYXRoLnNsaWNlKDAsIHF1ZXJ5SW5kZXgpOwogIH0KICByZXR1cm4gewogICAgcGF0aDogcGF0aCwKICAgIHF1ZXJ5OiBxdWVyeSwKICAgIGhhc2g6IGhhc2gKICB9Owp9CmZ1bmN0aW9uIGNsZWFuUGF0aChwYXRoKSB7CiAgcmV0dXJuIHBhdGgucmVwbGFjZSgvXC8oPzpccypcLykrL2csICcvJyk7Cn0KdmFyIGlzYXJyYXkgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uIChhcnIpIHsKICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGFycikgPT0gJ1tvYmplY3QgQXJyYXldJzsKfTsKCi8qKgogKiBFeHBvc2UgYHBhdGhUb1JlZ2V4cGAuCiAqLwp2YXIgcGF0aFRvUmVnZXhwXzEgPSBwYXRoVG9SZWdleHA7CnZhciBwYXJzZV8xID0gcGFyc2U7CnZhciBjb21waWxlXzEgPSBjb21waWxlOwp2YXIgdG9rZW5zVG9GdW5jdGlvbl8xID0gdG9rZW5zVG9GdW5jdGlvbjsKdmFyIHRva2Vuc1RvUmVnRXhwXzEgPSB0b2tlbnNUb1JlZ0V4cDsKCi8qKgogKiBUaGUgbWFpbiBwYXRoIG1hdGNoaW5nIHJlZ2V4cCB1dGlsaXR5LgogKgogKiBAdHlwZSB7UmVnRXhwfQogKi8KdmFyIFBBVEhfUkVHRVhQID0gbmV3IFJlZ0V4cChbCi8vIE1hdGNoIGVzY2FwZWQgY2hhcmFjdGVycyB0aGF0IHdvdWxkIG90aGVyd2lzZSBhcHBlYXIgaW4gZnV0dXJlIG1hdGNoZXMuCi8vIFRoaXMgYWxsb3dzIHRoZSB1c2VyIHRvIGVzY2FwZSBzcGVjaWFsIGNoYXJhY3RlcnMgdGhhdCB3b24ndCB0cmFuc2Zvcm0uCicoXFxcXC4pJywKLy8gTWF0Y2ggRXhwcmVzcy1zdHlsZSBwYXJhbWV0ZXJzIGFuZCB1bi1uYW1lZCBwYXJhbWV0ZXJzIHdpdGggYSBwcmVmaXgKLy8gYW5kIG9wdGlvbmFsIHN1ZmZpeGVzLiBNYXRjaGVzIGFwcGVhciBhczoKLy8KLy8gIi86dGVzdChcXGQrKT8iID0+IFsiLyIsICJ0ZXN0IiwgIlxkKyIsIHVuZGVmaW5lZCwgIj8iLCB1bmRlZmluZWRdCi8vICIvcm91dGUoXFxkKykiICA9PiBbdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgIlxkKyIsIHVuZGVmaW5lZCwgdW5kZWZpbmVkXQovLyAiLyoiICAgICAgICAgICAgPT4gWyIvIiwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCAiKiJdCicoW1xcLy5dKT8oPzooPzpcXDooXFx3KykoPzpcXCgoKD86XFxcXC58W15cXFxcKCldKSspXFwpKT98XFwoKCg/OlxcXFwufFteXFxcXCgpXSkrKVxcKSkoWysqP10pP3woXFwqKSknXS5qb2luKCd8JyksICdnJyk7CgovKioKICogUGFyc2UgYSBzdHJpbmcgZm9yIHRoZSByYXcgdG9rZW5zLgogKgogKiBAcGFyYW0gIHtzdHJpbmd9ICBzdHIKICogQHBhcmFtICB7T2JqZWN0PX0gb3B0aW9ucwogKiBAcmV0dXJuIHshQXJyYXl9CiAqLwpmdW5jdGlvbiBwYXJzZShzdHIsIG9wdGlvbnMpIHsKICB2YXIgdG9rZW5zID0gW107CiAgdmFyIGtleSA9IDA7CiAgdmFyIGluZGV4ID0gMDsKICB2YXIgcGF0aCA9ICcnOwogIHZhciBkZWZhdWx0RGVsaW1pdGVyID0gb3B0aW9ucyAmJiBvcHRpb25zLmRlbGltaXRlciB8fCAnLyc7CiAgdmFyIHJlczsKICB3aGlsZSAoKHJlcyA9IFBBVEhfUkVHRVhQLmV4ZWMoc3RyKSkgIT0gbnVsbCkgewogICAgdmFyIG0gPSByZXNbMF07CiAgICB2YXIgZXNjYXBlZCA9IHJlc1sxXTsKICAgIHZhciBvZmZzZXQgPSByZXMuaW5kZXg7CiAgICBwYXRoICs9IHN0ci5zbGljZShpbmRleCwgb2Zmc2V0KTsKICAgIGluZGV4ID0gb2Zmc2V0ICsgbS5sZW5ndGg7CgogICAgLy8gSWdub3JlIGFscmVhZHkgZXNjYXBlZCBzZXF1ZW5jZXMuCiAgICBpZiAoZXNjYXBlZCkgewogICAgICBwYXRoICs9IGVzY2FwZWRbMV07CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgdmFyIG5leHQgPSBzdHJbaW5kZXhdOwogICAgdmFyIHByZWZpeCA9IHJlc1syXTsKICAgIHZhciBuYW1lID0gcmVzWzNdOwogICAgdmFyIGNhcHR1cmUgPSByZXNbNF07CiAgICB2YXIgZ3JvdXAgPSByZXNbNV07CiAgICB2YXIgbW9kaWZpZXIgPSByZXNbNl07CiAgICB2YXIgYXN0ZXJpc2sgPSByZXNbN107CgogICAgLy8gUHVzaCB0aGUgY3VycmVudCBwYXRoIG9udG8gdGhlIHRva2Vucy4KICAgIGlmIChwYXRoKSB7CiAgICAgIHRva2Vucy5wdXNoKHBhdGgpOwogICAgICBwYXRoID0gJyc7CiAgICB9CiAgICB2YXIgcGFydGlhbCA9IHByZWZpeCAhPSBudWxsICYmIG5leHQgIT0gbnVsbCAmJiBuZXh0ICE9PSBwcmVmaXg7CiAgICB2YXIgcmVwZWF0ID0gbW9kaWZpZXIgPT09ICcrJyB8fCBtb2RpZmllciA9PT0gJyonOwogICAgdmFyIG9wdGlvbmFsID0gbW9kaWZpZXIgPT09ICc/JyB8fCBtb2RpZmllciA9PT0gJyonOwogICAgdmFyIGRlbGltaXRlciA9IHJlc1syXSB8fCBkZWZhdWx0RGVsaW1pdGVyOwogICAgdmFyIHBhdHRlcm4gPSBjYXB0dXJlIHx8IGdyb3VwOwogICAgdG9rZW5zLnB1c2goewogICAgICBuYW1lOiBuYW1lIHx8IGtleSsrLAogICAgICBwcmVmaXg6IHByZWZpeCB8fCAnJywKICAgICAgZGVsaW1pdGVyOiBkZWxpbWl0ZXIsCiAgICAgIG9wdGlvbmFsOiBvcHRpb25hbCwKICAgICAgcmVwZWF0OiByZXBlYXQsCiAgICAgIHBhcnRpYWw6IHBhcnRpYWwsCiAgICAgIGFzdGVyaXNrOiAhIWFzdGVyaXNrLAogICAgICBwYXR0ZXJuOiBwYXR0ZXJuID8gZXNjYXBlR3JvdXAocGF0dGVybikgOiBhc3RlcmlzayA/ICcuKicgOiAnW14nICsgZXNjYXBlU3RyaW5nKGRlbGltaXRlcikgKyAnXSs/JwogICAgfSk7CiAgfQoKICAvLyBNYXRjaCBhbnkgY2hhcmFjdGVycyBzdGlsbCByZW1haW5pbmcuCiAgaWYgKGluZGV4IDwgc3RyLmxlbmd0aCkgewogICAgcGF0aCArPSBzdHIuc3Vic3RyKGluZGV4KTsKICB9CgogIC8vIElmIHRoZSBwYXRoIGV4aXN0cywgcHVzaCBpdCBvbnRvIHRoZSBlbmQuCiAgaWYgKHBhdGgpIHsKICAgIHRva2Vucy5wdXNoKHBhdGgpOwogIH0KICByZXR1cm4gdG9rZW5zOwp9CgovKioKICogQ29tcGlsZSBhIHN0cmluZyB0byBhIHRlbXBsYXRlIGZ1bmN0aW9uIGZvciB0aGUgcGF0aC4KICoKICogQHBhcmFtICB7c3RyaW5nfSAgICAgICAgICAgICBzdHIKICogQHBhcmFtICB7T2JqZWN0PX0gICAgICAgICAgICBvcHRpb25zCiAqIEByZXR1cm4geyFmdW5jdGlvbihPYmplY3Q9LCBPYmplY3Q9KX0KICovCmZ1bmN0aW9uIGNvbXBpbGUoc3RyLCBvcHRpb25zKSB7CiAgcmV0dXJuIHRva2Vuc1RvRnVuY3Rpb24ocGFyc2Uoc3RyLCBvcHRpb25zKSwgb3B0aW9ucyk7Cn0KCi8qKgogKiBQcmV0dGllciBlbmNvZGluZyBvZiBVUkkgcGF0aCBzZWdtZW50cy4KICoKICogQHBhcmFtICB7c3RyaW5nfQogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwpmdW5jdGlvbiBlbmNvZGVVUklDb21wb25lbnRQcmV0dHkoc3RyKSB7CiAgcmV0dXJuIGVuY29kZVVSSShzdHIpLnJlcGxhY2UoL1tcLz8jXS9nLCBmdW5jdGlvbiAoYykgewogICAgcmV0dXJuICclJyArIGMuY2hhckNvZGVBdCgwKS50b1N0cmluZygxNikudG9VcHBlckNhc2UoKTsKICB9KTsKfQoKLyoqCiAqIEVuY29kZSB0aGUgYXN0ZXJpc2sgcGFyYW1ldGVyLiBTaW1pbGFyIHRvIGBwcmV0dHlgLCBidXQgYWxsb3dzIHNsYXNoZXMuCiAqCiAqIEBwYXJhbSAge3N0cmluZ30KICogQHJldHVybiB7c3RyaW5nfQogKi8KZnVuY3Rpb24gZW5jb2RlQXN0ZXJpc2soc3RyKSB7CiAgcmV0dXJuIGVuY29kZVVSSShzdHIpLnJlcGxhY2UoL1s/I10vZywgZnVuY3Rpb24gKGMpIHsKICAgIHJldHVybiAnJScgKyBjLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCk7CiAgfSk7Cn0KCi8qKgogKiBFeHBvc2UgYSBtZXRob2QgZm9yIHRyYW5zZm9ybWluZyB0b2tlbnMgaW50byB0aGUgcGF0aCBmdW5jdGlvbi4KICovCmZ1bmN0aW9uIHRva2Vuc1RvRnVuY3Rpb24odG9rZW5zLCBvcHRpb25zKSB7CiAgLy8gQ29tcGlsZSBhbGwgdGhlIHRva2VucyBpbnRvIHJlZ2V4cHMuCiAgdmFyIG1hdGNoZXMgPSBuZXcgQXJyYXkodG9rZW5zLmxlbmd0aCk7CgogIC8vIENvbXBpbGUgYWxsIHRoZSBwYXR0ZXJucyBiZWZvcmUgY29tcGlsYXRpb24uCiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHsKICAgIGlmICh0eXBlb2YgdG9rZW5zW2ldID09PSAnb2JqZWN0JykgewogICAgICBtYXRjaGVzW2ldID0gbmV3IFJlZ0V4cCgnXig/OicgKyB0b2tlbnNbaV0ucGF0dGVybiArICcpJCcsIGZsYWdzKG9wdGlvbnMpKTsKICAgIH0KICB9CiAgcmV0dXJuIGZ1bmN0aW9uIChvYmosIG9wdHMpIHsKICAgIHZhciBwYXRoID0gJyc7CiAgICB2YXIgZGF0YSA9IG9iaiB8fCB7fTsKICAgIHZhciBvcHRpb25zID0gb3B0cyB8fCB7fTsKICAgIHZhciBlbmNvZGUgPSBvcHRpb25zLnByZXR0eSA/IGVuY29kZVVSSUNvbXBvbmVudFByZXR0eSA6IGVuY29kZVVSSUNvbXBvbmVudDsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdG9rZW5zLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciB0b2tlbiA9IHRva2Vuc1tpXTsKICAgICAgaWYgKHR5cGVvZiB0b2tlbiA9PT0gJ3N0cmluZycpIHsKICAgICAgICBwYXRoICs9IHRva2VuOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHZhciB2YWx1ZSA9IGRhdGFbdG9rZW4ubmFtZV07CiAgICAgIHZhciBzZWdtZW50OwogICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgIGlmICh0b2tlbi5vcHRpb25hbCkgewogICAgICAgICAgLy8gUHJlcGVuZCBwYXJ0aWFsIHNlZ21lbnQgcHJlZml4ZXMuCiAgICAgICAgICBpZiAodG9rZW4ucGFydGlhbCkgewogICAgICAgICAgICBwYXRoICs9IHRva2VuLnByZWZpeDsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFeHBlY3RlZCAiJyArIHRva2VuLm5hbWUgKyAnIiB0byBiZSBkZWZpbmVkJyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChpc2FycmF5KHZhbHVlKSkgewogICAgICAgIGlmICghdG9rZW4ucmVwZWF0KSB7CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFeHBlY3RlZCAiJyArIHRva2VuLm5hbWUgKyAnIiB0byBub3QgcmVwZWF0LCBidXQgcmVjZWl2ZWQgYCcgKyBKU09OLnN0cmluZ2lmeSh2YWx1ZSkgKyAnYCcpOwogICAgICAgIH0KICAgICAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICBpZiAodG9rZW4ub3B0aW9uYWwpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFeHBlY3RlZCAiJyArIHRva2VuLm5hbWUgKyAnIiB0byBub3QgYmUgZW1wdHknKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB2YWx1ZS5sZW5ndGg7IGorKykgewogICAgICAgICAgc2VnbWVudCA9IGVuY29kZSh2YWx1ZVtqXSk7CiAgICAgICAgICBpZiAoIW1hdGNoZXNbaV0udGVzdChzZWdtZW50KSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFeHBlY3RlZCBhbGwgIicgKyB0b2tlbi5uYW1lICsgJyIgdG8gbWF0Y2ggIicgKyB0b2tlbi5wYXR0ZXJuICsgJyIsIGJ1dCByZWNlaXZlZCBgJyArIEpTT04uc3RyaW5naWZ5KHNlZ21lbnQpICsgJ2AnKTsKICAgICAgICAgIH0KICAgICAgICAgIHBhdGggKz0gKGogPT09IDAgPyB0b2tlbi5wcmVmaXggOiB0b2tlbi5kZWxpbWl0ZXIpICsgc2VnbWVudDsKICAgICAgICB9CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc2VnbWVudCA9IHRva2VuLmFzdGVyaXNrID8gZW5jb2RlQXN0ZXJpc2sodmFsdWUpIDogZW5jb2RlKHZhbHVlKTsKICAgICAgaWYgKCFtYXRjaGVzW2ldLnRlc3Qoc2VnbWVudCkpIHsKICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdFeHBlY3RlZCAiJyArIHRva2VuLm5hbWUgKyAnIiB0byBtYXRjaCAiJyArIHRva2VuLnBhdHRlcm4gKyAnIiwgYnV0IHJlY2VpdmVkICInICsgc2VnbWVudCArICciJyk7CiAgICAgIH0KICAgICAgcGF0aCArPSB0b2tlbi5wcmVmaXggKyBzZWdtZW50OwogICAgfQogICAgcmV0dXJuIHBhdGg7CiAgfTsKfQoKLyoqCiAqIEVzY2FwZSBhIHJlZ3VsYXIgZXhwcmVzc2lvbiBzdHJpbmcuCiAqCiAqIEBwYXJhbSAge3N0cmluZ30gc3RyCiAqIEByZXR1cm4ge3N0cmluZ30KICovCmZ1bmN0aW9uIGVzY2FwZVN0cmluZyhzdHIpIHsKICByZXR1cm4gc3RyLnJlcGxhY2UoLyhbLisqPz1eIToke30oKVtcXXxcL1xcXSkvZywgJ1xcJDEnKTsKfQoKLyoqCiAqIEVzY2FwZSB0aGUgY2FwdHVyaW5nIGdyb3VwIGJ5IGVzY2FwaW5nIHNwZWNpYWwgY2hhcmFjdGVycyBhbmQgbWVhbmluZy4KICoKICogQHBhcmFtICB7c3RyaW5nfSBncm91cAogKiBAcmV0dXJuIHtzdHJpbmd9CiAqLwpmdW5jdGlvbiBlc2NhcGVHcm91cChncm91cCkgewogIHJldHVybiBncm91cC5yZXBsYWNlKC8oWz0hOiRcLygpXSkvZywgJ1xcJDEnKTsKfQoKLyoqCiAqIEF0dGFjaCB0aGUga2V5cyBhcyBhIHByb3BlcnR5IG9mIHRoZSByZWdleHAuCiAqCiAqIEBwYXJhbSAgeyFSZWdFeHB9IHJlCiAqIEBwYXJhbSAge0FycmF5fSAgIGtleXMKICogQHJldHVybiB7IVJlZ0V4cH0KICovCmZ1bmN0aW9uIGF0dGFjaEtleXMocmUsIGtleXMpIHsKICByZS5rZXlzID0ga2V5czsKICByZXR1cm4gcmU7Cn0KCi8qKgogKiBHZXQgdGhlIGZsYWdzIGZvciBhIHJlZ2V4cCBmcm9tIHRoZSBvcHRpb25zLgogKgogKiBAcGFyYW0gIHtPYmplY3R9IG9wdGlvbnMKICogQHJldHVybiB7c3RyaW5nfQogKi8KZnVuY3Rpb24gZmxhZ3Mob3B0aW9ucykgewogIHJldHVybiBvcHRpb25zICYmIG9wdGlvbnMuc2Vuc2l0aXZlID8gJycgOiAnaSc7Cn0KCi8qKgogKiBQdWxsIG91dCBrZXlzIGZyb20gYSByZWdleHAuCiAqCiAqIEBwYXJhbSAgeyFSZWdFeHB9IHBhdGgKICogQHBhcmFtICB7IUFycmF5fSAga2V5cwogKiBAcmV0dXJuIHshUmVnRXhwfQogKi8KZnVuY3Rpb24gcmVnZXhwVG9SZWdleHAocGF0aCwga2V5cykgewogIC8vIFVzZSBhIG5lZ2F0aXZlIGxvb2thaGVhZCB0byBtYXRjaCBvbmx5IGNhcHR1cmluZyBncm91cHMuCiAgdmFyIGdyb3VwcyA9IHBhdGguc291cmNlLm1hdGNoKC9cKCg/IVw/KS9nKTsKICBpZiAoZ3JvdXBzKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdyb3Vwcy5sZW5ndGg7IGkrKykgewogICAgICBrZXlzLnB1c2goewogICAgICAgIG5hbWU6IGksCiAgICAgICAgcHJlZml4OiBudWxsLAogICAgICAgIGRlbGltaXRlcjogbnVsbCwKICAgICAgICBvcHRpb25hbDogZmFsc2UsCiAgICAgICAgcmVwZWF0OiBmYWxzZSwKICAgICAgICBwYXJ0aWFsOiBmYWxzZSwKICAgICAgICBhc3RlcmlzazogZmFsc2UsCiAgICAgICAgcGF0dGVybjogbnVsbAogICAgICB9KTsKICAgIH0KICB9CiAgcmV0dXJuIGF0dGFjaEtleXMocGF0aCwga2V5cyk7Cn0KCi8qKgogKiBUcmFuc2Zvcm0gYW4gYXJyYXkgaW50byBhIHJlZ2V4cC4KICoKICogQHBhcmFtICB7IUFycmF5fSAgcGF0aAogKiBAcGFyYW0gIHtBcnJheX0gICBrZXlzCiAqIEBwYXJhbSAgeyFPYmplY3R9IG9wdGlvbnMKICogQHJldHVybiB7IVJlZ0V4cH0KICovCmZ1bmN0aW9uIGFycmF5VG9SZWdleHAocGF0aCwga2V5cywgb3B0aW9ucykgewogIHZhciBwYXJ0cyA9IFtdOwogIGZvciAodmFyIGkgPSAwOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykgewogICAgcGFydHMucHVzaChwYXRoVG9SZWdleHAocGF0aFtpXSwga2V5cywgb3B0aW9ucykuc291cmNlKTsKICB9CiAgdmFyIHJlZ2V4cCA9IG5ldyBSZWdFeHAoJyg/OicgKyBwYXJ0cy5qb2luKCd8JykgKyAnKScsIGZsYWdzKG9wdGlvbnMpKTsKICByZXR1cm4gYXR0YWNoS2V5cyhyZWdleHAsIGtleXMpOwp9CgovKioKICogQ3JlYXRlIGEgcGF0aCByZWdleHAgZnJvbSBzdHJpbmcgaW5wdXQuCiAqCiAqIEBwYXJhbSAge3N0cmluZ30gIHBhdGgKICogQHBhcmFtICB7IUFycmF5fSAga2V5cwogKiBAcGFyYW0gIHshT2JqZWN0fSBvcHRpb25zCiAqIEByZXR1cm4geyFSZWdFeHB9CiAqLwpmdW5jdGlvbiBzdHJpbmdUb1JlZ2V4cChwYXRoLCBrZXlzLCBvcHRpb25zKSB7CiAgcmV0dXJuIHRva2Vuc1RvUmVnRXhwKHBhcnNlKHBhdGgsIG9wdGlvbnMpLCBrZXlzLCBvcHRpb25zKTsKfQoKLyoqCiAqIEV4cG9zZSBhIGZ1bmN0aW9uIGZvciB0YWtpbmcgdG9rZW5zIGFuZCByZXR1cm5pbmcgYSBSZWdFeHAuCiAqCiAqIEBwYXJhbSAgeyFBcnJheX0gICAgICAgICAgdG9rZW5zCiAqIEBwYXJhbSAgeyhBcnJheXxPYmplY3QpPX0ga2V5cwogKiBAcGFyYW0gIHtPYmplY3Q9fSAgICAgICAgIG9wdGlvbnMKICogQHJldHVybiB7IVJlZ0V4cH0KICovCmZ1bmN0aW9uIHRva2Vuc1RvUmVnRXhwKHRva2Vucywga2V5cywgb3B0aW9ucykgewogIGlmICghaXNhcnJheShrZXlzKSkgewogICAgb3B0aW9ucyA9IC8qKiBAdHlwZSB7IU9iamVjdH0gKi9rZXlzIHx8IG9wdGlvbnM7CiAgICBrZXlzID0gW107CiAgfQogIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9OwogIHZhciBzdHJpY3QgPSBvcHRpb25zLnN0cmljdDsKICB2YXIgZW5kID0gb3B0aW9ucy5lbmQgIT09IGZhbHNlOwogIHZhciByb3V0ZSA9ICcnOwoKICAvLyBJdGVyYXRlIG92ZXIgdGhlIHRva2VucyBhbmQgY3JlYXRlIG91ciByZWdleHAgc3RyaW5nLgogIGZvciAodmFyIGkgPSAwOyBpIDwgdG9rZW5zLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgdG9rZW4gPSB0b2tlbnNbaV07CiAgICBpZiAodHlwZW9mIHRva2VuID09PSAnc3RyaW5nJykgewogICAgICByb3V0ZSArPSBlc2NhcGVTdHJpbmcodG9rZW4pOwogICAgfSBlbHNlIHsKICAgICAgdmFyIHByZWZpeCA9IGVzY2FwZVN0cmluZyh0b2tlbi5wcmVmaXgpOwogICAgICB2YXIgY2FwdHVyZSA9ICcoPzonICsgdG9rZW4ucGF0dGVybiArICcpJzsKICAgICAga2V5cy5wdXNoKHRva2VuKTsKICAgICAgaWYgKHRva2VuLnJlcGVhdCkgewogICAgICAgIGNhcHR1cmUgKz0gJyg/OicgKyBwcmVmaXggKyBjYXB0dXJlICsgJykqJzsKICAgICAgfQogICAgICBpZiAodG9rZW4ub3B0aW9uYWwpIHsKICAgICAgICBpZiAoIXRva2VuLnBhcnRpYWwpIHsKICAgICAgICAgIGNhcHR1cmUgPSAnKD86JyArIHByZWZpeCArICcoJyArIGNhcHR1cmUgKyAnKSk/JzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY2FwdHVyZSA9IHByZWZpeCArICcoJyArIGNhcHR1cmUgKyAnKT8nOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBjYXB0dXJlID0gcHJlZml4ICsgJygnICsgY2FwdHVyZSArICcpJzsKICAgICAgfQogICAgICByb3V0ZSArPSBjYXB0dXJlOwogICAgfQogIH0KICB2YXIgZGVsaW1pdGVyID0gZXNjYXBlU3RyaW5nKG9wdGlvbnMuZGVsaW1pdGVyIHx8ICcvJyk7CiAgdmFyIGVuZHNXaXRoRGVsaW1pdGVyID0gcm91dGUuc2xpY2UoLWRlbGltaXRlci5sZW5ndGgpID09PSBkZWxpbWl0ZXI7CgogIC8vIEluIG5vbi1zdHJpY3QgbW9kZSB3ZSBhbGxvdyBhIHNsYXNoIGF0IHRoZSBlbmQgb2YgbWF0Y2guIElmIHRoZSBwYXRoIHRvCiAgLy8gbWF0Y2ggYWxyZWFkeSBlbmRzIHdpdGggYSBzbGFzaCwgd2UgcmVtb3ZlIGl0IGZvciBjb25zaXN0ZW5jeS4gVGhlIHNsYXNoCiAgLy8gaXMgdmFsaWQgYXQgdGhlIGVuZCBvZiBhIHBhdGggbWF0Y2gsIG5vdCBpbiB0aGUgbWlkZGxlLiBUaGlzIGlzIGltcG9ydGFudAogIC8vIGluIG5vbi1lbmRpbmcgbW9kZSwgd2hlcmUgIi90ZXN0LyIgc2hvdWxkbid0IG1hdGNoICIvdGVzdC8vcm91dGUiLgogIGlmICghc3RyaWN0KSB7CiAgICByb3V0ZSA9IChlbmRzV2l0aERlbGltaXRlciA/IHJvdXRlLnNsaWNlKDAsIC1kZWxpbWl0ZXIubGVuZ3RoKSA6IHJvdXRlKSArICcoPzonICsgZGVsaW1pdGVyICsgJyg/PSQpKT8nOwogIH0KICBpZiAoZW5kKSB7CiAgICByb3V0ZSArPSAnJCc7CiAgfSBlbHNlIHsKICAgIC8vIEluIG5vbi1lbmRpbmcgbW9kZSwgd2UgbmVlZCB0aGUgY2FwdHVyaW5nIGdyb3VwcyB0byBtYXRjaCBhcyBtdWNoIGFzCiAgICAvLyBwb3NzaWJsZSBieSB1c2luZyBhIHBvc2l0aXZlIGxvb2thaGVhZCB0byB0aGUgZW5kIG9yIG5leHQgcGF0aCBzZWdtZW50LgogICAgcm91dGUgKz0gc3RyaWN0ICYmIGVuZHNXaXRoRGVsaW1pdGVyID8gJycgOiAnKD89JyArIGRlbGltaXRlciArICd8JCknOwogIH0KICByZXR1cm4gYXR0YWNoS2V5cyhuZXcgUmVnRXhwKCdeJyArIHJvdXRlLCBmbGFncyhvcHRpb25zKSksIGtleXMpOwp9CgovKioKICogTm9ybWFsaXplIHRoZSBnaXZlbiBwYXRoIHN0cmluZywgcmV0dXJuaW5nIGEgcmVndWxhciBleHByZXNzaW9uLgogKgogKiBBbiBlbXB0eSBhcnJheSBjYW4gYmUgcGFzc2VkIGluIGZvciB0aGUga2V5cywgd2hpY2ggd2lsbCBob2xkIHRoZQogKiBwbGFjZWhvbGRlciBrZXkgZGVzY3JpcHRpb25zLiBGb3IgZXhhbXBsZSwgdXNpbmcgYC91c2VyLzppZGAsIGBrZXlzYCB3aWxsCiAqIGNvbnRhaW4gYFt7IG5hbWU6ICdpZCcsIGRlbGltaXRlcjogJy8nLCBvcHRpb25hbDogZmFsc2UsIHJlcGVhdDogZmFsc2UgfV1gLgogKgogKiBAcGFyYW0gIHsoc3RyaW5nfFJlZ0V4cHxBcnJheSl9IHBhdGgKICogQHBhcmFtICB7KEFycmF5fE9iamVjdCk9fSAgICAgICBrZXlzCiAqIEBwYXJhbSAge09iamVjdD19ICAgICAgICAgICAgICAgb3B0aW9ucwogKiBAcmV0dXJuIHshUmVnRXhwfQogKi8KZnVuY3Rpb24gcGF0aFRvUmVnZXhwKHBhdGgsIGtleXMsIG9wdGlvbnMpIHsKICBpZiAoIWlzYXJyYXkoa2V5cykpIHsKICAgIG9wdGlvbnMgPSAvKiogQHR5cGUgeyFPYmplY3R9ICova2V5cyB8fCBvcHRpb25zOwogICAga2V5cyA9IFtdOwogIH0KICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKICBpZiAocGF0aCBpbnN0YW5jZW9mIFJlZ0V4cCkgewogICAgcmV0dXJuIHJlZ2V4cFRvUmVnZXhwKHBhdGgsIC8qKiBAdHlwZSB7IUFycmF5fSAqL2tleXMpOwogIH0KICBpZiAoaXNhcnJheShwYXRoKSkgewogICAgcmV0dXJuIGFycmF5VG9SZWdleHAoLyoqIEB0eXBlIHshQXJyYXl9ICovcGF0aCwgLyoqIEB0eXBlIHshQXJyYXl9ICova2V5cywgb3B0aW9ucyk7CiAgfQogIHJldHVybiBzdHJpbmdUb1JlZ2V4cCgvKiogQHR5cGUge3N0cmluZ30gKi9wYXRoLCAvKiogQHR5cGUgeyFBcnJheX0gKi9rZXlzLCBvcHRpb25zKTsKfQpwYXRoVG9SZWdleHBfMS5wYXJzZSA9IHBhcnNlXzE7CnBhdGhUb1JlZ2V4cF8xLmNvbXBpbGUgPSBjb21waWxlXzE7CnBhdGhUb1JlZ2V4cF8xLnRva2Vuc1RvRnVuY3Rpb24gPSB0b2tlbnNUb0Z1bmN0aW9uXzE7CnBhdGhUb1JlZ2V4cF8xLnRva2Vuc1RvUmVnRXhwID0gdG9rZW5zVG9SZWdFeHBfMTsKCi8qICAqLwoKLy8gJGZsb3ctZGlzYWJsZS1saW5lCnZhciByZWdleHBDb21waWxlQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwpmdW5jdGlvbiBmaWxsUGFyYW1zKHBhdGgsIHBhcmFtcywgcm91dGVNc2cpIHsKICBwYXJhbXMgPSBwYXJhbXMgfHwge307CiAgdHJ5IHsKICAgIHZhciBmaWxsZXIgPSByZWdleHBDb21waWxlQ2FjaGVbcGF0aF0gfHwgKHJlZ2V4cENvbXBpbGVDYWNoZVtwYXRoXSA9IHBhdGhUb1JlZ2V4cF8xLmNvbXBpbGUocGF0aCkpOwoKICAgIC8vIEZpeCAjMjUwNSByZXNvbHZpbmcgYXN0ZXJpc2sgcm91dGVzIHsgbmFtZTogJ25vdC1mb3VuZCcsIHBhcmFtczogeyBwYXRoTWF0Y2g6ICcvbm90LWZvdW5kJyB9fQogICAgLy8gYW5kIGZpeCAjMzEwNiBzbyB0aGF0IHlvdSBjYW4gd29yayB3aXRoIGxvY2F0aW9uIGRlc2NyaXB0b3Igb2JqZWN0IGhhdmluZyBwYXJhbXMucGF0aE1hdGNoIGVxdWFsIHRvIGVtcHR5IHN0cmluZwogICAgaWYgKHR5cGVvZiBwYXJhbXMucGF0aE1hdGNoID09PSAnc3RyaW5nJykgewogICAgICBwYXJhbXNbMF0gPSBwYXJhbXMucGF0aE1hdGNoOwogICAgfQogICAgcmV0dXJuIGZpbGxlcihwYXJhbXMsIHsKICAgICAgcHJldHR5OiB0cnVlCiAgICB9KTsKICB9IGNhdGNoIChlKSB7CiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAvLyBGaXggIzMwNzIgbm8gd2FybiBpZiBgcGF0aE1hdGNoYCBpcyBzdHJpbmcKICAgICAgd2Fybih0eXBlb2YgcGFyYW1zLnBhdGhNYXRjaCA9PT0gJ3N0cmluZycsICJtaXNzaW5nIHBhcmFtIGZvciAiICsgcm91dGVNc2cgKyAiOiAiICsgZS5tZXNzYWdlKTsKICAgIH0KICAgIHJldHVybiAnJzsKICB9IGZpbmFsbHkgewogICAgLy8gZGVsZXRlIHRoZSAwIGlmIGl0IHdhcyBhZGRlZAogICAgZGVsZXRlIHBhcmFtc1swXTsKICB9Cn0KCi8qICAqLwoKZnVuY3Rpb24gbm9ybWFsaXplTG9jYXRpb24ocmF3LCBjdXJyZW50LCBhcHBlbmQsIHJvdXRlcikgewogIHZhciBuZXh0ID0gdHlwZW9mIHJhdyA9PT0gJ3N0cmluZycgPyB7CiAgICBwYXRoOiByYXcKICB9IDogcmF3OwogIC8vIG5hbWVkIHRhcmdldAogIGlmIChuZXh0Ll9ub3JtYWxpemVkKSB7CiAgICByZXR1cm4gbmV4dDsKICB9IGVsc2UgaWYgKG5leHQubmFtZSkgewogICAgbmV4dCA9IGV4dGVuZCh7fSwgcmF3KTsKICAgIHZhciBwYXJhbXMgPSBuZXh0LnBhcmFtczsKICAgIGlmIChwYXJhbXMgJiYgdHlwZW9mIHBhcmFtcyA9PT0gJ29iamVjdCcpIHsKICAgICAgbmV4dC5wYXJhbXMgPSBleHRlbmQoe30sIHBhcmFtcyk7CiAgICB9CiAgICByZXR1cm4gbmV4dDsKICB9CgogIC8vIHJlbGF0aXZlIHBhcmFtcwogIGlmICghbmV4dC5wYXRoICYmIG5leHQucGFyYW1zICYmIGN1cnJlbnQpIHsKICAgIG5leHQgPSBleHRlbmQoe30sIG5leHQpOwogICAgbmV4dC5fbm9ybWFsaXplZCA9IHRydWU7CiAgICB2YXIgcGFyYW1zJDEgPSBleHRlbmQoZXh0ZW5kKHt9LCBjdXJyZW50LnBhcmFtcyksIG5leHQucGFyYW1zKTsKICAgIGlmIChjdXJyZW50Lm5hbWUpIHsKICAgICAgbmV4dC5uYW1lID0gY3VycmVudC5uYW1lOwogICAgICBuZXh0LnBhcmFtcyA9IHBhcmFtcyQxOwogICAgfSBlbHNlIGlmIChjdXJyZW50Lm1hdGNoZWQubGVuZ3RoKSB7CiAgICAgIHZhciByYXdQYXRoID0gY3VycmVudC5tYXRjaGVkW2N1cnJlbnQubWF0Y2hlZC5sZW5ndGggLSAxXS5wYXRoOwogICAgICBuZXh0LnBhdGggPSBmaWxsUGFyYW1zKHJhd1BhdGgsIHBhcmFtcyQxLCAicGF0aCAiICsgY3VycmVudC5wYXRoKTsKICAgIH0gZWxzZSBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICB3YXJuKGZhbHNlLCAicmVsYXRpdmUgcGFyYW1zIG5hdmlnYXRpb24gcmVxdWlyZXMgYSBjdXJyZW50IHJvdXRlLiIpOwogICAgfQogICAgcmV0dXJuIG5leHQ7CiAgfQogIHZhciBwYXJzZWRQYXRoID0gcGFyc2VQYXRoKG5leHQucGF0aCB8fCAnJyk7CiAgdmFyIGJhc2VQYXRoID0gY3VycmVudCAmJiBjdXJyZW50LnBhdGggfHwgJy8nOwogIHZhciBwYXRoID0gcGFyc2VkUGF0aC5wYXRoID8gcmVzb2x2ZVBhdGgocGFyc2VkUGF0aC5wYXRoLCBiYXNlUGF0aCwgYXBwZW5kIHx8IG5leHQuYXBwZW5kKSA6IGJhc2VQYXRoOwogIHZhciBxdWVyeSA9IHJlc29sdmVRdWVyeShwYXJzZWRQYXRoLnF1ZXJ5LCBuZXh0LnF1ZXJ5LCByb3V0ZXIgJiYgcm91dGVyLm9wdGlvbnMucGFyc2VRdWVyeSk7CiAgdmFyIGhhc2ggPSBuZXh0Lmhhc2ggfHwgcGFyc2VkUGF0aC5oYXNoOwogIGlmIChoYXNoICYmIGhhc2guY2hhckF0KDApICE9PSAnIycpIHsKICAgIGhhc2ggPSAiIyIgKyBoYXNoOwogIH0KICByZXR1cm4gewogICAgX25vcm1hbGl6ZWQ6IHRydWUsCiAgICBwYXRoOiBwYXRoLAogICAgcXVlcnk6IHF1ZXJ5LAogICAgaGFzaDogaGFzaAogIH07Cn0KCi8qICAqLwoKLy8gd29yayBhcm91bmQgd2VpcmQgZmxvdyBidWcKdmFyIHRvVHlwZXMgPSBbU3RyaW5nLCBPYmplY3RdOwp2YXIgZXZlbnRUeXBlcyA9IFtTdHJpbmcsIEFycmF5XTsKdmFyIG5vb3AgPSBmdW5jdGlvbiAoKSB7fTsKdmFyIHdhcm5lZEN1c3RvbVNsb3Q7CnZhciB3YXJuZWRUYWdQcm9wOwp2YXIgd2FybmVkRXZlbnRQcm9wOwp2YXIgTGluayA9IHsKICBuYW1lOiAnUm91dGVyTGluaycsCiAgcHJvcHM6IHsKICAgIHRvOiB7CiAgICAgIHR5cGU6IHRvVHlwZXMsCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICB9LAogICAgdGFnOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogJ2EnCiAgICB9LAogICAgY3VzdG9tOiBCb29sZWFuLAogICAgZXhhY3Q6IEJvb2xlYW4sCiAgICBleGFjdFBhdGg6IEJvb2xlYW4sCiAgICBhcHBlbmQ6IEJvb2xlYW4sCiAgICByZXBsYWNlOiBCb29sZWFuLAogICAgYWN0aXZlQ2xhc3M6IFN0cmluZywKICAgIGV4YWN0QWN0aXZlQ2xhc3M6IFN0cmluZywKICAgIGFyaWFDdXJyZW50VmFsdWU6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAncGFnZScKICAgIH0sCiAgICBldmVudDogewogICAgICB0eXBlOiBldmVudFR5cGVzLAogICAgICBkZWZhdWx0OiAnY2xpY2snCiAgICB9CiAgfSwKICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihoKSB7CiAgICB2YXIgdGhpcyQxJDEgPSB0aGlzOwogICAgdmFyIHJvdXRlciA9IHRoaXMuJHJvdXRlcjsKICAgIHZhciBjdXJyZW50ID0gdGhpcy4kcm91dGU7CiAgICB2YXIgcmVmID0gcm91dGVyLnJlc29sdmUodGhpcy50bywgY3VycmVudCwgdGhpcy5hcHBlbmQpOwogICAgdmFyIGxvY2F0aW9uID0gcmVmLmxvY2F0aW9uOwogICAgdmFyIHJvdXRlID0gcmVmLnJvdXRlOwogICAgdmFyIGhyZWYgPSByZWYuaHJlZjsKICAgIHZhciBjbGFzc2VzID0ge307CiAgICB2YXIgZ2xvYmFsQWN0aXZlQ2xhc3MgPSByb3V0ZXIub3B0aW9ucy5saW5rQWN0aXZlQ2xhc3M7CiAgICB2YXIgZ2xvYmFsRXhhY3RBY3RpdmVDbGFzcyA9IHJvdXRlci5vcHRpb25zLmxpbmtFeGFjdEFjdGl2ZUNsYXNzOwogICAgLy8gU3VwcG9ydCBnbG9iYWwgZW1wdHkgYWN0aXZlIGNsYXNzCiAgICB2YXIgYWN0aXZlQ2xhc3NGYWxsYmFjayA9IGdsb2JhbEFjdGl2ZUNsYXNzID09IG51bGwgPyAncm91dGVyLWxpbmstYWN0aXZlJyA6IGdsb2JhbEFjdGl2ZUNsYXNzOwogICAgdmFyIGV4YWN0QWN0aXZlQ2xhc3NGYWxsYmFjayA9IGdsb2JhbEV4YWN0QWN0aXZlQ2xhc3MgPT0gbnVsbCA/ICdyb3V0ZXItbGluay1leGFjdC1hY3RpdmUnIDogZ2xvYmFsRXhhY3RBY3RpdmVDbGFzczsKICAgIHZhciBhY3RpdmVDbGFzcyA9IHRoaXMuYWN0aXZlQ2xhc3MgPT0gbnVsbCA/IGFjdGl2ZUNsYXNzRmFsbGJhY2sgOiB0aGlzLmFjdGl2ZUNsYXNzOwogICAgdmFyIGV4YWN0QWN0aXZlQ2xhc3MgPSB0aGlzLmV4YWN0QWN0aXZlQ2xhc3MgPT0gbnVsbCA/IGV4YWN0QWN0aXZlQ2xhc3NGYWxsYmFjayA6IHRoaXMuZXhhY3RBY3RpdmVDbGFzczsKICAgIHZhciBjb21wYXJlVGFyZ2V0ID0gcm91dGUucmVkaXJlY3RlZEZyb20gPyBjcmVhdGVSb3V0ZShudWxsLCBub3JtYWxpemVMb2NhdGlvbihyb3V0ZS5yZWRpcmVjdGVkRnJvbSksIG51bGwsIHJvdXRlcikgOiByb3V0ZTsKICAgIGNsYXNzZXNbZXhhY3RBY3RpdmVDbGFzc10gPSBpc1NhbWVSb3V0ZShjdXJyZW50LCBjb21wYXJlVGFyZ2V0LCB0aGlzLmV4YWN0UGF0aCk7CiAgICBjbGFzc2VzW2FjdGl2ZUNsYXNzXSA9IHRoaXMuZXhhY3QgfHwgdGhpcy5leGFjdFBhdGggPyBjbGFzc2VzW2V4YWN0QWN0aXZlQ2xhc3NdIDogaXNJbmNsdWRlZFJvdXRlKGN1cnJlbnQsIGNvbXBhcmVUYXJnZXQpOwogICAgdmFyIGFyaWFDdXJyZW50VmFsdWUgPSBjbGFzc2VzW2V4YWN0QWN0aXZlQ2xhc3NdID8gdGhpcy5hcmlhQ3VycmVudFZhbHVlIDogbnVsbDsKICAgIHZhciBoYW5kbGVyID0gZnVuY3Rpb24gKGUpIHsKICAgICAgaWYgKGd1YXJkRXZlbnQoZSkpIHsKICAgICAgICBpZiAodGhpcyQxJDEucmVwbGFjZSkgewogICAgICAgICAgcm91dGVyLnJlcGxhY2UobG9jYXRpb24sIG5vb3ApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByb3V0ZXIucHVzaChsb2NhdGlvbiwgbm9vcCk7CiAgICAgICAgfQogICAgICB9CiAgICB9OwogICAgdmFyIG9uID0gewogICAgICBjbGljazogZ3VhcmRFdmVudAogICAgfTsKICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMuZXZlbnQpKSB7CiAgICAgIHRoaXMuZXZlbnQuZm9yRWFjaChmdW5jdGlvbiAoZSkgewogICAgICAgIG9uW2VdID0gaGFuZGxlcjsKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBvblt0aGlzLmV2ZW50XSA9IGhhbmRsZXI7CiAgICB9CiAgICB2YXIgZGF0YSA9IHsKICAgICAgY2xhc3M6IGNsYXNzZXMKICAgIH07CiAgICB2YXIgc2NvcGVkU2xvdCA9ICF0aGlzLiRzY29wZWRTbG90cy4kaGFzTm9ybWFsICYmIHRoaXMuJHNjb3BlZFNsb3RzLmRlZmF1bHQgJiYgdGhpcy4kc2NvcGVkU2xvdHMuZGVmYXVsdCh7CiAgICAgIGhyZWY6IGhyZWYsCiAgICAgIHJvdXRlOiByb3V0ZSwKICAgICAgbmF2aWdhdGU6IGhhbmRsZXIsCiAgICAgIGlzQWN0aXZlOiBjbGFzc2VzW2FjdGl2ZUNsYXNzXSwKICAgICAgaXNFeGFjdEFjdGl2ZTogY2xhc3Nlc1tleGFjdEFjdGl2ZUNsYXNzXQogICAgfSk7CiAgICBpZiAoc2NvcGVkU2xvdCkgewogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhdGhpcy5jdXN0b20pIHsKICAgICAgICAhd2FybmVkQ3VzdG9tU2xvdCAmJiB3YXJuKGZhbHNlLCAnSW4gVnVlIFJvdXRlciA0LCB0aGUgdi1zbG90IEFQSSB3aWxsIGJ5IGRlZmF1bHQgd3JhcCBpdHMgY29udGVudCB3aXRoIGFuIDxhPiBlbGVtZW50LiBVc2UgdGhlIGN1c3RvbSBwcm9wIHRvIHJlbW92ZSB0aGlzIHdhcm5pbmc6XG48cm91dGVyLWxpbmsgdi1zbG90PSJ7IG5hdmlnYXRlLCBocmVmIH0iIGN1c3RvbT48L3JvdXRlci1saW5rPlxuJyk7CiAgICAgICAgd2FybmVkQ3VzdG9tU2xvdCA9IHRydWU7CiAgICAgIH0KICAgICAgaWYgKHNjb3BlZFNsb3QubGVuZ3RoID09PSAxKSB7CiAgICAgICAgcmV0dXJuIHNjb3BlZFNsb3RbMF07CiAgICAgIH0gZWxzZSBpZiAoc2NvcGVkU2xvdC5sZW5ndGggPiAxIHx8ICFzY29wZWRTbG90Lmxlbmd0aCkgewogICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICB3YXJuKGZhbHNlLCAiPHJvdXRlci1saW5rPiB3aXRoIHRvPVwiIiArIHRoaXMudG8gKyAiXCIgaXMgdHJ5aW5nIHRvIHVzZSBhIHNjb3BlZCBzbG90IGJ1dCBpdCBkaWRuJ3QgcHJvdmlkZSBleGFjdGx5IG9uZSBjaGlsZC4gV3JhcHBpbmcgdGhlIGNvbnRlbnQgd2l0aCBhIHNwYW4gZWxlbWVudC4iKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNjb3BlZFNsb3QubGVuZ3RoID09PSAwID8gaCgpIDogaCgnc3BhbicsIHt9LCBzY29wZWRTbG90KTsKICAgICAgfQogICAgfQogICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgaWYgKCd0YWcnIGluIHRoaXMuJG9wdGlvbnMucHJvcHNEYXRhICYmICF3YXJuZWRUYWdQcm9wKSB7CiAgICAgICAgd2FybihmYWxzZSwgIjxyb3V0ZXItbGluaz4ncyB0YWcgcHJvcCBpcyBkZXByZWNhdGVkIGFuZCBoYXMgYmVlbiByZW1vdmVkIGluIFZ1ZSBSb3V0ZXIgNC4gVXNlIHRoZSB2LXNsb3QgQVBJIHRvIHJlbW92ZSB0aGlzIHdhcm5pbmc6IGh0dHBzOi8vbmV4dC5yb3V0ZXIudnVlanMub3JnL2d1aWRlL21pZ3JhdGlvbi8jcmVtb3ZhbC1vZi1ldmVudC1hbmQtdGFnLXByb3BzLWluLXJvdXRlci1saW5rLiIpOwogICAgICAgIHdhcm5lZFRhZ1Byb3AgPSB0cnVlOwogICAgICB9CiAgICAgIGlmICgnZXZlbnQnIGluIHRoaXMuJG9wdGlvbnMucHJvcHNEYXRhICYmICF3YXJuZWRFdmVudFByb3ApIHsKICAgICAgICB3YXJuKGZhbHNlLCAiPHJvdXRlci1saW5rPidzIGV2ZW50IHByb3AgaXMgZGVwcmVjYXRlZCBhbmQgaGFzIGJlZW4gcmVtb3ZlZCBpbiBWdWUgUm91dGVyIDQuIFVzZSB0aGUgdi1zbG90IEFQSSB0byByZW1vdmUgdGhpcyB3YXJuaW5nOiBodHRwczovL25leHQucm91dGVyLnZ1ZWpzLm9yZy9ndWlkZS9taWdyYXRpb24vI3JlbW92YWwtb2YtZXZlbnQtYW5kLXRhZy1wcm9wcy1pbi1yb3V0ZXItbGluay4iKTsKICAgICAgICB3YXJuZWRFdmVudFByb3AgPSB0cnVlOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy50YWcgPT09ICdhJykgewogICAgICBkYXRhLm9uID0gb247CiAgICAgIGRhdGEuYXR0cnMgPSB7CiAgICAgICAgaHJlZjogaHJlZiwKICAgICAgICAnYXJpYS1jdXJyZW50JzogYXJpYUN1cnJlbnRWYWx1ZQogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgLy8gZmluZCB0aGUgZmlyc3QgPGE+IGNoaWxkIGFuZCBhcHBseSBsaXN0ZW5lciBhbmQgaHJlZgogICAgICB2YXIgYSA9IGZpbmRBbmNob3IodGhpcy4kc2xvdHMuZGVmYXVsdCk7CiAgICAgIGlmIChhKSB7CiAgICAgICAgLy8gaW4gY2FzZSB0aGUgPGE+IGlzIGEgc3RhdGljIG5vZGUKICAgICAgICBhLmlzU3RhdGljID0gZmFsc2U7CiAgICAgICAgdmFyIGFEYXRhID0gYS5kYXRhID0gZXh0ZW5kKHt9LCBhLmRhdGEpOwogICAgICAgIGFEYXRhLm9uID0gYURhdGEub24gfHwge307CiAgICAgICAgLy8gdHJhbnNmb3JtIGV4aXN0aW5nIGV2ZW50cyBpbiBib3RoIG9iamVjdHMgaW50byBhcnJheXMgc28gd2UgY2FuIHB1c2ggbGF0ZXIKICAgICAgICBmb3IgKHZhciBldmVudCBpbiBhRGF0YS5vbikgewogICAgICAgICAgdmFyIGhhbmRsZXIkMSA9IGFEYXRhLm9uW2V2ZW50XTsKICAgICAgICAgIGlmIChldmVudCBpbiBvbikgewogICAgICAgICAgICBhRGF0YS5vbltldmVudF0gPSBBcnJheS5pc0FycmF5KGhhbmRsZXIkMSkgPyBoYW5kbGVyJDEgOiBbaGFuZGxlciQxXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gYXBwZW5kIG5ldyBsaXN0ZW5lcnMgZm9yIHJvdXRlci1saW5rCiAgICAgICAgZm9yICh2YXIgZXZlbnQkMSBpbiBvbikgewogICAgICAgICAgaWYgKGV2ZW50JDEgaW4gYURhdGEub24pIHsKICAgICAgICAgICAgLy8gb25bZXZlbnRdIGlzIGFsd2F5cyBhIGZ1bmN0aW9uCiAgICAgICAgICAgIGFEYXRhLm9uW2V2ZW50JDFdLnB1c2gob25bZXZlbnQkMV0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYURhdGEub25bZXZlbnQkMV0gPSBoYW5kbGVyOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB2YXIgYUF0dHJzID0gYS5kYXRhLmF0dHJzID0gZXh0ZW5kKHt9LCBhLmRhdGEuYXR0cnMpOwogICAgICAgIGFBdHRycy5ocmVmID0gaHJlZjsKICAgICAgICBhQXR0cnNbJ2FyaWEtY3VycmVudCddID0gYXJpYUN1cnJlbnRWYWx1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBkb2Vzbid0IGhhdmUgPGE+IGNoaWxkLCBhcHBseSBsaXN0ZW5lciB0byBzZWxmCiAgICAgICAgZGF0YS5vbiA9IG9uOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gaCh0aGlzLnRhZywgZGF0YSwgdGhpcy4kc2xvdHMuZGVmYXVsdCk7CiAgfQp9OwpmdW5jdGlvbiBndWFyZEV2ZW50KGUpIHsKICAvLyBkb24ndCByZWRpcmVjdCB3aXRoIGNvbnRyb2wga2V5cwogIGlmIChlLm1ldGFLZXkgfHwgZS5hbHRLZXkgfHwgZS5jdHJsS2V5IHx8IGUuc2hpZnRLZXkpIHsKICAgIHJldHVybjsKICB9CiAgLy8gZG9uJ3QgcmVkaXJlY3Qgd2hlbiBwcmV2ZW50RGVmYXVsdCBjYWxsZWQKICBpZiAoZS5kZWZhdWx0UHJldmVudGVkKSB7CiAgICByZXR1cm47CiAgfQogIC8vIGRvbid0IHJlZGlyZWN0IG9uIHJpZ2h0IGNsaWNrCiAgaWYgKGUuYnV0dG9uICE9PSB1bmRlZmluZWQgJiYgZS5idXR0b24gIT09IDApIHsKICAgIHJldHVybjsKICB9CiAgLy8gZG9uJ3QgcmVkaXJlY3QgaWYgYHRhcmdldD0iX2JsYW5rImAKICBpZiAoZS5jdXJyZW50VGFyZ2V0ICYmIGUuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUpIHsKICAgIHZhciB0YXJnZXQgPSBlLmN1cnJlbnRUYXJnZXQuZ2V0QXR0cmlidXRlKCd0YXJnZXQnKTsKICAgIGlmICgvXGJfYmxhbmtcYi9pLnRlc3QodGFyZ2V0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgfQogIC8vIHRoaXMgbWF5IGJlIGEgV2VleCBldmVudCB3aGljaCBkb2Vzbid0IGhhdmUgdGhpcyBtZXRob2QKICBpZiAoZS5wcmV2ZW50RGVmYXVsdCkgewogICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogIH0KICByZXR1cm4gdHJ1ZTsKfQpmdW5jdGlvbiBmaW5kQW5jaG9yKGNoaWxkcmVuKSB7CiAgaWYgKGNoaWxkcmVuKSB7CiAgICB2YXIgY2hpbGQ7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNoaWxkID0gY2hpbGRyZW5baV07CiAgICAgIGlmIChjaGlsZC50YWcgPT09ICdhJykgewogICAgICAgIHJldHVybiBjaGlsZDsKICAgICAgfQogICAgICBpZiAoY2hpbGQuY2hpbGRyZW4gJiYgKGNoaWxkID0gZmluZEFuY2hvcihjaGlsZC5jaGlsZHJlbikpKSB7CiAgICAgICAgcmV0dXJuIGNoaWxkOwogICAgICB9CiAgICB9CiAgfQp9CnZhciBfVnVlOwpmdW5jdGlvbiBpbnN0YWxsKFZ1ZSkgewogIGlmIChpbnN0YWxsLmluc3RhbGxlZCAmJiBfVnVlID09PSBWdWUpIHsKICAgIHJldHVybjsKICB9CiAgaW5zdGFsbC5pbnN0YWxsZWQgPSB0cnVlOwogIF9WdWUgPSBWdWU7CiAgdmFyIGlzRGVmID0gZnVuY3Rpb24gKHYpIHsKICAgIHJldHVybiB2ICE9PSB1bmRlZmluZWQ7CiAgfTsKICB2YXIgcmVnaXN0ZXJJbnN0YW5jZSA9IGZ1bmN0aW9uICh2bSwgY2FsbFZhbCkgewogICAgdmFyIGkgPSB2bS4kb3B0aW9ucy5fcGFyZW50Vm5vZGU7CiAgICBpZiAoaXNEZWYoaSkgJiYgaXNEZWYoaSA9IGkuZGF0YSkgJiYgaXNEZWYoaSA9IGkucmVnaXN0ZXJSb3V0ZUluc3RhbmNlKSkgewogICAgICBpKHZtLCBjYWxsVmFsKTsKICAgIH0KICB9OwogIFZ1ZS5taXhpbih7CiAgICBiZWZvcmVDcmVhdGU6IGZ1bmN0aW9uIGJlZm9yZUNyZWF0ZSgpIHsKICAgICAgaWYgKGlzRGVmKHRoaXMuJG9wdGlvbnMucm91dGVyKSkgewogICAgICAgIHRoaXMuX3JvdXRlclJvb3QgPSB0aGlzOwogICAgICAgIHRoaXMuX3JvdXRlciA9IHRoaXMuJG9wdGlvbnMucm91dGVyOwogICAgICAgIHRoaXMuX3JvdXRlci5pbml0KHRoaXMpOwogICAgICAgIFZ1ZS51dGlsLmRlZmluZVJlYWN0aXZlKHRoaXMsICdfcm91dGUnLCB0aGlzLl9yb3V0ZXIuaGlzdG9yeS5jdXJyZW50KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9yb3V0ZXJSb290ID0gdGhpcy4kcGFyZW50ICYmIHRoaXMuJHBhcmVudC5fcm91dGVyUm9vdCB8fCB0aGlzOwogICAgICB9CiAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcywgdGhpcyk7CiAgICB9LAogICAgZGVzdHJveWVkOiBmdW5jdGlvbiBkZXN0cm95ZWQoKSB7CiAgICAgIHJlZ2lzdGVySW5zdGFuY2UodGhpcyk7CiAgICB9CiAgfSk7CiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZ1ZS5wcm90b3R5cGUsICckcm91dGVyJywgewogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9yb3V0ZXJSb290Ll9yb3V0ZXI7CiAgICB9CiAgfSk7CiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFZ1ZS5wcm90b3R5cGUsICckcm91dGUnLCB7CiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHRoaXMuX3JvdXRlclJvb3QuX3JvdXRlOwogICAgfQogIH0pOwogIFZ1ZS5jb21wb25lbnQoJ1JvdXRlclZpZXcnLCBWaWV3KTsKICBWdWUuY29tcG9uZW50KCdSb3V0ZXJMaW5rJywgTGluayk7CiAgdmFyIHN0cmF0cyA9IFZ1ZS5jb25maWcub3B0aW9uTWVyZ2VTdHJhdGVnaWVzOwogIC8vIHVzZSB0aGUgc2FtZSBob29rIG1lcmdpbmcgc3RyYXRlZ3kgZm9yIHJvdXRlIGhvb2tzCiAgc3RyYXRzLmJlZm9yZVJvdXRlRW50ZXIgPSBzdHJhdHMuYmVmb3JlUm91dGVMZWF2ZSA9IHN0cmF0cy5iZWZvcmVSb3V0ZVVwZGF0ZSA9IHN0cmF0cy5jcmVhdGVkOwp9CgovKiAgKi8KCnZhciBpbkJyb3dzZXIgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJzsKCi8qICAqLwoKZnVuY3Rpb24gY3JlYXRlUm91dGVNYXAocm91dGVzLCBvbGRQYXRoTGlzdCwgb2xkUGF0aE1hcCwgb2xkTmFtZU1hcCwgcGFyZW50Um91dGUpIHsKICAvLyB0aGUgcGF0aCBsaXN0IGlzIHVzZWQgdG8gY29udHJvbCBwYXRoIG1hdGNoaW5nIHByaW9yaXR5CiAgdmFyIHBhdGhMaXN0ID0gb2xkUGF0aExpc3QgfHwgW107CiAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgdmFyIHBhdGhNYXAgPSBvbGRQYXRoTWFwIHx8IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgdmFyIG5hbWVNYXAgPSBvbGROYW1lTWFwIHx8IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgcm91dGVzLmZvckVhY2goZnVuY3Rpb24gKHJvdXRlKSB7CiAgICBhZGRSb3V0ZVJlY29yZChwYXRoTGlzdCwgcGF0aE1hcCwgbmFtZU1hcCwgcm91dGUsIHBhcmVudFJvdXRlKTsKICB9KTsKCiAgLy8gZW5zdXJlIHdpbGRjYXJkIHJvdXRlcyBhcmUgYWx3YXlzIGF0IHRoZSBlbmQKICBmb3IgKHZhciBpID0gMCwgbCA9IHBhdGhMaXN0Lmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgaWYgKHBhdGhMaXN0W2ldID09PSAnKicpIHsKICAgICAgcGF0aExpc3QucHVzaChwYXRoTGlzdC5zcGxpY2UoaSwgMSlbMF0pOwogICAgICBsLS07CiAgICAgIGktLTsKICAgIH0KICB9CiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnKSB7CiAgICAvLyB3YXJuIGlmIHJvdXRlcyBkbyBub3QgaW5jbHVkZSBsZWFkaW5nIHNsYXNoZXMKICAgIHZhciBmb3VuZCA9IHBhdGhMaXN0CiAgICAvLyBjaGVjayBmb3IgbWlzc2luZyBsZWFkaW5nIHNsYXNoCiAgICAuZmlsdGVyKGZ1bmN0aW9uIChwYXRoKSB7CiAgICAgIHJldHVybiBwYXRoICYmIHBhdGguY2hhckF0KDApICE9PSAnKicgJiYgcGF0aC5jaGFyQXQoMCkgIT09ICcvJzsKICAgIH0pOwogICAgaWYgKGZvdW5kLmxlbmd0aCA+IDApIHsKICAgICAgdmFyIHBhdGhOYW1lcyA9IGZvdW5kLm1hcChmdW5jdGlvbiAocGF0aCkgewogICAgICAgIHJldHVybiAiLSAiICsgcGF0aDsKICAgICAgfSkuam9pbignXG4nKTsKICAgICAgd2FybihmYWxzZSwgIk5vbi1uZXN0ZWQgcm91dGVzIG11c3QgaW5jbHVkZSBhIGxlYWRpbmcgc2xhc2ggY2hhcmFjdGVyLiBGaXggdGhlIGZvbGxvd2luZyByb3V0ZXM6IFxuIiArIHBhdGhOYW1lcyk7CiAgICB9CiAgfQogIHJldHVybiB7CiAgICBwYXRoTGlzdDogcGF0aExpc3QsCiAgICBwYXRoTWFwOiBwYXRoTWFwLAogICAgbmFtZU1hcDogbmFtZU1hcAogIH07Cn0KZnVuY3Rpb24gYWRkUm91dGVSZWNvcmQocGF0aExpc3QsIHBhdGhNYXAsIG5hbWVNYXAsIHJvdXRlLCBwYXJlbnQsIG1hdGNoQXMpIHsKICB2YXIgcGF0aCA9IHJvdXRlLnBhdGg7CiAgdmFyIG5hbWUgPSByb3V0ZS5uYW1lOwogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICBhc3NlcnQocGF0aCAhPSBudWxsLCAiXCJwYXRoXCIgaXMgcmVxdWlyZWQgaW4gYSByb3V0ZSBjb25maWd1cmF0aW9uLiIpOwogICAgYXNzZXJ0KHR5cGVvZiByb3V0ZS5jb21wb25lbnQgIT09ICdzdHJpbmcnLCAicm91dGUgY29uZmlnIFwiY29tcG9uZW50XCIgZm9yIHBhdGg6ICIgKyBTdHJpbmcocGF0aCB8fCBuYW1lKSArICIgY2Fubm90IGJlIGEgIiArICJzdHJpbmcgaWQuIFVzZSBhbiBhY3R1YWwgY29tcG9uZW50IGluc3RlYWQuIik7CiAgICB3YXJuKAogICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnRyb2wtcmVnZXgKICAgICEvW15cdTAwMDAtXHUwMDdGXSsvLnRlc3QocGF0aCksICJSb3V0ZSB3aXRoIHBhdGggXCIiICsgcGF0aCArICJcIiBjb250YWlucyB1bmVuY29kZWQgY2hhcmFjdGVycywgbWFrZSBzdXJlICIgKyAieW91ciBwYXRoIGlzIGNvcnJlY3RseSBlbmNvZGVkIGJlZm9yZSBwYXNzaW5nIGl0IHRvIHRoZSByb3V0ZXIuIFVzZSAiICsgImVuY29kZVVSSSB0byBlbmNvZGUgc3RhdGljIHNlZ21lbnRzIG9mIHlvdXIgcGF0aC4iKTsKICB9CiAgdmFyIHBhdGhUb1JlZ2V4cE9wdGlvbnMgPSByb3V0ZS5wYXRoVG9SZWdleHBPcHRpb25zIHx8IHt9OwogIHZhciBub3JtYWxpemVkUGF0aCA9IG5vcm1hbGl6ZVBhdGgocGF0aCwgcGFyZW50LCBwYXRoVG9SZWdleHBPcHRpb25zLnN0cmljdCk7CiAgaWYgKHR5cGVvZiByb3V0ZS5jYXNlU2Vuc2l0aXZlID09PSAnYm9vbGVhbicpIHsKICAgIHBhdGhUb1JlZ2V4cE9wdGlvbnMuc2Vuc2l0aXZlID0gcm91dGUuY2FzZVNlbnNpdGl2ZTsKICB9CiAgdmFyIHJlY29yZCA9IHsKICAgIHBhdGg6IG5vcm1hbGl6ZWRQYXRoLAogICAgcmVnZXg6IGNvbXBpbGVSb3V0ZVJlZ2V4KG5vcm1hbGl6ZWRQYXRoLCBwYXRoVG9SZWdleHBPcHRpb25zKSwKICAgIGNvbXBvbmVudHM6IHJvdXRlLmNvbXBvbmVudHMgfHwgewogICAgICBkZWZhdWx0OiByb3V0ZS5jb21wb25lbnQKICAgIH0sCiAgICBhbGlhczogcm91dGUuYWxpYXMgPyB0eXBlb2Ygcm91dGUuYWxpYXMgPT09ICdzdHJpbmcnID8gW3JvdXRlLmFsaWFzXSA6IHJvdXRlLmFsaWFzIDogW10sCiAgICBpbnN0YW5jZXM6IHt9LAogICAgZW50ZXJlZENiczoge30sCiAgICBuYW1lOiBuYW1lLAogICAgcGFyZW50OiBwYXJlbnQsCiAgICBtYXRjaEFzOiBtYXRjaEFzLAogICAgcmVkaXJlY3Q6IHJvdXRlLnJlZGlyZWN0LAogICAgYmVmb3JlRW50ZXI6IHJvdXRlLmJlZm9yZUVudGVyLAogICAgbWV0YTogcm91dGUubWV0YSB8fCB7fSwKICAgIHByb3BzOiByb3V0ZS5wcm9wcyA9PSBudWxsID8ge30gOiByb3V0ZS5jb21wb25lbnRzID8gcm91dGUucHJvcHMgOiB7CiAgICAgIGRlZmF1bHQ6IHJvdXRlLnByb3BzCiAgICB9CiAgfTsKICBpZiAocm91dGUuY2hpbGRyZW4pIHsKICAgIC8vIFdhcm4gaWYgcm91dGUgaXMgbmFtZWQsIGRvZXMgbm90IHJlZGlyZWN0IGFuZCBoYXMgYSBkZWZhdWx0IGNoaWxkIHJvdXRlLgogICAgLy8gSWYgdXNlcnMgbmF2aWdhdGUgdG8gdGhpcyByb3V0ZSBieSBuYW1lLCB0aGUgZGVmYXVsdCBjaGlsZCB3aWxsCiAgICAvLyBub3QgYmUgcmVuZGVyZWQgKEdIIElzc3VlICM2MjkpCiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICBpZiAocm91dGUubmFtZSAmJiAhcm91dGUucmVkaXJlY3QgJiYgcm91dGUuY2hpbGRyZW4uc29tZShmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICByZXR1cm4gL15cLz8kLy50ZXN0KGNoaWxkLnBhdGgpOwogICAgICB9KSkgewogICAgICAgIHdhcm4oZmFsc2UsICJOYW1lZCBSb3V0ZSAnIiArIHJvdXRlLm5hbWUgKyAiJyBoYXMgYSBkZWZhdWx0IGNoaWxkIHJvdXRlLiAiICsgIldoZW4gbmF2aWdhdGluZyB0byB0aGlzIG5hbWVkIHJvdXRlICg6dG89XCJ7bmFtZTogJyIgKyByb3V0ZS5uYW1lICsgIid9XCIpLCAiICsgInRoZSBkZWZhdWx0IGNoaWxkIHJvdXRlIHdpbGwgbm90IGJlIHJlbmRlcmVkLiBSZW1vdmUgdGhlIG5hbWUgZnJvbSAiICsgInRoaXMgcm91dGUgYW5kIHVzZSB0aGUgbmFtZSBvZiB0aGUgZGVmYXVsdCBjaGlsZCByb3V0ZSBmb3IgbmFtZWQgIiArICJsaW5rcyBpbnN0ZWFkLiIpOwogICAgICB9CiAgICB9CiAgICByb3V0ZS5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCkgewogICAgICB2YXIgY2hpbGRNYXRjaEFzID0gbWF0Y2hBcyA/IGNsZWFuUGF0aChtYXRjaEFzICsgIi8iICsgY2hpbGQucGF0aCkgOiB1bmRlZmluZWQ7CiAgICAgIGFkZFJvdXRlUmVjb3JkKHBhdGhMaXN0LCBwYXRoTWFwLCBuYW1lTWFwLCBjaGlsZCwgcmVjb3JkLCBjaGlsZE1hdGNoQXMpOwogICAgfSk7CiAgfQogIGlmICghcGF0aE1hcFtyZWNvcmQucGF0aF0pIHsKICAgIHBhdGhMaXN0LnB1c2gocmVjb3JkLnBhdGgpOwogICAgcGF0aE1hcFtyZWNvcmQucGF0aF0gPSByZWNvcmQ7CiAgfQogIGlmIChyb3V0ZS5hbGlhcyAhPT0gdW5kZWZpbmVkKSB7CiAgICB2YXIgYWxpYXNlcyA9IEFycmF5LmlzQXJyYXkocm91dGUuYWxpYXMpID8gcm91dGUuYWxpYXMgOiBbcm91dGUuYWxpYXNdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhbGlhc2VzLmxlbmd0aDsgKytpKSB7CiAgICAgIHZhciBhbGlhcyA9IGFsaWFzZXNbaV07CiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmIGFsaWFzID09PSBwYXRoKSB7CiAgICAgICAgd2FybihmYWxzZSwgIkZvdW5kIGFuIGFsaWFzIHdpdGggdGhlIHNhbWUgdmFsdWUgYXMgdGhlIHBhdGg6IFwiIiArIHBhdGggKyAiXCIuIFlvdSBoYXZlIHRvIHJlbW92ZSB0aGF0IGFsaWFzLiBJdCB3aWxsIGJlIGlnbm9yZWQgaW4gZGV2ZWxvcG1lbnQuIik7CiAgICAgICAgLy8gc2tpcCBpbiBkZXYgdG8gbWFrZSBpdCB3b3JrCiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgdmFyIGFsaWFzUm91dGUgPSB7CiAgICAgICAgcGF0aDogYWxpYXMsCiAgICAgICAgY2hpbGRyZW46IHJvdXRlLmNoaWxkcmVuCiAgICAgIH07CiAgICAgIGFkZFJvdXRlUmVjb3JkKHBhdGhMaXN0LCBwYXRoTWFwLCBuYW1lTWFwLCBhbGlhc1JvdXRlLCBwYXJlbnQsIHJlY29yZC5wYXRoIHx8ICcvJyAvLyBtYXRjaEFzCiAgICAgICk7CiAgICB9CiAgfQogIGlmIChuYW1lKSB7CiAgICBpZiAoIW5hbWVNYXBbbmFtZV0pIHsKICAgICAgbmFtZU1hcFtuYW1lXSA9IHJlY29yZDsKICAgIH0gZWxzZSBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhbWF0Y2hBcykgewogICAgICB3YXJuKGZhbHNlLCAiRHVwbGljYXRlIG5hbWVkIHJvdXRlcyBkZWZpbml0aW9uOiAiICsgInsgbmFtZTogXCIiICsgbmFtZSArICJcIiwgcGF0aDogXCIiICsgcmVjb3JkLnBhdGggKyAiXCIgfSIpOwogICAgfQogIH0KfQpmdW5jdGlvbiBjb21waWxlUm91dGVSZWdleChwYXRoLCBwYXRoVG9SZWdleHBPcHRpb25zKSB7CiAgdmFyIHJlZ2V4ID0gcGF0aFRvUmVnZXhwXzEocGF0aCwgW10sIHBhdGhUb1JlZ2V4cE9wdGlvbnMpOwogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICB2YXIga2V5cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICByZWdleC5rZXlzLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICB3YXJuKCFrZXlzW2tleS5uYW1lXSwgIkR1cGxpY2F0ZSBwYXJhbSBrZXlzIGluIHJvdXRlIHdpdGggcGF0aDogXCIiICsgcGF0aCArICJcIiIpOwogICAgICBrZXlzW2tleS5uYW1lXSA9IHRydWU7CiAgICB9KTsKICB9CiAgcmV0dXJuIHJlZ2V4Owp9CmZ1bmN0aW9uIG5vcm1hbGl6ZVBhdGgocGF0aCwgcGFyZW50LCBzdHJpY3QpIHsKICBpZiAoIXN0cmljdCkgewogICAgcGF0aCA9IHBhdGgucmVwbGFjZSgvXC8kLywgJycpOwogIH0KICBpZiAocGF0aFswXSA9PT0gJy8nKSB7CiAgICByZXR1cm4gcGF0aDsKICB9CiAgaWYgKHBhcmVudCA9PSBudWxsKSB7CiAgICByZXR1cm4gcGF0aDsKICB9CiAgcmV0dXJuIGNsZWFuUGF0aChwYXJlbnQucGF0aCArICIvIiArIHBhdGgpOwp9CgovKiAgKi8KCmZ1bmN0aW9uIGNyZWF0ZU1hdGNoZXIocm91dGVzLCByb3V0ZXIpIHsKICB2YXIgcmVmID0gY3JlYXRlUm91dGVNYXAocm91dGVzKTsKICB2YXIgcGF0aExpc3QgPSByZWYucGF0aExpc3Q7CiAgdmFyIHBhdGhNYXAgPSByZWYucGF0aE1hcDsKICB2YXIgbmFtZU1hcCA9IHJlZi5uYW1lTWFwOwogIGZ1bmN0aW9uIGFkZFJvdXRlcyhyb3V0ZXMpIHsKICAgIGNyZWF0ZVJvdXRlTWFwKHJvdXRlcywgcGF0aExpc3QsIHBhdGhNYXAsIG5hbWVNYXApOwogIH0KICBmdW5jdGlvbiBhZGRSb3V0ZShwYXJlbnRPclJvdXRlLCByb3V0ZSkgewogICAgdmFyIHBhcmVudCA9IHR5cGVvZiBwYXJlbnRPclJvdXRlICE9PSAnb2JqZWN0JyA/IG5hbWVNYXBbcGFyZW50T3JSb3V0ZV0gOiB1bmRlZmluZWQ7CiAgICAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICAgIGNyZWF0ZVJvdXRlTWFwKFtyb3V0ZSB8fCBwYXJlbnRPclJvdXRlXSwgcGF0aExpc3QsIHBhdGhNYXAsIG5hbWVNYXAsIHBhcmVudCk7CgogICAgLy8gYWRkIGFsaWFzZXMgb2YgcGFyZW50CiAgICBpZiAocGFyZW50ICYmIHBhcmVudC5hbGlhcy5sZW5ndGgpIHsKICAgICAgY3JlYXRlUm91dGVNYXAoCiAgICAgIC8vICRmbG93LWRpc2FibGUtbGluZSByb3V0ZSBpcyBkZWZpbmVkIGlmIHBhcmVudCBpcwogICAgICBwYXJlbnQuYWxpYXMubWFwKGZ1bmN0aW9uIChhbGlhcykgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBwYXRoOiBhbGlhcywKICAgICAgICAgIGNoaWxkcmVuOiBbcm91dGVdCiAgICAgICAgfTsKICAgICAgfSksIHBhdGhMaXN0LCBwYXRoTWFwLCBuYW1lTWFwLCBwYXJlbnQpOwogICAgfQogIH0KICBmdW5jdGlvbiBnZXRSb3V0ZXMoKSB7CiAgICByZXR1cm4gcGF0aExpc3QubWFwKGZ1bmN0aW9uIChwYXRoKSB7CiAgICAgIHJldHVybiBwYXRoTWFwW3BhdGhdOwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIG1hdGNoKHJhdywgY3VycmVudFJvdXRlLCByZWRpcmVjdGVkRnJvbSkgewogICAgdmFyIGxvY2F0aW9uID0gbm9ybWFsaXplTG9jYXRpb24ocmF3LCBjdXJyZW50Um91dGUsIGZhbHNlLCByb3V0ZXIpOwogICAgdmFyIG5hbWUgPSBsb2NhdGlvbi5uYW1lOwogICAgaWYgKG5hbWUpIHsKICAgICAgdmFyIHJlY29yZCA9IG5hbWVNYXBbbmFtZV07CiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgd2FybihyZWNvcmQsICJSb3V0ZSB3aXRoIG5hbWUgJyIgKyBuYW1lICsgIicgZG9lcyBub3QgZXhpc3QiKTsKICAgICAgfQogICAgICBpZiAoIXJlY29yZCkgewogICAgICAgIHJldHVybiBfY3JlYXRlUm91dGUobnVsbCwgbG9jYXRpb24pOwogICAgICB9CiAgICAgIHZhciBwYXJhbU5hbWVzID0gcmVjb3JkLnJlZ2V4LmtleXMuZmlsdGVyKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICByZXR1cm4gIWtleS5vcHRpb25hbDsKICAgICAgfSkubWFwKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICByZXR1cm4ga2V5Lm5hbWU7CiAgICAgIH0pOwogICAgICBpZiAodHlwZW9mIGxvY2F0aW9uLnBhcmFtcyAhPT0gJ29iamVjdCcpIHsKICAgICAgICBsb2NhdGlvbi5wYXJhbXMgPSB7fTsKICAgICAgfQogICAgICBpZiAoY3VycmVudFJvdXRlICYmIHR5cGVvZiBjdXJyZW50Um91dGUucGFyYW1zID09PSAnb2JqZWN0JykgewogICAgICAgIGZvciAodmFyIGtleSBpbiBjdXJyZW50Um91dGUucGFyYW1zKSB7CiAgICAgICAgICBpZiAoIShrZXkgaW4gbG9jYXRpb24ucGFyYW1zKSAmJiBwYXJhbU5hbWVzLmluZGV4T2Yoa2V5KSA+IC0xKSB7CiAgICAgICAgICAgIGxvY2F0aW9uLnBhcmFtc1trZXldID0gY3VycmVudFJvdXRlLnBhcmFtc1trZXldOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBsb2NhdGlvbi5wYXRoID0gZmlsbFBhcmFtcyhyZWNvcmQucGF0aCwgbG9jYXRpb24ucGFyYW1zLCAibmFtZWQgcm91dGUgXCIiICsgbmFtZSArICJcIiIpOwogICAgICByZXR1cm4gX2NyZWF0ZVJvdXRlKHJlY29yZCwgbG9jYXRpb24sIHJlZGlyZWN0ZWRGcm9tKTsKICAgIH0gZWxzZSBpZiAobG9jYXRpb24ucGF0aCkgewogICAgICBsb2NhdGlvbi5wYXJhbXMgPSB7fTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXRoTGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBwYXRoID0gcGF0aExpc3RbaV07CiAgICAgICAgdmFyIHJlY29yZCQxID0gcGF0aE1hcFtwYXRoXTsKICAgICAgICBpZiAobWF0Y2hSb3V0ZShyZWNvcmQkMS5yZWdleCwgbG9jYXRpb24ucGF0aCwgbG9jYXRpb24ucGFyYW1zKSkgewogICAgICAgICAgcmV0dXJuIF9jcmVhdGVSb3V0ZShyZWNvcmQkMSwgbG9jYXRpb24sIHJlZGlyZWN0ZWRGcm9tKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8vIG5vIG1hdGNoCiAgICByZXR1cm4gX2NyZWF0ZVJvdXRlKG51bGwsIGxvY2F0aW9uKTsKICB9CiAgZnVuY3Rpb24gcmVkaXJlY3QocmVjb3JkLCBsb2NhdGlvbikgewogICAgdmFyIG9yaWdpbmFsUmVkaXJlY3QgPSByZWNvcmQucmVkaXJlY3Q7CiAgICB2YXIgcmVkaXJlY3QgPSB0eXBlb2Ygb3JpZ2luYWxSZWRpcmVjdCA9PT0gJ2Z1bmN0aW9uJyA/IG9yaWdpbmFsUmVkaXJlY3QoY3JlYXRlUm91dGUocmVjb3JkLCBsb2NhdGlvbiwgbnVsbCwgcm91dGVyKSkgOiBvcmlnaW5hbFJlZGlyZWN0OwogICAgaWYgKHR5cGVvZiByZWRpcmVjdCA9PT0gJ3N0cmluZycpIHsKICAgICAgcmVkaXJlY3QgPSB7CiAgICAgICAgcGF0aDogcmVkaXJlY3QKICAgICAgfTsKICAgIH0KICAgIGlmICghcmVkaXJlY3QgfHwgdHlwZW9mIHJlZGlyZWN0ICE9PSAnb2JqZWN0JykgewogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgIHdhcm4oZmFsc2UsICJpbnZhbGlkIHJlZGlyZWN0IG9wdGlvbjogIiArIEpTT04uc3RyaW5naWZ5KHJlZGlyZWN0KSk7CiAgICAgIH0KICAgICAgcmV0dXJuIF9jcmVhdGVSb3V0ZShudWxsLCBsb2NhdGlvbik7CiAgICB9CiAgICB2YXIgcmUgPSByZWRpcmVjdDsKICAgIHZhciBuYW1lID0gcmUubmFtZTsKICAgIHZhciBwYXRoID0gcmUucGF0aDsKICAgIHZhciBxdWVyeSA9IGxvY2F0aW9uLnF1ZXJ5OwogICAgdmFyIGhhc2ggPSBsb2NhdGlvbi5oYXNoOwogICAgdmFyIHBhcmFtcyA9IGxvY2F0aW9uLnBhcmFtczsKICAgIHF1ZXJ5ID0gcmUuaGFzT3duUHJvcGVydHkoJ3F1ZXJ5JykgPyByZS5xdWVyeSA6IHF1ZXJ5OwogICAgaGFzaCA9IHJlLmhhc093blByb3BlcnR5KCdoYXNoJykgPyByZS5oYXNoIDogaGFzaDsKICAgIHBhcmFtcyA9IHJlLmhhc093blByb3BlcnR5KCdwYXJhbXMnKSA/IHJlLnBhcmFtcyA6IHBhcmFtczsKICAgIGlmIChuYW1lKSB7CiAgICAgIC8vIHJlc29sdmVkIG5hbWVkIGRpcmVjdAogICAgICB2YXIgdGFyZ2V0UmVjb3JkID0gbmFtZU1hcFtuYW1lXTsKICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICBhc3NlcnQodGFyZ2V0UmVjb3JkLCAicmVkaXJlY3QgZmFpbGVkOiBuYW1lZCByb3V0ZSBcIiIgKyBuYW1lICsgIlwiIG5vdCBmb3VuZC4iKTsKICAgICAgfQogICAgICByZXR1cm4gbWF0Y2goewogICAgICAgIF9ub3JtYWxpemVkOiB0cnVlLAogICAgICAgIG5hbWU6IG5hbWUsCiAgICAgICAgcXVlcnk6IHF1ZXJ5LAogICAgICAgIGhhc2g6IGhhc2gsCiAgICAgICAgcGFyYW1zOiBwYXJhbXMKICAgICAgfSwgdW5kZWZpbmVkLCBsb2NhdGlvbik7CiAgICB9IGVsc2UgaWYgKHBhdGgpIHsKICAgICAgLy8gMS4gcmVzb2x2ZSByZWxhdGl2ZSByZWRpcmVjdAogICAgICB2YXIgcmF3UGF0aCA9IHJlc29sdmVSZWNvcmRQYXRoKHBhdGgsIHJlY29yZCk7CiAgICAgIC8vIDIuIHJlc29sdmUgcGFyYW1zCiAgICAgIHZhciByZXNvbHZlZFBhdGggPSBmaWxsUGFyYW1zKHJhd1BhdGgsIHBhcmFtcywgInJlZGlyZWN0IHJvdXRlIHdpdGggcGF0aCBcIiIgKyByYXdQYXRoICsgIlwiIik7CiAgICAgIC8vIDMuIHJlbWF0Y2ggd2l0aCBleGlzdGluZyBxdWVyeSBhbmQgaGFzaAogICAgICByZXR1cm4gbWF0Y2goewogICAgICAgIF9ub3JtYWxpemVkOiB0cnVlLAogICAgICAgIHBhdGg6IHJlc29sdmVkUGF0aCwKICAgICAgICBxdWVyeTogcXVlcnksCiAgICAgICAgaGFzaDogaGFzaAogICAgICB9LCB1bmRlZmluZWQsIGxvY2F0aW9uKTsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgd2FybihmYWxzZSwgImludmFsaWQgcmVkaXJlY3Qgb3B0aW9uOiAiICsgSlNPTi5zdHJpbmdpZnkocmVkaXJlY3QpKTsKICAgICAgfQogICAgICByZXR1cm4gX2NyZWF0ZVJvdXRlKG51bGwsIGxvY2F0aW9uKTsKICAgIH0KICB9CiAgZnVuY3Rpb24gYWxpYXMocmVjb3JkLCBsb2NhdGlvbiwgbWF0Y2hBcykgewogICAgdmFyIGFsaWFzZWRQYXRoID0gZmlsbFBhcmFtcyhtYXRjaEFzLCBsb2NhdGlvbi5wYXJhbXMsICJhbGlhc2VkIHJvdXRlIHdpdGggcGF0aCBcIiIgKyBtYXRjaEFzICsgIlwiIik7CiAgICB2YXIgYWxpYXNlZE1hdGNoID0gbWF0Y2goewogICAgICBfbm9ybWFsaXplZDogdHJ1ZSwKICAgICAgcGF0aDogYWxpYXNlZFBhdGgKICAgIH0pOwogICAgaWYgKGFsaWFzZWRNYXRjaCkgewogICAgICB2YXIgbWF0Y2hlZCA9IGFsaWFzZWRNYXRjaC5tYXRjaGVkOwogICAgICB2YXIgYWxpYXNlZFJlY29yZCA9IG1hdGNoZWRbbWF0Y2hlZC5sZW5ndGggLSAxXTsKICAgICAgbG9jYXRpb24ucGFyYW1zID0gYWxpYXNlZE1hdGNoLnBhcmFtczsKICAgICAgcmV0dXJuIF9jcmVhdGVSb3V0ZShhbGlhc2VkUmVjb3JkLCBsb2NhdGlvbik7CiAgICB9CiAgICByZXR1cm4gX2NyZWF0ZVJvdXRlKG51bGwsIGxvY2F0aW9uKTsKICB9CiAgZnVuY3Rpb24gX2NyZWF0ZVJvdXRlKHJlY29yZCwgbG9jYXRpb24sIHJlZGlyZWN0ZWRGcm9tKSB7CiAgICBpZiAocmVjb3JkICYmIHJlY29yZC5yZWRpcmVjdCkgewogICAgICByZXR1cm4gcmVkaXJlY3QocmVjb3JkLCByZWRpcmVjdGVkRnJvbSB8fCBsb2NhdGlvbik7CiAgICB9CiAgICBpZiAocmVjb3JkICYmIHJlY29yZC5tYXRjaEFzKSB7CiAgICAgIHJldHVybiBhbGlhcyhyZWNvcmQsIGxvY2F0aW9uLCByZWNvcmQubWF0Y2hBcyk7CiAgICB9CiAgICByZXR1cm4gY3JlYXRlUm91dGUocmVjb3JkLCBsb2NhdGlvbiwgcmVkaXJlY3RlZEZyb20sIHJvdXRlcik7CiAgfQogIHJldHVybiB7CiAgICBtYXRjaDogbWF0Y2gsCiAgICBhZGRSb3V0ZTogYWRkUm91dGUsCiAgICBnZXRSb3V0ZXM6IGdldFJvdXRlcywKICAgIGFkZFJvdXRlczogYWRkUm91dGVzCiAgfTsKfQpmdW5jdGlvbiBtYXRjaFJvdXRlKHJlZ2V4LCBwYXRoLCBwYXJhbXMpIHsKICB2YXIgbSA9IHBhdGgubWF0Y2gocmVnZXgpOwogIGlmICghbSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0gZWxzZSBpZiAoIXBhcmFtcykgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGZvciAodmFyIGkgPSAxLCBsZW4gPSBtLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7CiAgICB2YXIga2V5ID0gcmVnZXgua2V5c1tpIC0gMV07CiAgICBpZiAoa2V5KSB7CiAgICAgIC8vIEZpeCAjMTk5NDogdXNpbmcgKiB3aXRoIHByb3BzOiB0cnVlIGdlbmVyYXRlcyBhIHBhcmFtIG5hbWVkIDAKICAgICAgcGFyYW1zW2tleS5uYW1lIHx8ICdwYXRoTWF0Y2gnXSA9IHR5cGVvZiBtW2ldID09PSAnc3RyaW5nJyA/IGRlY29kZShtW2ldKSA6IG1baV07CiAgICB9CiAgfQogIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIHJlc29sdmVSZWNvcmRQYXRoKHBhdGgsIHJlY29yZCkgewogIHJldHVybiByZXNvbHZlUGF0aChwYXRoLCByZWNvcmQucGFyZW50ID8gcmVjb3JkLnBhcmVudC5wYXRoIDogJy8nLCB0cnVlKTsKfQoKLyogICovCgovLyB1c2UgVXNlciBUaW1pbmcgYXBpIChpZiBwcmVzZW50KSBmb3IgbW9yZSBhY2N1cmF0ZSBrZXkgcHJlY2lzaW9uCnZhciBUaW1lID0gaW5Ccm93c2VyICYmIHdpbmRvdy5wZXJmb3JtYW5jZSAmJiB3aW5kb3cucGVyZm9ybWFuY2Uubm93ID8gd2luZG93LnBlcmZvcm1hbmNlIDogRGF0ZTsKZnVuY3Rpb24gZ2VuU3RhdGVLZXkoKSB7CiAgcmV0dXJuIFRpbWUubm93KCkudG9GaXhlZCgzKTsKfQp2YXIgX2tleSA9IGdlblN0YXRlS2V5KCk7CmZ1bmN0aW9uIGdldFN0YXRlS2V5KCkgewogIHJldHVybiBfa2V5Owp9CmZ1bmN0aW9uIHNldFN0YXRlS2V5KGtleSkgewogIHJldHVybiBfa2V5ID0ga2V5Owp9CgovKiAgKi8KCnZhciBwb3NpdGlvblN0b3JlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKZnVuY3Rpb24gc2V0dXBTY3JvbGwoKSB7CiAgLy8gUHJldmVudCBicm93c2VyIHNjcm9sbCBiZWhhdmlvciBvbiBIaXN0b3J5IHBvcHN0YXRlCiAgaWYgKCdzY3JvbGxSZXN0b3JhdGlvbicgaW4gd2luZG93Lmhpc3RvcnkpIHsKICAgIHdpbmRvdy5oaXN0b3J5LnNjcm9sbFJlc3RvcmF0aW9uID0gJ21hbnVhbCc7CiAgfQogIC8vIEZpeCBmb3IgIzE1ODUgZm9yIEZpcmVmb3gKICAvLyBGaXggZm9yICMyMTk1IEFkZCBvcHRpb25hbCB0aGlyZCBhdHRyaWJ1dGUgdG8gd29ya2Fyb3VuZCBhIGJ1ZyBpbiBzYWZhcmkgaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTE4MjY3OAogIC8vIEZpeCBmb3IgIzI3NzQgU3VwcG9ydCBmb3IgYXBwcyBsb2FkZWQgZnJvbSBXaW5kb3dzIGZpbGUgc2hhcmVzIG5vdCBtYXBwZWQgdG8gbmV0d29yayBkcml2ZXM6IHJlcGxhY2VkIGxvY2F0aW9uLm9yaWdpbiB3aXRoCiAgLy8gd2luZG93LmxvY2F0aW9uLnByb3RvY29sICsgJy8vJyArIHdpbmRvdy5sb2NhdGlvbi5ob3N0CiAgLy8gbG9jYXRpb24uaG9zdCBjb250YWlucyB0aGUgcG9ydCBhbmQgbG9jYXRpb24uaG9zdG5hbWUgZG9lc24ndAogIHZhciBwcm90b2NvbEFuZFBhdGggPSB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyAnLy8nICsgd2luZG93LmxvY2F0aW9uLmhvc3Q7CiAgdmFyIGFic29sdXRlUGF0aCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnJlcGxhY2UocHJvdG9jb2xBbmRQYXRoLCAnJyk7CiAgLy8gcHJlc2VydmUgZXhpc3RpbmcgaGlzdG9yeSBzdGF0ZSBhcyBpdCBjb3VsZCBiZSBvdmVycmlkZW4gYnkgdGhlIHVzZXIKICB2YXIgc3RhdGVDb3B5ID0gZXh0ZW5kKHt9LCB3aW5kb3cuaGlzdG9yeS5zdGF0ZSk7CiAgc3RhdGVDb3B5LmtleSA9IGdldFN0YXRlS2V5KCk7CiAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKHN0YXRlQ29weSwgJycsIGFic29sdXRlUGF0aCk7CiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3BvcHN0YXRlJywgaGFuZGxlUG9wU3RhdGUpOwogIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9wc3RhdGUnLCBoYW5kbGVQb3BTdGF0ZSk7CiAgfTsKfQpmdW5jdGlvbiBoYW5kbGVTY3JvbGwocm91dGVyLCB0bywgZnJvbSwgaXNQb3ApIHsKICBpZiAoIXJvdXRlci5hcHApIHsKICAgIHJldHVybjsKICB9CiAgdmFyIGJlaGF2aW9yID0gcm91dGVyLm9wdGlvbnMuc2Nyb2xsQmVoYXZpb3I7CiAgaWYgKCFiZWhhdmlvcikgewogICAgcmV0dXJuOwogIH0KICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgYXNzZXJ0KHR5cGVvZiBiZWhhdmlvciA9PT0gJ2Z1bmN0aW9uJywgInNjcm9sbEJlaGF2aW9yIG11c3QgYmUgYSBmdW5jdGlvbiIpOwogIH0KCiAgLy8gd2FpdCB1bnRpbCByZS1yZW5kZXIgZmluaXNoZXMgYmVmb3JlIHNjcm9sbGluZwogIHJvdXRlci5hcHAuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgIHZhciBwb3NpdGlvbiA9IGdldFNjcm9sbFBvc2l0aW9uKCk7CiAgICB2YXIgc2hvdWxkU2Nyb2xsID0gYmVoYXZpb3IuY2FsbChyb3V0ZXIsIHRvLCBmcm9tLCBpc1BvcCA/IHBvc2l0aW9uIDogbnVsbCk7CiAgICBpZiAoIXNob3VsZFNjcm9sbCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodHlwZW9mIHNob3VsZFNjcm9sbC50aGVuID09PSAnZnVuY3Rpb24nKSB7CiAgICAgIHNob3VsZFNjcm9sbC50aGVuKGZ1bmN0aW9uIChzaG91bGRTY3JvbGwpIHsKICAgICAgICBzY3JvbGxUb1Bvc2l0aW9uKHNob3VsZFNjcm9sbCwgcG9zaXRpb24pOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICAgIGFzc2VydChmYWxzZSwgZXJyLnRvU3RyaW5nKCkpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBzY3JvbGxUb1Bvc2l0aW9uKHNob3VsZFNjcm9sbCwgcG9zaXRpb24pOwogICAgfQogIH0pOwp9CmZ1bmN0aW9uIHNhdmVTY3JvbGxQb3NpdGlvbigpIHsKICB2YXIga2V5ID0gZ2V0U3RhdGVLZXkoKTsKICBpZiAoa2V5KSB7CiAgICBwb3NpdGlvblN0b3JlW2tleV0gPSB7CiAgICAgIHg6IHdpbmRvdy5wYWdlWE9mZnNldCwKICAgICAgeTogd2luZG93LnBhZ2VZT2Zmc2V0CiAgICB9OwogIH0KfQpmdW5jdGlvbiBoYW5kbGVQb3BTdGF0ZShlKSB7CiAgc2F2ZVNjcm9sbFBvc2l0aW9uKCk7CiAgaWYgKGUuc3RhdGUgJiYgZS5zdGF0ZS5rZXkpIHsKICAgIHNldFN0YXRlS2V5KGUuc3RhdGUua2V5KTsKICB9Cn0KZnVuY3Rpb24gZ2V0U2Nyb2xsUG9zaXRpb24oKSB7CiAgdmFyIGtleSA9IGdldFN0YXRlS2V5KCk7CiAgaWYgKGtleSkgewogICAgcmV0dXJuIHBvc2l0aW9uU3RvcmVba2V5XTsKICB9Cn0KZnVuY3Rpb24gZ2V0RWxlbWVudFBvc2l0aW9uKGVsLCBvZmZzZXQpIHsKICB2YXIgZG9jRWwgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgdmFyIGRvY1JlY3QgPSBkb2NFbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICB2YXIgZWxSZWN0ID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgcmV0dXJuIHsKICAgIHg6IGVsUmVjdC5sZWZ0IC0gZG9jUmVjdC5sZWZ0IC0gb2Zmc2V0LngsCiAgICB5OiBlbFJlY3QudG9wIC0gZG9jUmVjdC50b3AgLSBvZmZzZXQueQogIH07Cn0KZnVuY3Rpb24gaXNWYWxpZFBvc2l0aW9uKG9iaikgewogIHJldHVybiBpc051bWJlcihvYmoueCkgfHwgaXNOdW1iZXIob2JqLnkpOwp9CmZ1bmN0aW9uIG5vcm1hbGl6ZVBvc2l0aW9uKG9iaikgewogIHJldHVybiB7CiAgICB4OiBpc051bWJlcihvYmoueCkgPyBvYmoueCA6IHdpbmRvdy5wYWdlWE9mZnNldCwKICAgIHk6IGlzTnVtYmVyKG9iai55KSA/IG9iai55IDogd2luZG93LnBhZ2VZT2Zmc2V0CiAgfTsKfQpmdW5jdGlvbiBub3JtYWxpemVPZmZzZXQob2JqKSB7CiAgcmV0dXJuIHsKICAgIHg6IGlzTnVtYmVyKG9iai54KSA/IG9iai54IDogMCwKICAgIHk6IGlzTnVtYmVyKG9iai55KSA/IG9iai55IDogMAogIH07Cn0KZnVuY3Rpb24gaXNOdW1iZXIodikgewogIHJldHVybiB0eXBlb2YgdiA9PT0gJ251bWJlcic7Cn0KdmFyIGhhc2hTdGFydHNXaXRoTnVtYmVyUkUgPSAvXiNcZC87CmZ1bmN0aW9uIHNjcm9sbFRvUG9zaXRpb24oc2hvdWxkU2Nyb2xsLCBwb3NpdGlvbikgewogIHZhciBpc09iamVjdCA9IHR5cGVvZiBzaG91bGRTY3JvbGwgPT09ICdvYmplY3QnOwogIGlmIChpc09iamVjdCAmJiB0eXBlb2Ygc2hvdWxkU2Nyb2xsLnNlbGVjdG9yID09PSAnc3RyaW5nJykgewogICAgLy8gZ2V0RWxlbWVudEJ5SWQgd291bGQgc3RpbGwgZmFpbCBpZiB0aGUgc2VsZWN0b3IgY29udGFpbnMgYSBtb3JlIGNvbXBsaWNhdGVkIHF1ZXJ5IGxpa2UgI21haW5bZGF0YS1hdHRyXQogICAgLy8gYnV0IGF0IHRoZSBzYW1lIHRpbWUsIGl0IGRvZXNuJ3QgbWFrZSBtdWNoIHNlbnNlIHRvIHNlbGVjdCBhbiBlbGVtZW50IHdpdGggYW4gaWQgYW5kIGFuIGV4dHJhIHNlbGVjdG9yCiAgICB2YXIgZWwgPSBoYXNoU3RhcnRzV2l0aE51bWJlclJFLnRlc3Qoc2hvdWxkU2Nyb2xsLnNlbGVjdG9yKSAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICAgID8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2hvdWxkU2Nyb2xsLnNlbGVjdG9yLnNsaWNlKDEpKSAvLyAkZmxvdy1kaXNhYmxlLWxpbmUKICAgIDogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihzaG91bGRTY3JvbGwuc2VsZWN0b3IpOwogICAgaWYgKGVsKSB7CiAgICAgIHZhciBvZmZzZXQgPSBzaG91bGRTY3JvbGwub2Zmc2V0ICYmIHR5cGVvZiBzaG91bGRTY3JvbGwub2Zmc2V0ID09PSAnb2JqZWN0JyA/IHNob3VsZFNjcm9sbC5vZmZzZXQgOiB7fTsKICAgICAgb2Zmc2V0ID0gbm9ybWFsaXplT2Zmc2V0KG9mZnNldCk7CiAgICAgIHBvc2l0aW9uID0gZ2V0RWxlbWVudFBvc2l0aW9uKGVsLCBvZmZzZXQpOwogICAgfSBlbHNlIGlmIChpc1ZhbGlkUG9zaXRpb24oc2hvdWxkU2Nyb2xsKSkgewogICAgICBwb3NpdGlvbiA9IG5vcm1hbGl6ZVBvc2l0aW9uKHNob3VsZFNjcm9sbCk7CiAgICB9CiAgfSBlbHNlIGlmIChpc09iamVjdCAmJiBpc1ZhbGlkUG9zaXRpb24oc2hvdWxkU2Nyb2xsKSkgewogICAgcG9zaXRpb24gPSBub3JtYWxpemVQb3NpdGlvbihzaG91bGRTY3JvbGwpOwogIH0KICBpZiAocG9zaXRpb24pIHsKICAgIC8vICRmbG93LWRpc2FibGUtbGluZQogICAgaWYgKCdzY3JvbGxCZWhhdmlvcicgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnN0eWxlKSB7CiAgICAgIHdpbmRvdy5zY3JvbGxUbyh7CiAgICAgICAgbGVmdDogcG9zaXRpb24ueCwKICAgICAgICB0b3A6IHBvc2l0aW9uLnksCiAgICAgICAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgICAgICAgYmVoYXZpb3I6IHNob3VsZFNjcm9sbC5iZWhhdmlvcgogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIHdpbmRvdy5zY3JvbGxUbyhwb3NpdGlvbi54LCBwb3NpdGlvbi55KTsKICAgIH0KICB9Cn0KCi8qICAqLwoKdmFyIHN1cHBvcnRzUHVzaFN0YXRlID0gaW5Ccm93c2VyICYmIGZ1bmN0aW9uICgpIHsKICB2YXIgdWEgPSB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudDsKICBpZiAoKHVhLmluZGV4T2YoJ0FuZHJvaWQgMi4nKSAhPT0gLTEgfHwgdWEuaW5kZXhPZignQW5kcm9pZCA0LjAnKSAhPT0gLTEpICYmIHVhLmluZGV4T2YoJ01vYmlsZSBTYWZhcmknKSAhPT0gLTEgJiYgdWEuaW5kZXhPZignQ2hyb21lJykgPT09IC0xICYmIHVhLmluZGV4T2YoJ1dpbmRvd3MgUGhvbmUnKSA9PT0gLTEpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgcmV0dXJuIHdpbmRvdy5oaXN0b3J5ICYmIHR5cGVvZiB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUgPT09ICdmdW5jdGlvbic7Cn0oKTsKZnVuY3Rpb24gcHVzaFN0YXRlKHVybCwgcmVwbGFjZSkgewogIHNhdmVTY3JvbGxQb3NpdGlvbigpOwogIC8vIHRyeS4uLmNhdGNoIHRoZSBwdXNoU3RhdGUgY2FsbCB0byBnZXQgYXJvdW5kIFNhZmFyaQogIC8vIERPTSBFeGNlcHRpb24gMTggd2hlcmUgaXQgbGltaXRzIHRvIDEwMCBwdXNoU3RhdGUgY2FsbHMKICB2YXIgaGlzdG9yeSA9IHdpbmRvdy5oaXN0b3J5OwogIHRyeSB7CiAgICBpZiAocmVwbGFjZSkgewogICAgICAvLyBwcmVzZXJ2ZSBleGlzdGluZyBoaXN0b3J5IHN0YXRlIGFzIGl0IGNvdWxkIGJlIG92ZXJyaWRlbiBieSB0aGUgdXNlcgogICAgICB2YXIgc3RhdGVDb3B5ID0gZXh0ZW5kKHt9LCBoaXN0b3J5LnN0YXRlKTsKICAgICAgc3RhdGVDb3B5LmtleSA9IGdldFN0YXRlS2V5KCk7CiAgICAgIGhpc3RvcnkucmVwbGFjZVN0YXRlKHN0YXRlQ29weSwgJycsIHVybCk7CiAgICB9IGVsc2UgewogICAgICBoaXN0b3J5LnB1c2hTdGF0ZSh7CiAgICAgICAga2V5OiBzZXRTdGF0ZUtleShnZW5TdGF0ZUtleSgpKQogICAgICB9LCAnJywgdXJsKTsKICAgIH0KICB9IGNhdGNoIChlKSB7CiAgICB3aW5kb3cubG9jYXRpb25bcmVwbGFjZSA/ICdyZXBsYWNlJyA6ICdhc3NpZ24nXSh1cmwpOwogIH0KfQpmdW5jdGlvbiByZXBsYWNlU3RhdGUodXJsKSB7CiAgcHVzaFN0YXRlKHVybCwgdHJ1ZSk7Cn0KCi8vIFdoZW4gY2hhbmdpbmcgdGhpbmcsIGFsc28gZWRpdCByb3V0ZXIuZC50cwp2YXIgTmF2aWdhdGlvbkZhaWx1cmVUeXBlID0gewogIHJlZGlyZWN0ZWQ6IDIsCiAgYWJvcnRlZDogNCwKICBjYW5jZWxsZWQ6IDgsCiAgZHVwbGljYXRlZDogMTYKfTsKZnVuY3Rpb24gY3JlYXRlTmF2aWdhdGlvblJlZGlyZWN0ZWRFcnJvcihmcm9tLCB0bykgewogIHJldHVybiBjcmVhdGVSb3V0ZXJFcnJvcihmcm9tLCB0bywgTmF2aWdhdGlvbkZhaWx1cmVUeXBlLnJlZGlyZWN0ZWQsICJSZWRpcmVjdGVkIHdoZW4gZ29pbmcgZnJvbSBcIiIgKyBmcm9tLmZ1bGxQYXRoICsgIlwiIHRvIFwiIiArIHN0cmluZ2lmeVJvdXRlKHRvKSArICJcIiB2aWEgYSBuYXZpZ2F0aW9uIGd1YXJkLiIpOwp9CmZ1bmN0aW9uIGNyZWF0ZU5hdmlnYXRpb25EdXBsaWNhdGVkRXJyb3IoZnJvbSwgdG8pIHsKICB2YXIgZXJyb3IgPSBjcmVhdGVSb3V0ZXJFcnJvcihmcm9tLCB0bywgTmF2aWdhdGlvbkZhaWx1cmVUeXBlLmR1cGxpY2F0ZWQsICJBdm9pZGVkIHJlZHVuZGFudCBuYXZpZ2F0aW9uIHRvIGN1cnJlbnQgbG9jYXRpb246IFwiIiArIGZyb20uZnVsbFBhdGggKyAiXCIuIik7CiAgLy8gYmFja3dhcmRzIGNvbXBhdGlibGUgd2l0aCB0aGUgZmlyc3QgaW50cm9kdWN0aW9uIG9mIEVycm9ycwogIGVycm9yLm5hbWUgPSAnTmF2aWdhdGlvbkR1cGxpY2F0ZWQnOwogIHJldHVybiBlcnJvcjsKfQpmdW5jdGlvbiBjcmVhdGVOYXZpZ2F0aW9uQ2FuY2VsbGVkRXJyb3IoZnJvbSwgdG8pIHsKICByZXR1cm4gY3JlYXRlUm91dGVyRXJyb3IoZnJvbSwgdG8sIE5hdmlnYXRpb25GYWlsdXJlVHlwZS5jYW5jZWxsZWQsICJOYXZpZ2F0aW9uIGNhbmNlbGxlZCBmcm9tIFwiIiArIGZyb20uZnVsbFBhdGggKyAiXCIgdG8gXCIiICsgdG8uZnVsbFBhdGggKyAiXCIgd2l0aCBhIG5ldyBuYXZpZ2F0aW9uLiIpOwp9CmZ1bmN0aW9uIGNyZWF0ZU5hdmlnYXRpb25BYm9ydGVkRXJyb3IoZnJvbSwgdG8pIHsKICByZXR1cm4gY3JlYXRlUm91dGVyRXJyb3IoZnJvbSwgdG8sIE5hdmlnYXRpb25GYWlsdXJlVHlwZS5hYm9ydGVkLCAiTmF2aWdhdGlvbiBhYm9ydGVkIGZyb20gXCIiICsgZnJvbS5mdWxsUGF0aCArICJcIiB0byBcIiIgKyB0by5mdWxsUGF0aCArICJcIiB2aWEgYSBuYXZpZ2F0aW9uIGd1YXJkLiIpOwp9CmZ1bmN0aW9uIGNyZWF0ZVJvdXRlckVycm9yKGZyb20sIHRvLCB0eXBlLCBtZXNzYWdlKSB7CiAgdmFyIGVycm9yID0gbmV3IEVycm9yKG1lc3NhZ2UpOwogIGVycm9yLl9pc1JvdXRlciA9IHRydWU7CiAgZXJyb3IuZnJvbSA9IGZyb207CiAgZXJyb3IudG8gPSB0bzsKICBlcnJvci50eXBlID0gdHlwZTsKICByZXR1cm4gZXJyb3I7Cn0KdmFyIHByb3BlcnRpZXNUb0xvZyA9IFsncGFyYW1zJywgJ3F1ZXJ5JywgJ2hhc2gnXTsKZnVuY3Rpb24gc3RyaW5naWZ5Um91dGUodG8pIHsKICBpZiAodHlwZW9mIHRvID09PSAnc3RyaW5nJykgewogICAgcmV0dXJuIHRvOwogIH0KICBpZiAoJ3BhdGgnIGluIHRvKSB7CiAgICByZXR1cm4gdG8ucGF0aDsKICB9CiAgdmFyIGxvY2F0aW9uID0ge307CiAgcHJvcGVydGllc1RvTG9nLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgaWYgKGtleSBpbiB0bykgewogICAgICBsb2NhdGlvbltrZXldID0gdG9ba2V5XTsKICAgIH0KICB9KTsKICByZXR1cm4gSlNPTi5zdHJpbmdpZnkobG9jYXRpb24sIG51bGwsIDIpOwp9CmZ1bmN0aW9uIGlzRXJyb3IoZXJyKSB7CiAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChlcnIpLmluZGV4T2YoJ0Vycm9yJykgPiAtMTsKfQpmdW5jdGlvbiBpc05hdmlnYXRpb25GYWlsdXJlKGVyciwgZXJyb3JUeXBlKSB7CiAgcmV0dXJuIGlzRXJyb3IoZXJyKSAmJiBlcnIuX2lzUm91dGVyICYmIChlcnJvclR5cGUgPT0gbnVsbCB8fCBlcnIudHlwZSA9PT0gZXJyb3JUeXBlKTsKfQoKLyogICovCgpmdW5jdGlvbiBydW5RdWV1ZShxdWV1ZSwgZm4sIGNiKSB7CiAgdmFyIHN0ZXAgPSBmdW5jdGlvbiAoaW5kZXgpIHsKICAgIGlmIChpbmRleCA+PSBxdWV1ZS5sZW5ndGgpIHsKICAgICAgY2IoKTsKICAgIH0gZWxzZSB7CiAgICAgIGlmIChxdWV1ZVtpbmRleF0pIHsKICAgICAgICBmbihxdWV1ZVtpbmRleF0sIGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHN0ZXAoaW5kZXggKyAxKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzdGVwKGluZGV4ICsgMSk7CiAgICAgIH0KICAgIH0KICB9OwogIHN0ZXAoMCk7Cn0KCi8qICAqLwoKZnVuY3Rpb24gcmVzb2x2ZUFzeW5jQ29tcG9uZW50cyhtYXRjaGVkKSB7CiAgcmV0dXJuIGZ1bmN0aW9uICh0bywgZnJvbSwgbmV4dCkgewogICAgdmFyIGhhc0FzeW5jID0gZmFsc2U7CiAgICB2YXIgcGVuZGluZyA9IDA7CiAgICB2YXIgZXJyb3IgPSBudWxsOwogICAgZmxhdE1hcENvbXBvbmVudHMobWF0Y2hlZCwgZnVuY3Rpb24gKGRlZiwgXywgbWF0Y2gsIGtleSkgewogICAgICAvLyBpZiBpdCdzIGEgZnVuY3Rpb24gYW5kIGRvZXNuJ3QgaGF2ZSBjaWQgYXR0YWNoZWQsCiAgICAgIC8vIGFzc3VtZSBpdCdzIGFuIGFzeW5jIGNvbXBvbmVudCByZXNvbHZlIGZ1bmN0aW9uLgogICAgICAvLyB3ZSBhcmUgbm90IHVzaW5nIFZ1ZSdzIGRlZmF1bHQgYXN5bmMgcmVzb2x2aW5nIG1lY2hhbmlzbSBiZWNhdXNlCiAgICAgIC8vIHdlIHdhbnQgdG8gaGFsdCB0aGUgbmF2aWdhdGlvbiB1bnRpbCB0aGUgaW5jb21pbmcgY29tcG9uZW50IGhhcyBiZWVuCiAgICAgIC8vIHJlc29sdmVkLgogICAgICBpZiAodHlwZW9mIGRlZiA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWYuY2lkID09PSB1bmRlZmluZWQpIHsKICAgICAgICBoYXNBc3luYyA9IHRydWU7CiAgICAgICAgcGVuZGluZysrOwogICAgICAgIHZhciByZXNvbHZlID0gb25jZShmdW5jdGlvbiAocmVzb2x2ZWREZWYpIHsKICAgICAgICAgIGlmIChpc0VTTW9kdWxlKHJlc29sdmVkRGVmKSkgewogICAgICAgICAgICByZXNvbHZlZERlZiA9IHJlc29sdmVkRGVmLmRlZmF1bHQ7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBzYXZlIHJlc29sdmVkIG9uIGFzeW5jIGZhY3RvcnkgaW4gY2FzZSBpdCdzIHVzZWQgZWxzZXdoZXJlCiAgICAgICAgICBkZWYucmVzb2x2ZWQgPSB0eXBlb2YgcmVzb2x2ZWREZWYgPT09ICdmdW5jdGlvbicgPyByZXNvbHZlZERlZiA6IF9WdWUuZXh0ZW5kKHJlc29sdmVkRGVmKTsKICAgICAgICAgIG1hdGNoLmNvbXBvbmVudHNba2V5XSA9IHJlc29sdmVkRGVmOwogICAgICAgICAgcGVuZGluZy0tOwogICAgICAgICAgaWYgKHBlbmRpbmcgPD0gMCkgewogICAgICAgICAgICBuZXh0KCk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgdmFyIHJlamVjdCA9IG9uY2UoZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgdmFyIG1zZyA9ICJGYWlsZWQgdG8gcmVzb2x2ZSBhc3luYyBjb21wb25lbnQgIiArIGtleSArICI6ICIgKyByZWFzb247CiAgICAgICAgICBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmIHdhcm4oZmFsc2UsIG1zZyk7CiAgICAgICAgICBpZiAoIWVycm9yKSB7CiAgICAgICAgICAgIGVycm9yID0gaXNFcnJvcihyZWFzb24pID8gcmVhc29uIDogbmV3IEVycm9yKG1zZyk7CiAgICAgICAgICAgIG5leHQoZXJyb3IpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHZhciByZXM7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHJlcyA9IGRlZihyZXNvbHZlLCByZWplY3QpOwogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICB9CiAgICAgICAgaWYgKHJlcykgewogICAgICAgICAgaWYgKHR5cGVvZiByZXMudGhlbiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICByZXMudGhlbihyZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gbmV3IHN5bnRheCBpbiBWdWUgMi4zCiAgICAgICAgICAgIHZhciBjb21wID0gcmVzLmNvbXBvbmVudDsKICAgICAgICAgICAgaWYgKGNvbXAgJiYgdHlwZW9mIGNvbXAudGhlbiA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICAgIGNvbXAudGhlbihyZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIGlmICghaGFzQXN5bmMpIHsKICAgICAgbmV4dCgpOwogICAgfQogIH07Cn0KZnVuY3Rpb24gZmxhdE1hcENvbXBvbmVudHMobWF0Y2hlZCwgZm4pIHsKICByZXR1cm4gZmxhdHRlbihtYXRjaGVkLm1hcChmdW5jdGlvbiAobSkgewogICAgcmV0dXJuIE9iamVjdC5rZXlzKG0uY29tcG9uZW50cykubWFwKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgcmV0dXJuIGZuKG0uY29tcG9uZW50c1trZXldLCBtLmluc3RhbmNlc1trZXldLCBtLCBrZXkpOwogICAgfSk7CiAgfSkpOwp9CmZ1bmN0aW9uIGZsYXR0ZW4oYXJyKSB7CiAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5jb25jYXQuYXBwbHkoW10sIGFycik7Cn0KdmFyIGhhc1N5bWJvbCA9IHR5cGVvZiBTeW1ib2wgPT09ICdmdW5jdGlvbicgJiYgdHlwZW9mIFN5bWJvbC50b1N0cmluZ1RhZyA9PT0gJ3N5bWJvbCc7CmZ1bmN0aW9uIGlzRVNNb2R1bGUob2JqKSB7CiAgcmV0dXJuIG9iai5fX2VzTW9kdWxlIHx8IGhhc1N5bWJvbCAmJiBvYmpbU3ltYm9sLnRvU3RyaW5nVGFnXSA9PT0gJ01vZHVsZSc7Cn0KCi8vIGluIFdlYnBhY2sgMiwgcmVxdWlyZS5lbnN1cmUgbm93IGFsc28gcmV0dXJucyBhIFByb21pc2UKLy8gc28gdGhlIHJlc29sdmUvcmVqZWN0IGZ1bmN0aW9ucyBtYXkgZ2V0IGNhbGxlZCBhbiBleHRyYSB0aW1lCi8vIGlmIHRoZSB1c2VyIHVzZXMgYW4gYXJyb3cgZnVuY3Rpb24gc2hvcnRoYW5kIHRoYXQgaGFwcGVucyB0bwovLyByZXR1cm4gdGhhdCBQcm9taXNlLgpmdW5jdGlvbiBvbmNlKGZuKSB7CiAgdmFyIGNhbGxlZCA9IGZhbHNlOwogIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgYXJncyA9IFtdLAogICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOwogICAgd2hpbGUgKGxlbi0tKSBhcmdzW2xlbl0gPSBhcmd1bWVudHNbbGVuXTsKICAgIGlmIChjYWxsZWQpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY2FsbGVkID0gdHJ1ZTsKICAgIHJldHVybiBmbi5hcHBseSh0aGlzLCBhcmdzKTsKICB9Owp9CgovKiAgKi8KCnZhciBIaXN0b3J5ID0gZnVuY3Rpb24gSGlzdG9yeShyb3V0ZXIsIGJhc2UpIHsKICB0aGlzLnJvdXRlciA9IHJvdXRlcjsKICB0aGlzLmJhc2UgPSBub3JtYWxpemVCYXNlKGJhc2UpOwogIC8vIHN0YXJ0IHdpdGggYSByb3V0ZSBvYmplY3QgdGhhdCBzdGFuZHMgZm9yICJub3doZXJlIgogIHRoaXMuY3VycmVudCA9IFNUQVJUOwogIHRoaXMucGVuZGluZyA9IG51bGw7CiAgdGhpcy5yZWFkeSA9IGZhbHNlOwogIHRoaXMucmVhZHlDYnMgPSBbXTsKICB0aGlzLnJlYWR5RXJyb3JDYnMgPSBbXTsKICB0aGlzLmVycm9yQ2JzID0gW107CiAgdGhpcy5saXN0ZW5lcnMgPSBbXTsKfTsKSGlzdG9yeS5wcm90b3R5cGUubGlzdGVuID0gZnVuY3Rpb24gbGlzdGVuKGNiKSB7CiAgdGhpcy5jYiA9IGNiOwp9OwpIaXN0b3J5LnByb3RvdHlwZS5vblJlYWR5ID0gZnVuY3Rpb24gb25SZWFkeShjYiwgZXJyb3JDYikgewogIGlmICh0aGlzLnJlYWR5KSB7CiAgICBjYigpOwogIH0gZWxzZSB7CiAgICB0aGlzLnJlYWR5Q2JzLnB1c2goY2IpOwogICAgaWYgKGVycm9yQ2IpIHsKICAgICAgdGhpcy5yZWFkeUVycm9yQ2JzLnB1c2goZXJyb3JDYik7CiAgICB9CiAgfQp9OwpIaXN0b3J5LnByb3RvdHlwZS5vbkVycm9yID0gZnVuY3Rpb24gb25FcnJvcihlcnJvckNiKSB7CiAgdGhpcy5lcnJvckNicy5wdXNoKGVycm9yQ2IpOwp9OwpIaXN0b3J5LnByb3RvdHlwZS50cmFuc2l0aW9uVG8gPSBmdW5jdGlvbiB0cmFuc2l0aW9uVG8obG9jYXRpb24sIG9uQ29tcGxldGUsIG9uQWJvcnQpIHsKICB2YXIgdGhpcyQxJDEgPSB0aGlzOwogIHZhciByb3V0ZTsKICAvLyBjYXRjaCByZWRpcmVjdCBvcHRpb24gaHR0cHM6Ly9naXRodWIuY29tL3Z1ZWpzL3Z1ZS1yb3V0ZXIvaXNzdWVzLzMyMDEKICB0cnkgewogICAgcm91dGUgPSB0aGlzLnJvdXRlci5tYXRjaChsb2NhdGlvbiwgdGhpcy5jdXJyZW50KTsKICB9IGNhdGNoIChlKSB7CiAgICB0aGlzLmVycm9yQ2JzLmZvckVhY2goZnVuY3Rpb24gKGNiKSB7CiAgICAgIGNiKGUpOwogICAgfSk7CiAgICAvLyBFeGNlcHRpb24gc2hvdWxkIHN0aWxsIGJlIHRocm93bgogICAgdGhyb3cgZTsKICB9CiAgdmFyIHByZXYgPSB0aGlzLmN1cnJlbnQ7CiAgdGhpcy5jb25maXJtVHJhbnNpdGlvbihyb3V0ZSwgZnVuY3Rpb24gKCkgewogICAgdGhpcyQxJDEudXBkYXRlUm91dGUocm91dGUpOwogICAgb25Db21wbGV0ZSAmJiBvbkNvbXBsZXRlKHJvdXRlKTsKICAgIHRoaXMkMSQxLmVuc3VyZVVSTCgpOwogICAgdGhpcyQxJDEucm91dGVyLmFmdGVySG9va3MuZm9yRWFjaChmdW5jdGlvbiAoaG9vaykgewogICAgICBob29rICYmIGhvb2socm91dGUsIHByZXYpOwogICAgfSk7CgogICAgLy8gZmlyZSByZWFkeSBjYnMgb25jZQogICAgaWYgKCF0aGlzJDEkMS5yZWFkeSkgewogICAgICB0aGlzJDEkMS5yZWFkeSA9IHRydWU7CiAgICAgIHRoaXMkMSQxLnJlYWR5Q2JzLmZvckVhY2goZnVuY3Rpb24gKGNiKSB7CiAgICAgICAgY2Iocm91dGUpOwogICAgICB9KTsKICAgIH0KICB9LCBmdW5jdGlvbiAoZXJyKSB7CiAgICBpZiAob25BYm9ydCkgewogICAgICBvbkFib3J0KGVycik7CiAgICB9CiAgICBpZiAoZXJyICYmICF0aGlzJDEkMS5yZWFkeSkgewogICAgICAvLyBJbml0aWFsIHJlZGlyZWN0aW9uIHNob3VsZCBub3QgbWFyayB0aGUgaGlzdG9yeSBhcyByZWFkeSB5ZXQKICAgICAgLy8gYmVjYXVzZSBpdCdzIHRyaWdnZXJlZCBieSB0aGUgcmVkaXJlY3Rpb24gaW5zdGVhZAogICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vdnVlanMvdnVlLXJvdXRlci9pc3N1ZXMvMzIyNQogICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vdnVlanMvdnVlLXJvdXRlci9pc3N1ZXMvMzMzMQogICAgICBpZiAoIWlzTmF2aWdhdGlvbkZhaWx1cmUoZXJyLCBOYXZpZ2F0aW9uRmFpbHVyZVR5cGUucmVkaXJlY3RlZCkgfHwgcHJldiAhPT0gU1RBUlQpIHsKICAgICAgICB0aGlzJDEkMS5yZWFkeSA9IHRydWU7CiAgICAgICAgdGhpcyQxJDEucmVhZHlFcnJvckNicy5mb3JFYWNoKGZ1bmN0aW9uIChjYikgewogICAgICAgICAgY2IoZXJyKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0pOwp9OwpIaXN0b3J5LnByb3RvdHlwZS5jb25maXJtVHJhbnNpdGlvbiA9IGZ1bmN0aW9uIGNvbmZpcm1UcmFuc2l0aW9uKHJvdXRlLCBvbkNvbXBsZXRlLCBvbkFib3J0KSB7CiAgdmFyIHRoaXMkMSQxID0gdGhpczsKICB2YXIgY3VycmVudCA9IHRoaXMuY3VycmVudDsKICB0aGlzLnBlbmRpbmcgPSByb3V0ZTsKICB2YXIgYWJvcnQgPSBmdW5jdGlvbiAoZXJyKSB7CiAgICAvLyBjaGFuZ2VkIGFmdGVyIGFkZGluZyBlcnJvcnMgd2l0aAogICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3Z1ZWpzL3Z1ZS1yb3V0ZXIvcHVsbC8zMDQ3IGJlZm9yZSB0aGF0IGNoYW5nZSwKICAgIC8vIHJlZGlyZWN0IGFuZCBhYm9ydGVkIG5hdmlnYXRpb24gd291bGQgcHJvZHVjZSBhbiBlcnIgPT0gbnVsbAogICAgaWYgKCFpc05hdmlnYXRpb25GYWlsdXJlKGVycikgJiYgaXNFcnJvcihlcnIpKSB7CiAgICAgIGlmICh0aGlzJDEkMS5lcnJvckNicy5sZW5ndGgpIHsKICAgICAgICB0aGlzJDEkMS5lcnJvckNicy5mb3JFYWNoKGZ1bmN0aW9uIChjYikgewogICAgICAgICAgY2IoZXJyKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgd2FybihmYWxzZSwgJ3VuY2F1Z2h0IGVycm9yIGR1cmluZyByb3V0ZSBuYXZpZ2F0aW9uOicpOwogICAgICAgIH0KICAgICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICAgIH0KICAgIH0KICAgIG9uQWJvcnQgJiYgb25BYm9ydChlcnIpOwogIH07CiAgdmFyIGxhc3RSb3V0ZUluZGV4ID0gcm91dGUubWF0Y2hlZC5sZW5ndGggLSAxOwogIHZhciBsYXN0Q3VycmVudEluZGV4ID0gY3VycmVudC5tYXRjaGVkLmxlbmd0aCAtIDE7CiAgaWYgKGlzU2FtZVJvdXRlKHJvdXRlLCBjdXJyZW50KSAmJgogIC8vIGluIHRoZSBjYXNlIHRoZSByb3V0ZSBtYXAgaGFzIGJlZW4gZHluYW1pY2FsbHkgYXBwZW5kZWQgdG8KICBsYXN0Um91dGVJbmRleCA9PT0gbGFzdEN1cnJlbnRJbmRleCAmJiByb3V0ZS5tYXRjaGVkW2xhc3RSb3V0ZUluZGV4XSA9PT0gY3VycmVudC5tYXRjaGVkW2xhc3RDdXJyZW50SW5kZXhdKSB7CiAgICB0aGlzLmVuc3VyZVVSTCgpOwogICAgaWYgKHJvdXRlLmhhc2gpIHsKICAgICAgaGFuZGxlU2Nyb2xsKHRoaXMucm91dGVyLCBjdXJyZW50LCByb3V0ZSwgZmFsc2UpOwogICAgfQogICAgcmV0dXJuIGFib3J0KGNyZWF0ZU5hdmlnYXRpb25EdXBsaWNhdGVkRXJyb3IoY3VycmVudCwgcm91dGUpKTsKICB9CiAgdmFyIHJlZiA9IHJlc29sdmVRdWV1ZSh0aGlzLmN1cnJlbnQubWF0Y2hlZCwgcm91dGUubWF0Y2hlZCk7CiAgdmFyIHVwZGF0ZWQgPSByZWYudXBkYXRlZDsKICB2YXIgZGVhY3RpdmF0ZWQgPSByZWYuZGVhY3RpdmF0ZWQ7CiAgdmFyIGFjdGl2YXRlZCA9IHJlZi5hY3RpdmF0ZWQ7CiAgdmFyIHF1ZXVlID0gW10uY29uY2F0KAogIC8vIGluLWNvbXBvbmVudCBsZWF2ZSBndWFyZHMKICBleHRyYWN0TGVhdmVHdWFyZHMoZGVhY3RpdmF0ZWQpLAogIC8vIGdsb2JhbCBiZWZvcmUgaG9va3MKICB0aGlzLnJvdXRlci5iZWZvcmVIb29rcywKICAvLyBpbi1jb21wb25lbnQgdXBkYXRlIGhvb2tzCiAgZXh0cmFjdFVwZGF0ZUhvb2tzKHVwZGF0ZWQpLAogIC8vIGluLWNvbmZpZyBlbnRlciBndWFyZHMKICBhY3RpdmF0ZWQubWFwKGZ1bmN0aW9uIChtKSB7CiAgICByZXR1cm4gbS5iZWZvcmVFbnRlcjsKICB9KSwKICAvLyBhc3luYyBjb21wb25lbnRzCiAgcmVzb2x2ZUFzeW5jQ29tcG9uZW50cyhhY3RpdmF0ZWQpKTsKICB2YXIgaXRlcmF0b3IgPSBmdW5jdGlvbiAoaG9vaywgbmV4dCkgewogICAgaWYgKHRoaXMkMSQxLnBlbmRpbmcgIT09IHJvdXRlKSB7CiAgICAgIHJldHVybiBhYm9ydChjcmVhdGVOYXZpZ2F0aW9uQ2FuY2VsbGVkRXJyb3IoY3VycmVudCwgcm91dGUpKTsKICAgIH0KICAgIHRyeSB7CiAgICAgIGhvb2socm91dGUsIGN1cnJlbnQsIGZ1bmN0aW9uICh0bykgewogICAgICAgIGlmICh0byA9PT0gZmFsc2UpIHsKICAgICAgICAgIC8vIG5leHQoZmFsc2UpIC0+IGFib3J0IG5hdmlnYXRpb24sIGVuc3VyZSBjdXJyZW50IFVSTAogICAgICAgICAgdGhpcyQxJDEuZW5zdXJlVVJMKHRydWUpOwogICAgICAgICAgYWJvcnQoY3JlYXRlTmF2aWdhdGlvbkFib3J0ZWRFcnJvcihjdXJyZW50LCByb3V0ZSkpOwogICAgICAgIH0gZWxzZSBpZiAoaXNFcnJvcih0bykpIHsKICAgICAgICAgIHRoaXMkMSQxLmVuc3VyZVVSTCh0cnVlKTsKICAgICAgICAgIGFib3J0KHRvKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB0byA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIHRvID09PSAnb2JqZWN0JyAmJiAodHlwZW9mIHRvLnBhdGggPT09ICdzdHJpbmcnIHx8IHR5cGVvZiB0by5uYW1lID09PSAnc3RyaW5nJykpIHsKICAgICAgICAgIC8vIG5leHQoJy8nKSBvciBuZXh0KHsgcGF0aDogJy8nIH0pIC0+IHJlZGlyZWN0CiAgICAgICAgICBhYm9ydChjcmVhdGVOYXZpZ2F0aW9uUmVkaXJlY3RlZEVycm9yKGN1cnJlbnQsIHJvdXRlKSk7CiAgICAgICAgICBpZiAodHlwZW9mIHRvID09PSAnb2JqZWN0JyAmJiB0by5yZXBsYWNlKSB7CiAgICAgICAgICAgIHRoaXMkMSQxLnJlcGxhY2UodG8pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcyQxJDEucHVzaCh0byk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIGNvbmZpcm0gdHJhbnNpdGlvbiBhbmQgcGFzcyBvbiB0aGUgdmFsdWUKICAgICAgICAgIG5leHQodG8pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGFib3J0KGUpOwogICAgfQogIH07CiAgcnVuUXVldWUocXVldWUsIGl0ZXJhdG9yLCBmdW5jdGlvbiAoKSB7CiAgICAvLyB3YWl0IHVudGlsIGFzeW5jIGNvbXBvbmVudHMgYXJlIHJlc29sdmVkIGJlZm9yZQogICAgLy8gZXh0cmFjdGluZyBpbi1jb21wb25lbnQgZW50ZXIgZ3VhcmRzCiAgICB2YXIgZW50ZXJHdWFyZHMgPSBleHRyYWN0RW50ZXJHdWFyZHMoYWN0aXZhdGVkKTsKICAgIHZhciBxdWV1ZSA9IGVudGVyR3VhcmRzLmNvbmNhdCh0aGlzJDEkMS5yb3V0ZXIucmVzb2x2ZUhvb2tzKTsKICAgIHJ1blF1ZXVlKHF1ZXVlLCBpdGVyYXRvciwgZnVuY3Rpb24gKCkgewogICAgICBpZiAodGhpcyQxJDEucGVuZGluZyAhPT0gcm91dGUpIHsKICAgICAgICByZXR1cm4gYWJvcnQoY3JlYXRlTmF2aWdhdGlvbkNhbmNlbGxlZEVycm9yKGN1cnJlbnQsIHJvdXRlKSk7CiAgICAgIH0KICAgICAgdGhpcyQxJDEucGVuZGluZyA9IG51bGw7CiAgICAgIG9uQ29tcGxldGUocm91dGUpOwogICAgICBpZiAodGhpcyQxJDEucm91dGVyLmFwcCkgewogICAgICAgIHRoaXMkMSQxLnJvdXRlci5hcHAuJG5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGhhbmRsZVJvdXRlRW50ZXJlZChyb3V0ZSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0pOwogIH0pOwp9OwpIaXN0b3J5LnByb3RvdHlwZS51cGRhdGVSb3V0ZSA9IGZ1bmN0aW9uIHVwZGF0ZVJvdXRlKHJvdXRlKSB7CiAgdGhpcy5jdXJyZW50ID0gcm91dGU7CiAgdGhpcy5jYiAmJiB0aGlzLmNiKHJvdXRlKTsKfTsKSGlzdG9yeS5wcm90b3R5cGUuc2V0dXBMaXN0ZW5lcnMgPSBmdW5jdGlvbiBzZXR1cExpc3RlbmVycygpIHsKICAvLyBEZWZhdWx0IGltcGxlbWVudGF0aW9uIGlzIGVtcHR5Cn07Ckhpc3RvcnkucHJvdG90eXBlLnRlYXJkb3duID0gZnVuY3Rpb24gdGVhcmRvd24oKSB7CiAgLy8gY2xlYW4gdXAgZXZlbnQgbGlzdGVuZXJzCiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3Z1ZWpzL3Z1ZS1yb3V0ZXIvaXNzdWVzLzIzNDEKICB0aGlzLmxpc3RlbmVycy5mb3JFYWNoKGZ1bmN0aW9uIChjbGVhbnVwTGlzdGVuZXIpIHsKICAgIGNsZWFudXBMaXN0ZW5lcigpOwogIH0pOwogIHRoaXMubGlzdGVuZXJzID0gW107CgogIC8vIHJlc2V0IGN1cnJlbnQgaGlzdG9yeSByb3V0ZQogIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS92dWVqcy92dWUtcm91dGVyL2lzc3Vlcy8zMjk0CiAgdGhpcy5jdXJyZW50ID0gU1RBUlQ7CiAgdGhpcy5wZW5kaW5nID0gbnVsbDsKfTsKZnVuY3Rpb24gbm9ybWFsaXplQmFzZShiYXNlKSB7CiAgaWYgKCFiYXNlKSB7CiAgICBpZiAoaW5Ccm93c2VyKSB7CiAgICAgIC8vIHJlc3BlY3QgPGJhc2U+IHRhZwogICAgICB2YXIgYmFzZUVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYmFzZScpOwogICAgICBiYXNlID0gYmFzZUVsICYmIGJhc2VFbC5nZXRBdHRyaWJ1dGUoJ2hyZWYnKSB8fCAnLyc7CiAgICAgIC8vIHN0cmlwIGZ1bGwgVVJMIG9yaWdpbgogICAgICBiYXNlID0gYmFzZS5yZXBsYWNlKC9eaHR0cHM/OlwvXC9bXlwvXSsvLCAnJyk7CiAgICB9IGVsc2UgewogICAgICBiYXNlID0gJy8nOwogICAgfQogIH0KICAvLyBtYWtlIHN1cmUgdGhlcmUncyB0aGUgc3RhcnRpbmcgc2xhc2gKICBpZiAoYmFzZS5jaGFyQXQoMCkgIT09ICcvJykgewogICAgYmFzZSA9ICcvJyArIGJhc2U7CiAgfQogIC8vIHJlbW92ZSB0cmFpbGluZyBzbGFzaAogIHJldHVybiBiYXNlLnJlcGxhY2UoL1wvJC8sICcnKTsKfQpmdW5jdGlvbiByZXNvbHZlUXVldWUoY3VycmVudCwgbmV4dCkgewogIHZhciBpOwogIHZhciBtYXggPSBNYXRoLm1heChjdXJyZW50Lmxlbmd0aCwgbmV4dC5sZW5ndGgpOwogIGZvciAoaSA9IDA7IGkgPCBtYXg7IGkrKykgewogICAgaWYgKGN1cnJlbnRbaV0gIT09IG5leHRbaV0pIHsKICAgICAgYnJlYWs7CiAgICB9CiAgfQogIHJldHVybiB7CiAgICB1cGRhdGVkOiBuZXh0LnNsaWNlKDAsIGkpLAogICAgYWN0aXZhdGVkOiBuZXh0LnNsaWNlKGkpLAogICAgZGVhY3RpdmF0ZWQ6IGN1cnJlbnQuc2xpY2UoaSkKICB9Owp9CmZ1bmN0aW9uIGV4dHJhY3RHdWFyZHMocmVjb3JkcywgbmFtZSwgYmluZCwgcmV2ZXJzZSkgewogIHZhciBndWFyZHMgPSBmbGF0TWFwQ29tcG9uZW50cyhyZWNvcmRzLCBmdW5jdGlvbiAoZGVmLCBpbnN0YW5jZSwgbWF0Y2gsIGtleSkgewogICAgdmFyIGd1YXJkID0gZXh0cmFjdEd1YXJkKGRlZiwgbmFtZSk7CiAgICBpZiAoZ3VhcmQpIHsKICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoZ3VhcmQpID8gZ3VhcmQubWFwKGZ1bmN0aW9uIChndWFyZCkgewogICAgICAgIHJldHVybiBiaW5kKGd1YXJkLCBpbnN0YW5jZSwgbWF0Y2gsIGtleSk7CiAgICAgIH0pIDogYmluZChndWFyZCwgaW5zdGFuY2UsIG1hdGNoLCBrZXkpOwogICAgfQogIH0pOwogIHJldHVybiBmbGF0dGVuKHJldmVyc2UgPyBndWFyZHMucmV2ZXJzZSgpIDogZ3VhcmRzKTsKfQpmdW5jdGlvbiBleHRyYWN0R3VhcmQoZGVmLCBrZXkpIHsKICBpZiAodHlwZW9mIGRlZiAhPT0gJ2Z1bmN0aW9uJykgewogICAgLy8gZXh0ZW5kIG5vdyBzbyB0aGF0IGdsb2JhbCBtaXhpbnMgYXJlIGFwcGxpZWQuCiAgICBkZWYgPSBfVnVlLmV4dGVuZChkZWYpOwogIH0KICByZXR1cm4gZGVmLm9wdGlvbnNba2V5XTsKfQpmdW5jdGlvbiBleHRyYWN0TGVhdmVHdWFyZHMoZGVhY3RpdmF0ZWQpIHsKICByZXR1cm4gZXh0cmFjdEd1YXJkcyhkZWFjdGl2YXRlZCwgJ2JlZm9yZVJvdXRlTGVhdmUnLCBiaW5kR3VhcmQsIHRydWUpOwp9CmZ1bmN0aW9uIGV4dHJhY3RVcGRhdGVIb29rcyh1cGRhdGVkKSB7CiAgcmV0dXJuIGV4dHJhY3RHdWFyZHModXBkYXRlZCwgJ2JlZm9yZVJvdXRlVXBkYXRlJywgYmluZEd1YXJkKTsKfQpmdW5jdGlvbiBiaW5kR3VhcmQoZ3VhcmQsIGluc3RhbmNlKSB7CiAgaWYgKGluc3RhbmNlKSB7CiAgICByZXR1cm4gZnVuY3Rpb24gYm91bmRSb3V0ZUd1YXJkKCkgewogICAgICByZXR1cm4gZ3VhcmQuYXBwbHkoaW5zdGFuY2UsIGFyZ3VtZW50cyk7CiAgICB9OwogIH0KfQpmdW5jdGlvbiBleHRyYWN0RW50ZXJHdWFyZHMoYWN0aXZhdGVkKSB7CiAgcmV0dXJuIGV4dHJhY3RHdWFyZHMoYWN0aXZhdGVkLCAnYmVmb3JlUm91dGVFbnRlcicsIGZ1bmN0aW9uIChndWFyZCwgXywgbWF0Y2gsIGtleSkgewogICAgcmV0dXJuIGJpbmRFbnRlckd1YXJkKGd1YXJkLCBtYXRjaCwga2V5KTsKICB9KTsKfQpmdW5jdGlvbiBiaW5kRW50ZXJHdWFyZChndWFyZCwgbWF0Y2gsIGtleSkgewogIHJldHVybiBmdW5jdGlvbiByb3V0ZUVudGVyR3VhcmQodG8sIGZyb20sIG5leHQpIHsKICAgIHJldHVybiBndWFyZCh0bywgZnJvbSwgZnVuY3Rpb24gKGNiKSB7CiAgICAgIGlmICh0eXBlb2YgY2IgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICBpZiAoIW1hdGNoLmVudGVyZWRDYnNba2V5XSkgewogICAgICAgICAgbWF0Y2guZW50ZXJlZENic1trZXldID0gW107CiAgICAgICAgfQogICAgICAgIG1hdGNoLmVudGVyZWRDYnNba2V5XS5wdXNoKGNiKTsKICAgICAgfQogICAgICBuZXh0KGNiKTsKICAgIH0pOwogIH07Cn0KCi8qICAqLwoKdmFyIEhUTUw1SGlzdG9yeSA9IC8qQF9fUFVSRV9fKi9mdW5jdGlvbiAoSGlzdG9yeSkgewogIGZ1bmN0aW9uIEhUTUw1SGlzdG9yeShyb3V0ZXIsIGJhc2UpIHsKICAgIEhpc3RvcnkuY2FsbCh0aGlzLCByb3V0ZXIsIGJhc2UpOwogICAgdGhpcy5fc3RhcnRMb2NhdGlvbiA9IGdldExvY2F0aW9uKHRoaXMuYmFzZSk7CiAgfQogIGlmIChIaXN0b3J5KSBIVE1MNUhpc3RvcnkuX19wcm90b19fID0gSGlzdG9yeTsKICBIVE1MNUhpc3RvcnkucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShIaXN0b3J5ICYmIEhpc3RvcnkucHJvdG90eXBlKTsKICBIVE1MNUhpc3RvcnkucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gSFRNTDVIaXN0b3J5OwogIEhUTUw1SGlzdG9yeS5wcm90b3R5cGUuc2V0dXBMaXN0ZW5lcnMgPSBmdW5jdGlvbiBzZXR1cExpc3RlbmVycygpIHsKICAgIHZhciB0aGlzJDEkMSA9IHRoaXM7CiAgICBpZiAodGhpcy5saXN0ZW5lcnMubGVuZ3RoID4gMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB2YXIgcm91dGVyID0gdGhpcy5yb3V0ZXI7CiAgICB2YXIgZXhwZWN0U2Nyb2xsID0gcm91dGVyLm9wdGlvbnMuc2Nyb2xsQmVoYXZpb3I7CiAgICB2YXIgc3VwcG9ydHNTY3JvbGwgPSBzdXBwb3J0c1B1c2hTdGF0ZSAmJiBleHBlY3RTY3JvbGw7CiAgICBpZiAoc3VwcG9ydHNTY3JvbGwpIHsKICAgICAgdGhpcy5saXN0ZW5lcnMucHVzaChzZXR1cFNjcm9sbCgpKTsKICAgIH0KICAgIHZhciBoYW5kbGVSb3V0aW5nRXZlbnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBjdXJyZW50ID0gdGhpcyQxJDEuY3VycmVudDsKCiAgICAgIC8vIEF2b2lkaW5nIGZpcnN0IGBwb3BzdGF0ZWAgZXZlbnQgZGlzcGF0Y2hlZCBpbiBzb21lIGJyb3dzZXJzIGJ1dCBmaXJzdAogICAgICAvLyBoaXN0b3J5IHJvdXRlIG5vdCB1cGRhdGVkIHNpbmNlIGFzeW5jIGd1YXJkIGF0IHRoZSBzYW1lIHRpbWUuCiAgICAgIHZhciBsb2NhdGlvbiA9IGdldExvY2F0aW9uKHRoaXMkMSQxLmJhc2UpOwogICAgICBpZiAodGhpcyQxJDEuY3VycmVudCA9PT0gU1RBUlQgJiYgbG9jYXRpb24gPT09IHRoaXMkMSQxLl9zdGFydExvY2F0aW9uKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMkMSQxLnRyYW5zaXRpb25Ubyhsb2NhdGlvbiwgZnVuY3Rpb24gKHJvdXRlKSB7CiAgICAgICAgaWYgKHN1cHBvcnRzU2Nyb2xsKSB7CiAgICAgICAgICBoYW5kbGVTY3JvbGwocm91dGVyLCByb3V0ZSwgY3VycmVudCwgdHJ1ZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncG9wc3RhdGUnLCBoYW5kbGVSb3V0aW5nRXZlbnQpOwogICAgdGhpcy5saXN0ZW5lcnMucHVzaChmdW5jdGlvbiAoKSB7CiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdwb3BzdGF0ZScsIGhhbmRsZVJvdXRpbmdFdmVudCk7CiAgICB9KTsKICB9OwogIEhUTUw1SGlzdG9yeS5wcm90b3R5cGUuZ28gPSBmdW5jdGlvbiBnbyhuKSB7CiAgICB3aW5kb3cuaGlzdG9yeS5nbyhuKTsKICB9OwogIEhUTUw1SGlzdG9yeS5wcm90b3R5cGUucHVzaCA9IGZ1bmN0aW9uIHB1c2gobG9jYXRpb24sIG9uQ29tcGxldGUsIG9uQWJvcnQpIHsKICAgIHZhciB0aGlzJDEkMSA9IHRoaXM7CiAgICB2YXIgcmVmID0gdGhpczsKICAgIHZhciBmcm9tUm91dGUgPSByZWYuY3VycmVudDsKICAgIHRoaXMudHJhbnNpdGlvblRvKGxvY2F0aW9uLCBmdW5jdGlvbiAocm91dGUpIHsKICAgICAgcHVzaFN0YXRlKGNsZWFuUGF0aCh0aGlzJDEkMS5iYXNlICsgcm91dGUuZnVsbFBhdGgpKTsKICAgICAgaGFuZGxlU2Nyb2xsKHRoaXMkMSQxLnJvdXRlciwgcm91dGUsIGZyb21Sb3V0ZSwgZmFsc2UpOwogICAgICBvbkNvbXBsZXRlICYmIG9uQ29tcGxldGUocm91dGUpOwogICAgfSwgb25BYm9ydCk7CiAgfTsKICBIVE1MNUhpc3RvcnkucHJvdG90eXBlLnJlcGxhY2UgPSBmdW5jdGlvbiByZXBsYWNlKGxvY2F0aW9uLCBvbkNvbXBsZXRlLCBvbkFib3J0KSB7CiAgICB2YXIgdGhpcyQxJDEgPSB0aGlzOwogICAgdmFyIHJlZiA9IHRoaXM7CiAgICB2YXIgZnJvbVJvdXRlID0gcmVmLmN1cnJlbnQ7CiAgICB0aGlzLnRyYW5zaXRpb25Ubyhsb2NhdGlvbiwgZnVuY3Rpb24gKHJvdXRlKSB7CiAgICAgIHJlcGxhY2VTdGF0ZShjbGVhblBhdGgodGhpcyQxJDEuYmFzZSArIHJvdXRlLmZ1bGxQYXRoKSk7CiAgICAgIGhhbmRsZVNjcm9sbCh0aGlzJDEkMS5yb3V0ZXIsIHJvdXRlLCBmcm9tUm91dGUsIGZhbHNlKTsKICAgICAgb25Db21wbGV0ZSAmJiBvbkNvbXBsZXRlKHJvdXRlKTsKICAgIH0sIG9uQWJvcnQpOwogIH07CiAgSFRNTDVIaXN0b3J5LnByb3RvdHlwZS5lbnN1cmVVUkwgPSBmdW5jdGlvbiBlbnN1cmVVUkwocHVzaCkgewogICAgaWYgKGdldExvY2F0aW9uKHRoaXMuYmFzZSkgIT09IHRoaXMuY3VycmVudC5mdWxsUGF0aCkgewogICAgICB2YXIgY3VycmVudCA9IGNsZWFuUGF0aCh0aGlzLmJhc2UgKyB0aGlzLmN1cnJlbnQuZnVsbFBhdGgpOwogICAgICBwdXNoID8gcHVzaFN0YXRlKGN1cnJlbnQpIDogcmVwbGFjZVN0YXRlKGN1cnJlbnQpOwogICAgfQogIH07CiAgSFRNTDVIaXN0b3J5LnByb3RvdHlwZS5nZXRDdXJyZW50TG9jYXRpb24gPSBmdW5jdGlvbiBnZXRDdXJyZW50TG9jYXRpb24oKSB7CiAgICByZXR1cm4gZ2V0TG9jYXRpb24odGhpcy5iYXNlKTsKICB9OwogIHJldHVybiBIVE1MNUhpc3Rvcnk7Cn0oSGlzdG9yeSk7CmZ1bmN0aW9uIGdldExvY2F0aW9uKGJhc2UpIHsKICB2YXIgcGF0aCA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZTsKICB2YXIgcGF0aExvd2VyQ2FzZSA9IHBhdGgudG9Mb3dlckNhc2UoKTsKICB2YXIgYmFzZUxvd2VyQ2FzZSA9IGJhc2UudG9Mb3dlckNhc2UoKTsKICAvLyBiYXNlPSIvYSIgc2hvdWxkbid0IHR1cm4gcGF0aD0iL2FwcCIgaW50byAiL2EvcHAiCiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3Z1ZWpzL3Z1ZS1yb3V0ZXIvaXNzdWVzLzM1NTUKICAvLyBzbyB3ZSBlbnN1cmUgdGhlIHRyYWlsaW5nIHNsYXNoIGluIHRoZSBiYXNlCiAgaWYgKGJhc2UgJiYgKHBhdGhMb3dlckNhc2UgPT09IGJhc2VMb3dlckNhc2UgfHwgcGF0aExvd2VyQ2FzZS5pbmRleE9mKGNsZWFuUGF0aChiYXNlTG93ZXJDYXNlICsgJy8nKSkgPT09IDApKSB7CiAgICBwYXRoID0gcGF0aC5zbGljZShiYXNlLmxlbmd0aCk7CiAgfQogIHJldHVybiAocGF0aCB8fCAnLycpICsgd2luZG93LmxvY2F0aW9uLnNlYXJjaCArIHdpbmRvdy5sb2NhdGlvbi5oYXNoOwp9CgovKiAgKi8KCnZhciBIYXNoSGlzdG9yeSA9IC8qQF9fUFVSRV9fKi9mdW5jdGlvbiAoSGlzdG9yeSkgewogIGZ1bmN0aW9uIEhhc2hIaXN0b3J5KHJvdXRlciwgYmFzZSwgZmFsbGJhY2spIHsKICAgIEhpc3RvcnkuY2FsbCh0aGlzLCByb3V0ZXIsIGJhc2UpOwogICAgLy8gY2hlY2sgaGlzdG9yeSBmYWxsYmFjayBkZWVwbGlua2luZwogICAgaWYgKGZhbGxiYWNrICYmIGNoZWNrRmFsbGJhY2sodGhpcy5iYXNlKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBlbnN1cmVTbGFzaCgpOwogIH0KICBpZiAoSGlzdG9yeSkgSGFzaEhpc3RvcnkuX19wcm90b19fID0gSGlzdG9yeTsKICBIYXNoSGlzdG9yeS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEhpc3RvcnkgJiYgSGlzdG9yeS5wcm90b3R5cGUpOwogIEhhc2hIaXN0b3J5LnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IEhhc2hIaXN0b3J5OwoKICAvLyB0aGlzIGlzIGRlbGF5ZWQgdW50aWwgdGhlIGFwcCBtb3VudHMKICAvLyB0byBhdm9pZCB0aGUgaGFzaGNoYW5nZSBsaXN0ZW5lciBiZWluZyBmaXJlZCB0b28gZWFybHkKICBIYXNoSGlzdG9yeS5wcm90b3R5cGUuc2V0dXBMaXN0ZW5lcnMgPSBmdW5jdGlvbiBzZXR1cExpc3RlbmVycygpIHsKICAgIHZhciB0aGlzJDEkMSA9IHRoaXM7CiAgICBpZiAodGhpcy5saXN0ZW5lcnMubGVuZ3RoID4gMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB2YXIgcm91dGVyID0gdGhpcy5yb3V0ZXI7CiAgICB2YXIgZXhwZWN0U2Nyb2xsID0gcm91dGVyLm9wdGlvbnMuc2Nyb2xsQmVoYXZpb3I7CiAgICB2YXIgc3VwcG9ydHNTY3JvbGwgPSBzdXBwb3J0c1B1c2hTdGF0ZSAmJiBleHBlY3RTY3JvbGw7CiAgICBpZiAoc3VwcG9ydHNTY3JvbGwpIHsKICAgICAgdGhpcy5saXN0ZW5lcnMucHVzaChzZXR1cFNjcm9sbCgpKTsKICAgIH0KICAgIHZhciBoYW5kbGVSb3V0aW5nRXZlbnQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBjdXJyZW50ID0gdGhpcyQxJDEuY3VycmVudDsKICAgICAgaWYgKCFlbnN1cmVTbGFzaCgpKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMkMSQxLnRyYW5zaXRpb25UbyhnZXRIYXNoKCksIGZ1bmN0aW9uIChyb3V0ZSkgewogICAgICAgIGlmIChzdXBwb3J0c1Njcm9sbCkgewogICAgICAgICAgaGFuZGxlU2Nyb2xsKHRoaXMkMSQxLnJvdXRlciwgcm91dGUsIGN1cnJlbnQsIHRydWUpOwogICAgICAgIH0KICAgICAgICBpZiAoIXN1cHBvcnRzUHVzaFN0YXRlKSB7CiAgICAgICAgICByZXBsYWNlSGFzaChyb3V0ZS5mdWxsUGF0aCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH07CiAgICB2YXIgZXZlbnRUeXBlID0gc3VwcG9ydHNQdXNoU3RhdGUgPyAncG9wc3RhdGUnIDogJ2hhc2hjaGFuZ2UnOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlLCBoYW5kbGVSb3V0aW5nRXZlbnQpOwogICAgdGhpcy5saXN0ZW5lcnMucHVzaChmdW5jdGlvbiAoKSB7CiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50VHlwZSwgaGFuZGxlUm91dGluZ0V2ZW50KTsKICAgIH0pOwogIH07CiAgSGFzaEhpc3RvcnkucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbiBwdXNoKGxvY2F0aW9uLCBvbkNvbXBsZXRlLCBvbkFib3J0KSB7CiAgICB2YXIgdGhpcyQxJDEgPSB0aGlzOwogICAgdmFyIHJlZiA9IHRoaXM7CiAgICB2YXIgZnJvbVJvdXRlID0gcmVmLmN1cnJlbnQ7CiAgICB0aGlzLnRyYW5zaXRpb25Ubyhsb2NhdGlvbiwgZnVuY3Rpb24gKHJvdXRlKSB7CiAgICAgIHB1c2hIYXNoKHJvdXRlLmZ1bGxQYXRoKTsKICAgICAgaGFuZGxlU2Nyb2xsKHRoaXMkMSQxLnJvdXRlciwgcm91dGUsIGZyb21Sb3V0ZSwgZmFsc2UpOwogICAgICBvbkNvbXBsZXRlICYmIG9uQ29tcGxldGUocm91dGUpOwogICAgfSwgb25BYm9ydCk7CiAgfTsKICBIYXNoSGlzdG9yeS5wcm90b3R5cGUucmVwbGFjZSA9IGZ1bmN0aW9uIHJlcGxhY2UobG9jYXRpb24sIG9uQ29tcGxldGUsIG9uQWJvcnQpIHsKICAgIHZhciB0aGlzJDEkMSA9IHRoaXM7CiAgICB2YXIgcmVmID0gdGhpczsKICAgIHZhciBmcm9tUm91dGUgPSByZWYuY3VycmVudDsKICAgIHRoaXMudHJhbnNpdGlvblRvKGxvY2F0aW9uLCBmdW5jdGlvbiAocm91dGUpIHsKICAgICAgcmVwbGFjZUhhc2gocm91dGUuZnVsbFBhdGgpOwogICAgICBoYW5kbGVTY3JvbGwodGhpcyQxJDEucm91dGVyLCByb3V0ZSwgZnJvbVJvdXRlLCBmYWxzZSk7CiAgICAgIG9uQ29tcGxldGUgJiYgb25Db21wbGV0ZShyb3V0ZSk7CiAgICB9LCBvbkFib3J0KTsKICB9OwogIEhhc2hIaXN0b3J5LnByb3RvdHlwZS5nbyA9IGZ1bmN0aW9uIGdvKG4pIHsKICAgIHdpbmRvdy5oaXN0b3J5LmdvKG4pOwogIH07CiAgSGFzaEhpc3RvcnkucHJvdG90eXBlLmVuc3VyZVVSTCA9IGZ1bmN0aW9uIGVuc3VyZVVSTChwdXNoKSB7CiAgICB2YXIgY3VycmVudCA9IHRoaXMuY3VycmVudC5mdWxsUGF0aDsKICAgIGlmIChnZXRIYXNoKCkgIT09IGN1cnJlbnQpIHsKICAgICAgcHVzaCA/IHB1c2hIYXNoKGN1cnJlbnQpIDogcmVwbGFjZUhhc2goY3VycmVudCk7CiAgICB9CiAgfTsKICBIYXNoSGlzdG9yeS5wcm90b3R5cGUuZ2V0Q3VycmVudExvY2F0aW9uID0gZnVuY3Rpb24gZ2V0Q3VycmVudExvY2F0aW9uKCkgewogICAgcmV0dXJuIGdldEhhc2goKTsKICB9OwogIHJldHVybiBIYXNoSGlzdG9yeTsKfShIaXN0b3J5KTsKZnVuY3Rpb24gY2hlY2tGYWxsYmFjayhiYXNlKSB7CiAgdmFyIGxvY2F0aW9uID0gZ2V0TG9jYXRpb24oYmFzZSk7CiAgaWYgKCEvXlwvIy8udGVzdChsb2NhdGlvbikpIHsKICAgIHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKGNsZWFuUGF0aChiYXNlICsgJy8jJyArIGxvY2F0aW9uKSk7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KZnVuY3Rpb24gZW5zdXJlU2xhc2goKSB7CiAgdmFyIHBhdGggPSBnZXRIYXNoKCk7CiAgaWYgKHBhdGguY2hhckF0KDApID09PSAnLycpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICByZXBsYWNlSGFzaCgnLycgKyBwYXRoKTsKICByZXR1cm4gZmFsc2U7Cn0KZnVuY3Rpb24gZ2V0SGFzaCgpIHsKICAvLyBXZSBjYW4ndCB1c2Ugd2luZG93LmxvY2F0aW9uLmhhc2ggaGVyZSBiZWNhdXNlIGl0J3Mgbm90CiAgLy8gY29uc2lzdGVudCBhY3Jvc3MgYnJvd3NlcnMgLSBGaXJlZm94IHdpbGwgcHJlLWRlY29kZSBpdCEKICB2YXIgaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOwogIHZhciBpbmRleCA9IGhyZWYuaW5kZXhPZignIycpOwogIC8vIGVtcHR5IHBhdGgKICBpZiAoaW5kZXggPCAwKSB7CiAgICByZXR1cm4gJyc7CiAgfQogIGhyZWYgPSBocmVmLnNsaWNlKGluZGV4ICsgMSk7CiAgcmV0dXJuIGhyZWY7Cn0KZnVuY3Rpb24gZ2V0VXJsKHBhdGgpIHsKICB2YXIgaHJlZiA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOwogIHZhciBpID0gaHJlZi5pbmRleE9mKCcjJyk7CiAgdmFyIGJhc2UgPSBpID49IDAgPyBocmVmLnNsaWNlKDAsIGkpIDogaHJlZjsKICByZXR1cm4gYmFzZSArICIjIiArIHBhdGg7Cn0KZnVuY3Rpb24gcHVzaEhhc2gocGF0aCkgewogIGlmIChzdXBwb3J0c1B1c2hTdGF0ZSkgewogICAgcHVzaFN0YXRlKGdldFVybChwYXRoKSk7CiAgfSBlbHNlIHsKICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gcGF0aDsKICB9Cn0KZnVuY3Rpb24gcmVwbGFjZUhhc2gocGF0aCkgewogIGlmIChzdXBwb3J0c1B1c2hTdGF0ZSkgewogICAgcmVwbGFjZVN0YXRlKGdldFVybChwYXRoKSk7CiAgfSBlbHNlIHsKICAgIHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKGdldFVybChwYXRoKSk7CiAgfQp9CgovKiAgKi8KCnZhciBBYnN0cmFjdEhpc3RvcnkgPSAvKkBfX1BVUkVfXyovZnVuY3Rpb24gKEhpc3RvcnkpIHsKICBmdW5jdGlvbiBBYnN0cmFjdEhpc3Rvcnkocm91dGVyLCBiYXNlKSB7CiAgICBIaXN0b3J5LmNhbGwodGhpcywgcm91dGVyLCBiYXNlKTsKICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgIHRoaXMuaW5kZXggPSAtMTsKICB9CiAgaWYgKEhpc3RvcnkpIEFic3RyYWN0SGlzdG9yeS5fX3Byb3RvX18gPSBIaXN0b3J5OwogIEFic3RyYWN0SGlzdG9yeS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEhpc3RvcnkgJiYgSGlzdG9yeS5wcm90b3R5cGUpOwogIEFic3RyYWN0SGlzdG9yeS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBBYnN0cmFjdEhpc3Rvcnk7CiAgQWJzdHJhY3RIaXN0b3J5LnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gcHVzaChsb2NhdGlvbiwgb25Db21wbGV0ZSwgb25BYm9ydCkgewogICAgdmFyIHRoaXMkMSQxID0gdGhpczsKICAgIHRoaXMudHJhbnNpdGlvblRvKGxvY2F0aW9uLCBmdW5jdGlvbiAocm91dGUpIHsKICAgICAgdGhpcyQxJDEuc3RhY2sgPSB0aGlzJDEkMS5zdGFjay5zbGljZSgwLCB0aGlzJDEkMS5pbmRleCArIDEpLmNvbmNhdChyb3V0ZSk7CiAgICAgIHRoaXMkMSQxLmluZGV4Kys7CiAgICAgIG9uQ29tcGxldGUgJiYgb25Db21wbGV0ZShyb3V0ZSk7CiAgICB9LCBvbkFib3J0KTsKICB9OwogIEFic3RyYWN0SGlzdG9yeS5wcm90b3R5cGUucmVwbGFjZSA9IGZ1bmN0aW9uIHJlcGxhY2UobG9jYXRpb24sIG9uQ29tcGxldGUsIG9uQWJvcnQpIHsKICAgIHZhciB0aGlzJDEkMSA9IHRoaXM7CiAgICB0aGlzLnRyYW5zaXRpb25Ubyhsb2NhdGlvbiwgZnVuY3Rpb24gKHJvdXRlKSB7CiAgICAgIHRoaXMkMSQxLnN0YWNrID0gdGhpcyQxJDEuc3RhY2suc2xpY2UoMCwgdGhpcyQxJDEuaW5kZXgpLmNvbmNhdChyb3V0ZSk7CiAgICAgIG9uQ29tcGxldGUgJiYgb25Db21wbGV0ZShyb3V0ZSk7CiAgICB9LCBvbkFib3J0KTsKICB9OwogIEFic3RyYWN0SGlzdG9yeS5wcm90b3R5cGUuZ28gPSBmdW5jdGlvbiBnbyhuKSB7CiAgICB2YXIgdGhpcyQxJDEgPSB0aGlzOwogICAgdmFyIHRhcmdldEluZGV4ID0gdGhpcy5pbmRleCArIG47CiAgICBpZiAodGFyZ2V0SW5kZXggPCAwIHx8IHRhcmdldEluZGV4ID49IHRoaXMuc3RhY2subGVuZ3RoKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHZhciByb3V0ZSA9IHRoaXMuc3RhY2tbdGFyZ2V0SW5kZXhdOwogICAgdGhpcy5jb25maXJtVHJhbnNpdGlvbihyb3V0ZSwgZnVuY3Rpb24gKCkgewogICAgICB2YXIgcHJldiA9IHRoaXMkMSQxLmN1cnJlbnQ7CiAgICAgIHRoaXMkMSQxLmluZGV4ID0gdGFyZ2V0SW5kZXg7CiAgICAgIHRoaXMkMSQxLnVwZGF0ZVJvdXRlKHJvdXRlKTsKICAgICAgdGhpcyQxJDEucm91dGVyLmFmdGVySG9va3MuZm9yRWFjaChmdW5jdGlvbiAoaG9vaykgewogICAgICAgIGhvb2sgJiYgaG9vayhyb3V0ZSwgcHJldik7CiAgICAgIH0pOwogICAgfSwgZnVuY3Rpb24gKGVycikgewogICAgICBpZiAoaXNOYXZpZ2F0aW9uRmFpbHVyZShlcnIsIE5hdmlnYXRpb25GYWlsdXJlVHlwZS5kdXBsaWNhdGVkKSkgewogICAgICAgIHRoaXMkMSQxLmluZGV4ID0gdGFyZ2V0SW5kZXg7CiAgICAgIH0KICAgIH0pOwogIH07CiAgQWJzdHJhY3RIaXN0b3J5LnByb3RvdHlwZS5nZXRDdXJyZW50TG9jYXRpb24gPSBmdW5jdGlvbiBnZXRDdXJyZW50TG9jYXRpb24oKSB7CiAgICB2YXIgY3VycmVudCA9IHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSAxXTsKICAgIHJldHVybiBjdXJyZW50ID8gY3VycmVudC5mdWxsUGF0aCA6ICcvJzsKICB9OwogIEFic3RyYWN0SGlzdG9yeS5wcm90b3R5cGUuZW5zdXJlVVJMID0gZnVuY3Rpb24gZW5zdXJlVVJMKCkgewogICAgLy8gbm9vcAogIH07CiAgcmV0dXJuIEFic3RyYWN0SGlzdG9yeTsKfShIaXN0b3J5KTsKCi8qICAqLwoKdmFyIFZ1ZVJvdXRlciA9IGZ1bmN0aW9uIFZ1ZVJvdXRlcihvcHRpb25zKSB7CiAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgb3B0aW9ucyA9IHt9OwogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICB3YXJuKHRoaXMgaW5zdGFuY2VvZiBWdWVSb3V0ZXIsICJSb3V0ZXIgbXVzdCBiZSBjYWxsZWQgd2l0aCB0aGUgbmV3IG9wZXJhdG9yLiIpOwogIH0KICB0aGlzLmFwcCA9IG51bGw7CiAgdGhpcy5hcHBzID0gW107CiAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICB0aGlzLmJlZm9yZUhvb2tzID0gW107CiAgdGhpcy5yZXNvbHZlSG9va3MgPSBbXTsKICB0aGlzLmFmdGVySG9va3MgPSBbXTsKICB0aGlzLm1hdGNoZXIgPSBjcmVhdGVNYXRjaGVyKG9wdGlvbnMucm91dGVzIHx8IFtdLCB0aGlzKTsKICB2YXIgbW9kZSA9IG9wdGlvbnMubW9kZSB8fCAnaGFzaCc7CiAgdGhpcy5mYWxsYmFjayA9IG1vZGUgPT09ICdoaXN0b3J5JyAmJiAhc3VwcG9ydHNQdXNoU3RhdGUgJiYgb3B0aW9ucy5mYWxsYmFjayAhPT0gZmFsc2U7CiAgaWYgKHRoaXMuZmFsbGJhY2spIHsKICAgIG1vZGUgPSAnaGFzaCc7CiAgfQogIGlmICghaW5Ccm93c2VyKSB7CiAgICBtb2RlID0gJ2Fic3RyYWN0JzsKICB9CiAgdGhpcy5tb2RlID0gbW9kZTsKICBzd2l0Y2ggKG1vZGUpIHsKICAgIGNhc2UgJ2hpc3RvcnknOgogICAgICB0aGlzLmhpc3RvcnkgPSBuZXcgSFRNTDVIaXN0b3J5KHRoaXMsIG9wdGlvbnMuYmFzZSk7CiAgICAgIGJyZWFrOwogICAgY2FzZSAnaGFzaCc6CiAgICAgIHRoaXMuaGlzdG9yeSA9IG5ldyBIYXNoSGlzdG9yeSh0aGlzLCBvcHRpb25zLmJhc2UsIHRoaXMuZmFsbGJhY2spOwogICAgICBicmVhazsKICAgIGNhc2UgJ2Fic3RyYWN0JzoKICAgICAgdGhpcy5oaXN0b3J5ID0gbmV3IEFic3RyYWN0SGlzdG9yeSh0aGlzLCBvcHRpb25zLmJhc2UpOwogICAgICBicmVhazsKICAgIGRlZmF1bHQ6CiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgYXNzZXJ0KGZhbHNlLCAiaW52YWxpZCBtb2RlOiAiICsgbW9kZSk7CiAgICAgIH0KICB9Cn07CnZhciBwcm90b3R5cGVBY2Nlc3NvcnMgPSB7CiAgY3VycmVudFJvdXRlOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9Cn07ClZ1ZVJvdXRlci5wcm90b3R5cGUubWF0Y2ggPSBmdW5jdGlvbiBtYXRjaChyYXcsIGN1cnJlbnQsIHJlZGlyZWN0ZWRGcm9tKSB7CiAgcmV0dXJuIHRoaXMubWF0Y2hlci5tYXRjaChyYXcsIGN1cnJlbnQsIHJlZGlyZWN0ZWRGcm9tKTsKfTsKcHJvdG90eXBlQWNjZXNzb3JzLmN1cnJlbnRSb3V0ZS5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuaGlzdG9yeSAmJiB0aGlzLmhpc3RvcnkuY3VycmVudDsKfTsKVnVlUm91dGVyLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gaW5pdChhcHAgLyogVnVlIGNvbXBvbmVudCBpbnN0YW5jZSAqLykgewogIHZhciB0aGlzJDEkMSA9IHRoaXM7CiAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiBhc3NlcnQoaW5zdGFsbC5pbnN0YWxsZWQsICJub3QgaW5zdGFsbGVkLiBNYWtlIHN1cmUgdG8gY2FsbCBgVnVlLnVzZShWdWVSb3V0ZXIpYCAiICsgImJlZm9yZSBjcmVhdGluZyByb290IGluc3RhbmNlLiIpOwogIHRoaXMuYXBwcy5wdXNoKGFwcCk7CgogIC8vIHNldCB1cCBhcHAgZGVzdHJveWVkIGhhbmRsZXIKICAvLyBodHRwczovL2dpdGh1Yi5jb20vdnVlanMvdnVlLXJvdXRlci9pc3N1ZXMvMjYzOQogIGFwcC4kb25jZSgnaG9vazpkZXN0cm95ZWQnLCBmdW5jdGlvbiAoKSB7CiAgICAvLyBjbGVhbiBvdXQgYXBwIGZyb20gdGhpcy5hcHBzIGFycmF5IG9uY2UgZGVzdHJveWVkCiAgICB2YXIgaW5kZXggPSB0aGlzJDEkMS5hcHBzLmluZGV4T2YoYXBwKTsKICAgIGlmIChpbmRleCA+IC0xKSB7CiAgICAgIHRoaXMkMSQxLmFwcHMuc3BsaWNlKGluZGV4LCAxKTsKICAgIH0KICAgIC8vIGVuc3VyZSB3ZSBzdGlsbCBoYXZlIGEgbWFpbiBhcHAgb3IgbnVsbCBpZiBubyBhcHBzCiAgICAvLyB3ZSBkbyBub3QgcmVsZWFzZSB0aGUgcm91dGVyIHNvIGl0IGNhbiBiZSByZXVzZWQKICAgIGlmICh0aGlzJDEkMS5hcHAgPT09IGFwcCkgewogICAgICB0aGlzJDEkMS5hcHAgPSB0aGlzJDEkMS5hcHBzWzBdIHx8IG51bGw7CiAgICB9CiAgICBpZiAoIXRoaXMkMSQxLmFwcCkgewogICAgICB0aGlzJDEkMS5oaXN0b3J5LnRlYXJkb3duKCk7CiAgICB9CiAgfSk7CgogIC8vIG1haW4gYXBwIHByZXZpb3VzbHkgaW5pdGlhbGl6ZWQKICAvLyByZXR1cm4gYXMgd2UgZG9uJ3QgbmVlZCB0byBzZXQgdXAgbmV3IGhpc3RvcnkgbGlzdGVuZXIKICBpZiAodGhpcy5hcHApIHsKICAgIHJldHVybjsKICB9CiAgdGhpcy5hcHAgPSBhcHA7CiAgdmFyIGhpc3RvcnkgPSB0aGlzLmhpc3Rvcnk7CiAgaWYgKGhpc3RvcnkgaW5zdGFuY2VvZiBIVE1MNUhpc3RvcnkgfHwgaGlzdG9yeSBpbnN0YW5jZW9mIEhhc2hIaXN0b3J5KSB7CiAgICB2YXIgaGFuZGxlSW5pdGlhbFNjcm9sbCA9IGZ1bmN0aW9uIChyb3V0ZU9yRXJyb3IpIHsKICAgICAgdmFyIGZyb20gPSBoaXN0b3J5LmN1cnJlbnQ7CiAgICAgIHZhciBleHBlY3RTY3JvbGwgPSB0aGlzJDEkMS5vcHRpb25zLnNjcm9sbEJlaGF2aW9yOwogICAgICB2YXIgc3VwcG9ydHNTY3JvbGwgPSBzdXBwb3J0c1B1c2hTdGF0ZSAmJiBleHBlY3RTY3JvbGw7CiAgICAgIGlmIChzdXBwb3J0c1Njcm9sbCAmJiAnZnVsbFBhdGgnIGluIHJvdXRlT3JFcnJvcikgewogICAgICAgIGhhbmRsZVNjcm9sbCh0aGlzJDEkMSwgcm91dGVPckVycm9yLCBmcm9tLCBmYWxzZSk7CiAgICAgIH0KICAgIH07CiAgICB2YXIgc2V0dXBMaXN0ZW5lcnMgPSBmdW5jdGlvbiAocm91dGVPckVycm9yKSB7CiAgICAgIGhpc3Rvcnkuc2V0dXBMaXN0ZW5lcnMoKTsKICAgICAgaGFuZGxlSW5pdGlhbFNjcm9sbChyb3V0ZU9yRXJyb3IpOwogICAgfTsKICAgIGhpc3RvcnkudHJhbnNpdGlvblRvKGhpc3RvcnkuZ2V0Q3VycmVudExvY2F0aW9uKCksIHNldHVwTGlzdGVuZXJzLCBzZXR1cExpc3RlbmVycyk7CiAgfQogIGhpc3RvcnkubGlzdGVuKGZ1bmN0aW9uIChyb3V0ZSkgewogICAgdGhpcyQxJDEuYXBwcy5mb3JFYWNoKGZ1bmN0aW9uIChhcHApIHsKICAgICAgYXBwLl9yb3V0ZSA9IHJvdXRlOwogICAgfSk7CiAgfSk7Cn07ClZ1ZVJvdXRlci5wcm90b3R5cGUuYmVmb3JlRWFjaCA9IGZ1bmN0aW9uIGJlZm9yZUVhY2goZm4pIHsKICByZXR1cm4gcmVnaXN0ZXJIb29rKHRoaXMuYmVmb3JlSG9va3MsIGZuKTsKfTsKVnVlUm91dGVyLnByb3RvdHlwZS5iZWZvcmVSZXNvbHZlID0gZnVuY3Rpb24gYmVmb3JlUmVzb2x2ZShmbikgewogIHJldHVybiByZWdpc3Rlckhvb2sodGhpcy5yZXNvbHZlSG9va3MsIGZuKTsKfTsKVnVlUm91dGVyLnByb3RvdHlwZS5hZnRlckVhY2ggPSBmdW5jdGlvbiBhZnRlckVhY2goZm4pIHsKICByZXR1cm4gcmVnaXN0ZXJIb29rKHRoaXMuYWZ0ZXJIb29rcywgZm4pOwp9OwpWdWVSb3V0ZXIucHJvdG90eXBlLm9uUmVhZHkgPSBmdW5jdGlvbiBvblJlYWR5KGNiLCBlcnJvckNiKSB7CiAgdGhpcy5oaXN0b3J5Lm9uUmVhZHkoY2IsIGVycm9yQ2IpOwp9OwpWdWVSb3V0ZXIucHJvdG90eXBlLm9uRXJyb3IgPSBmdW5jdGlvbiBvbkVycm9yKGVycm9yQ2IpIHsKICB0aGlzLmhpc3Rvcnkub25FcnJvcihlcnJvckNiKTsKfTsKVnVlUm91dGVyLnByb3RvdHlwZS5wdXNoID0gZnVuY3Rpb24gcHVzaChsb2NhdGlvbiwgb25Db21wbGV0ZSwgb25BYm9ydCkgewogIHZhciB0aGlzJDEkMSA9IHRoaXM7CgogIC8vICRmbG93LWRpc2FibGUtbGluZQogIGlmICghb25Db21wbGV0ZSAmJiAhb25BYm9ydCAmJiB0eXBlb2YgUHJvbWlzZSAhPT0gJ3VuZGVmaW5lZCcpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIHRoaXMkMSQxLmhpc3RvcnkucHVzaChsb2NhdGlvbiwgcmVzb2x2ZSwgcmVqZWN0KTsKICAgIH0pOwogIH0gZWxzZSB7CiAgICB0aGlzLmhpc3RvcnkucHVzaChsb2NhdGlvbiwgb25Db21wbGV0ZSwgb25BYm9ydCk7CiAgfQp9OwpWdWVSb3V0ZXIucHJvdG90eXBlLnJlcGxhY2UgPSBmdW5jdGlvbiByZXBsYWNlKGxvY2F0aW9uLCBvbkNvbXBsZXRlLCBvbkFib3J0KSB7CiAgdmFyIHRoaXMkMSQxID0gdGhpczsKCiAgLy8gJGZsb3ctZGlzYWJsZS1saW5lCiAgaWYgKCFvbkNvbXBsZXRlICYmICFvbkFib3J0ICYmIHR5cGVvZiBQcm9taXNlICE9PSAndW5kZWZpbmVkJykgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgdGhpcyQxJDEuaGlzdG9yeS5yZXBsYWNlKGxvY2F0aW9uLCByZXNvbHZlLCByZWplY3QpOwogICAgfSk7CiAgfSBlbHNlIHsKICAgIHRoaXMuaGlzdG9yeS5yZXBsYWNlKGxvY2F0aW9uLCBvbkNvbXBsZXRlLCBvbkFib3J0KTsKICB9Cn07ClZ1ZVJvdXRlci5wcm90b3R5cGUuZ28gPSBmdW5jdGlvbiBnbyhuKSB7CiAgdGhpcy5oaXN0b3J5LmdvKG4pOwp9OwpWdWVSb3V0ZXIucHJvdG90eXBlLmJhY2sgPSBmdW5jdGlvbiBiYWNrKCkgewogIHRoaXMuZ28oLTEpOwp9OwpWdWVSb3V0ZXIucHJvdG90eXBlLmZvcndhcmQgPSBmdW5jdGlvbiBmb3J3YXJkKCkgewogIHRoaXMuZ28oMSk7Cn07ClZ1ZVJvdXRlci5wcm90b3R5cGUuZ2V0TWF0Y2hlZENvbXBvbmVudHMgPSBmdW5jdGlvbiBnZXRNYXRjaGVkQ29tcG9uZW50cyh0bykgewogIHZhciByb3V0ZSA9IHRvID8gdG8ubWF0Y2hlZCA/IHRvIDogdGhpcy5yZXNvbHZlKHRvKS5yb3V0ZSA6IHRoaXMuY3VycmVudFJvdXRlOwogIGlmICghcm91dGUpIHsKICAgIHJldHVybiBbXTsKICB9CiAgcmV0dXJuIFtdLmNvbmNhdC5hcHBseShbXSwgcm91dGUubWF0Y2hlZC5tYXAoZnVuY3Rpb24gKG0pIHsKICAgIHJldHVybiBPYmplY3Qua2V5cyhtLmNvbXBvbmVudHMpLm1hcChmdW5jdGlvbiAoa2V5KSB7CiAgICAgIHJldHVybiBtLmNvbXBvbmVudHNba2V5XTsKICAgIH0pOwogIH0pKTsKfTsKVnVlUm91dGVyLnByb3RvdHlwZS5yZXNvbHZlID0gZnVuY3Rpb24gcmVzb2x2ZSh0bywgY3VycmVudCwgYXBwZW5kKSB7CiAgY3VycmVudCA9IGN1cnJlbnQgfHwgdGhpcy5oaXN0b3J5LmN1cnJlbnQ7CiAgdmFyIGxvY2F0aW9uID0gbm9ybWFsaXplTG9jYXRpb24odG8sIGN1cnJlbnQsIGFwcGVuZCwgdGhpcyk7CiAgdmFyIHJvdXRlID0gdGhpcy5tYXRjaChsb2NhdGlvbiwgY3VycmVudCk7CiAgdmFyIGZ1bGxQYXRoID0gcm91dGUucmVkaXJlY3RlZEZyb20gfHwgcm91dGUuZnVsbFBhdGg7CiAgdmFyIGJhc2UgPSB0aGlzLmhpc3RvcnkuYmFzZTsKICB2YXIgaHJlZiA9IGNyZWF0ZUhyZWYoYmFzZSwgZnVsbFBhdGgsIHRoaXMubW9kZSk7CiAgcmV0dXJuIHsKICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwKICAgIHJvdXRlOiByb3V0ZSwKICAgIGhyZWY6IGhyZWYsCiAgICAvLyBmb3IgYmFja3dhcmRzIGNvbXBhdAogICAgbm9ybWFsaXplZFRvOiBsb2NhdGlvbiwKICAgIHJlc29sdmVkOiByb3V0ZQogIH07Cn07ClZ1ZVJvdXRlci5wcm90b3R5cGUuZ2V0Um91dGVzID0gZnVuY3Rpb24gZ2V0Um91dGVzKCkgewogIHJldHVybiB0aGlzLm1hdGNoZXIuZ2V0Um91dGVzKCk7Cn07ClZ1ZVJvdXRlci5wcm90b3R5cGUuYWRkUm91dGUgPSBmdW5jdGlvbiBhZGRSb3V0ZShwYXJlbnRPclJvdXRlLCByb3V0ZSkgewogIHRoaXMubWF0Y2hlci5hZGRSb3V0ZShwYXJlbnRPclJvdXRlLCByb3V0ZSk7CiAgaWYgKHRoaXMuaGlzdG9yeS5jdXJyZW50ICE9PSBTVEFSVCkgewogICAgdGhpcy5oaXN0b3J5LnRyYW5zaXRpb25Ubyh0aGlzLmhpc3RvcnkuZ2V0Q3VycmVudExvY2F0aW9uKCkpOwogIH0KfTsKVnVlUm91dGVyLnByb3RvdHlwZS5hZGRSb3V0ZXMgPSBmdW5jdGlvbiBhZGRSb3V0ZXMocm91dGVzKSB7CiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgIHdhcm4oZmFsc2UsICdyb3V0ZXIuYWRkUm91dGVzKCkgaXMgZGVwcmVjYXRlZCBhbmQgaGFzIGJlZW4gcmVtb3ZlZCBpbiBWdWUgUm91dGVyIDQuIFVzZSByb3V0ZXIuYWRkUm91dGUoKSBpbnN0ZWFkLicpOwogIH0KICB0aGlzLm1hdGNoZXIuYWRkUm91dGVzKHJvdXRlcyk7CiAgaWYgKHRoaXMuaGlzdG9yeS5jdXJyZW50ICE9PSBTVEFSVCkgewogICAgdGhpcy5oaXN0b3J5LnRyYW5zaXRpb25Ubyh0aGlzLmhpc3RvcnkuZ2V0Q3VycmVudExvY2F0aW9uKCkpOwogIH0KfTsKT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoVnVlUm91dGVyLnByb3RvdHlwZSwgcHJvdG90eXBlQWNjZXNzb3JzKTsKdmFyIFZ1ZVJvdXRlciQxID0gVnVlUm91dGVyOwpmdW5jdGlvbiByZWdpc3Rlckhvb2sobGlzdCwgZm4pIHsKICBsaXN0LnB1c2goZm4pOwogIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICB2YXIgaSA9IGxpc3QuaW5kZXhPZihmbik7CiAgICBpZiAoaSA+IC0xKSB7CiAgICAgIGxpc3Quc3BsaWNlKGksIDEpOwogICAgfQogIH07Cn0KZnVuY3Rpb24gY3JlYXRlSHJlZihiYXNlLCBmdWxsUGF0aCwgbW9kZSkgewogIHZhciBwYXRoID0gbW9kZSA9PT0gJ2hhc2gnID8gJyMnICsgZnVsbFBhdGggOiBmdWxsUGF0aDsKICByZXR1cm4gYmFzZSA/IGNsZWFuUGF0aChiYXNlICsgJy8nICsgcGF0aCkgOiBwYXRoOwp9CgovLyBXZSBjYW5ub3QgcmVtb3ZlIHRoaXMgYXMgaXQgd291bGQgYmUgYSBicmVha2luZyBjaGFuZ2UKVnVlUm91dGVyLmluc3RhbGwgPSBpbnN0YWxsOwpWdWVSb3V0ZXIudmVyc2lvbiA9ICczLjYuNSc7ClZ1ZVJvdXRlci5pc05hdmlnYXRpb25GYWlsdXJlID0gaXNOYXZpZ2F0aW9uRmFpbHVyZTsKVnVlUm91dGVyLk5hdmlnYXRpb25GYWlsdXJlVHlwZSA9IE5hdmlnYXRpb25GYWlsdXJlVHlwZTsKVnVlUm91dGVyLlNUQVJUX0xPQ0FUSU9OID0gU1RBUlQ7CmlmIChpbkJyb3dzZXIgJiYgd2luZG93LlZ1ZSkgewogIHdpbmRvdy5WdWUudXNlKFZ1ZVJvdXRlcik7Cn0KdmFyIHZlcnNpb24gPSAnMy42LjUnOwpleHBvcnQgeyBOYXZpZ2F0aW9uRmFpbHVyZVR5cGUsIExpbmsgYXMgUm91dGVyTGluaywgVmlldyBhcyBSb3V0ZXJWaWV3LCBTVEFSVCBhcyBTVEFSVF9MT0NBVElPTiwgVnVlUm91dGVyJDEgYXMgZGVmYXVsdCwgaXNOYXZpZ2F0aW9uRmFpbHVyZSwgdmVyc2lvbiB9Ow=="},null]}